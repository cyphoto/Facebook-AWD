From 14402dfe8af4253ddb6e0733988cd736484ab0dd Mon Sep 17 00:00:00 2001
From: AHWEBDEV <hermann.alexandre@ahwevdev.fr>
Date: Wed, 15 Aug 2012 02:52:04 +0200
Subject: [PATCH] 1.4 beta release

---
 AWD_facebook.php                                   | 1183 +++++++++-----------
 assets/js/facebook_awd.js                          |    4 +-
 assets/js/facebook_awd_admin.js                    |    3 +-
 inc/admin/forms/activity_box.php                   |   68 +-
 inc/admin/forms/comments_box.php                   |   50 +-
 inc/admin/forms/like_box.php                       |   52 +-
 inc/admin/forms/like_button.php                    |  118 +-
 inc/admin/forms/login_button.php                   |   36 +-
 inc/admin/forms/plugins_menu.php                   |   10 +-
 inc/admin/views/admin.php                          |   20 +-
 inc/admin/views/admin_open_graph.php               |   55 +-
 inc/admin/views/admin_open_graph_form.php          |   71 +-
 inc/admin/views/admin_plugins.php                  |   27 +-
 inc/admin/views/admin_settings.php                 |  276 +++--
 inc/admin/views/help/plugins.php                   |    4 +-
 inc/admin/views/help/settings.php                  |   40 +-
 inc/classes/facebook/base_facebook.php             |  262 ++++-
 inc/classes/facebook/class.AWD_facebook_api.php    |   33 +
 inc/classes/facebook/facebook.php                  |   75 +-
 .../plugins/class.AWD_facebook_plugin_abstract.php |    8 +-
 inc/classes/tools/class.AWD_facebook_form.php      |   27 +-
 inc/classes/tools/class.AWD_facebook_options.php   |   96 +-
 inc/classes/tools/class.AWD_facebook_widget.php    |    6 +-
 inc/init.php                                       |   14 +-
 readme.md                                          |    2 +-
 readme.txt                                         |    4 +-
 26 files changed, 1341 insertions(+), 1203 deletions(-)
 create mode 100644 inc/classes/facebook/class.AWD_facebook_api.php

diff --git a/AWD_facebook.php b/AWD_facebook.php
index 2c5332b..6290e84 100755
--- a/AWD_facebook.php
+++ b/AWD_facebook.php
@@ -2,8 +2,8 @@
 /*
 Plugin Name: Facebook AWD All in One
 Plugin URI: http://facebook-awd.ahwebdev.fr
-Description: This plugin integrates Facebook open graph, Plugins from facebook, and FB connect, with SDK JS AND SDK PHP Facebook
-Version: 1.4
+Description: This plugin integrates Facebook open graph, Plugins from facebook, and FB connect, with SDK JS AND SDK PHP 3.2 Facebook
+Version: 1.4 Beta
 Author: AHWEBDEV
 Author URI: http://www.ahwebdev.fr
 License: Copywrite AHWEBDEV
@@ -51,7 +51,7 @@ Class AWD_facebook
      * public
      * preffix blog option
      */
-    public $plugin_text_domain = 'AWD_facebook';
+    public $ptd = 'AWD_facebook';
     
     /**
      * private
@@ -98,6 +98,10 @@ Class AWD_facebook
      */
     public $fcbk = null;
     
+    /**
+     * the ID of the current facebook user.
+     */
+    public $uid = null;
     
     
 	//****************************************************************************************
@@ -109,9 +113,11 @@ Class AWD_facebook
 	 */
 	public function get_current_user()
 	{
-	    global $current_user;
-		get_currentuserinfo();
+		global $current_user;
+      	get_currentuserinfo();
+
 		$this->current_user = $current_user;
+		return $this->current_user;
 	}
 	
     /**
@@ -214,10 +220,6 @@ Class AWD_facebook
 	 */
 	public function __construct()
 	{		
-		//Class Facebook
-		if(!class_exists('Facebook'))
-			require_once(dirname(__FILE__).'/inc/classes/facebook/facebook.php');
-
 		//init the plugin and action
 		add_action('plugins_loaded',array(&$this,'initial'));
 		//like box widget register
@@ -300,67 +302,62 @@ Class AWD_facebook
 	 */
 	public function missing_config()
 	{
-		//error for connect
-		if($this->options['app_id'] =='' OR $this->options['app_secret_key'] =='' OR $this->options['admins'] ==''){
-			?>
-			<div class="alert alert-error">
-				<p><?php printf( __('Facebook AWD is almost ready... Go to settings and set your FB app Id, your FB Secret Key and your FB User ID', $this->plugin_text_domain), admin_url( 'admin.php?page='.$this->plugin_slug)); ?></p>
-			</div>
-			<?php	
+		if($this->options['app_id'] =='')
+		{
+			$this->errors[] = new WP_Error('AWD_facebook_not_ready', __('Facebook AWD is almost ready... Go to settings and set your FB Application ID.', $this->ptd));
+		}
+		if($this->options['app_secret_key'] =='')
+		{
+			$this->errors[] = new WP_Error('AWD_facebook_not_ready', __('Facebook AWD is almost ready... Go to settings and set your FB Secret Key.', $this->ptd));
 		}
 	}
 	
-	/**
-	 * missing config notices
-	 * @return void
-	 */
-	public function message_register_disabled()
-	{
-		echo'
-		<div class="ui-state-error admin_notice">
-			<p>'.__('Users can not register, please enable registration account in blog settings before using FB Connect.', $this->plugin_text_domain).'</p>
-		</div>
-		';
-	}
 	
 	/**
 	 * Display Error in admin Facebook AWD area
 	 * @return void
 	 */
-	public function display_errors()
+	public function display_all_errors()
 	{
-		if(isset($this->messages) && count($this->messages)>0){
-			$html = implode('', $this->messages);
-			unset($this->messages);
-			return $html;
+		$html = '';
+		if(isset($this->errors) && count($this->errors) > 0 AND is_array($this->errors)){
+			foreach($this->errors as $error){
+				if(is_wp_error($error))
+					$html .= $this->display_messages($error->get_error_message(), 'error', false);
+			}
+			echo $html;
+		}
+		if(isset($this->warnings) && count($this->warnings) > 0 AND is_array($this->warnings)){
+			foreach($this->warnings as $warning){
+				if(is_wp_error($warning))
+					$html .= $this->display_messages($warning->get_error_message(), 'warning', false);
+			}
+			echo $html;
 		}
 	}
 	
 	/**
-	 * @return a formated error for display
-	 * @param object $errors
-	 * @return string
+	 * Display Message in admin Facebook AWD area
+	 * @return void
 	 */
-	public function return_error($errors){
-		$html .='<div class="alert alert-error"><u><b>Facebook '.__('Message',$this->plugin_text_domain).'</b></u><br /><br />';
-			if(is_array($errors) AND count($errors)){
-				foreach($errors as $error){
-					$html .= '<b>Type:</b> '.$error->getType().'<br />
-					<b>Message:</b> '.$error->getMessage().'</p>';
-				
-				}
-			}else if(is_object($errors)){
-				$html .= '<b>Type:</b> '.$errors->getType().'<br />
-				<b>Message:</b> '.$errors->getMessage().'</p>';
-			}else if(is_string($errors)){
-				$html .= '<b>Message:</b> '.$errors.'</p>';
+	public function display_messages($message = null, $type = 'info', $echo = true)
+	{
+		$html = '';
+		if(!empty($message)){
+			$html = '<div class="alert alert-'.$type.'">'.$message.'</div>';
+		}else if(isset($this->messages) && count($this->messages) > 0 AND is_array($this->messages)){
+			foreach($this->messages as $key=>$message){
+				if(is_string($type))
+					$type = $key;
+				$html.= '<div class="alert alert-'.$type.'">'.$message.'</div>';
 			}
-		$html .='</div>';
-		return $html;
+		}
+		if(!$echo)
+			return $html;
+		
+		echo $html;
 	}
 	
-	
-	
 	/**
 	 * Getter
 	 * Help in the plugin tooltip
@@ -402,20 +399,20 @@ Class AWD_facebook
 		global $wp_admin_bar;
 		$links = array();
 		
-		if($this->me['link'] != ''){
-			$links[] = array(__('My Profile',$this->plugin_text_domain), $this->me['link']);
+		if($this->is_user_logged_in_facebook() && isset($this->me['link'])){
+			$links[] = array(__('My Profile',$this->ptd), $this->me['link']);
 		}
 		if($this->is_user_logged_in_facebook()){
-			$links[] = array(__('Refresh Facebook Data',$this->plugin_text_domain),  $this->_login_url);
-			$links[] = array(__('Unsync FB Account',$this->plugin_text_domain), $this->_unsync_url);
+			$links[] = array(__('Refresh Facebook Data',$this->ptd),  $this->_login_url);
+			$links[] = array(__('Unsync FB Account',$this->ptd), $this->_unsync_url);
 		}
 		
 		if(current_user_can('manage_options')){
-			$links[] = array(__('Settings',$this->plugin_text_domain),admin_url('admin.php?page='.$this->plugin_slug));
-			$links[] = array(__('Documentation',$this->plugin_text_domain),'http://facebook-awd.ahwebdev.fr/documentation/');
-			$links[] = array(__('Support',$this->plugin_text_domain),'http://facebook-awd.ahwebdev.fr/support/');
+			$links[] = array(__('Settings',$this->ptd),admin_url('admin.php?page='.$this->plugin_slug));
+			$links[] = array(__('Documentation',$this->ptd),'http://facebook-awd.ahwebdev.fr/documentation/');
+			$links[] = array(__('Support',$this->ptd),'http://facebook-awd.ahwebdev.fr/support/');
 			if(!is_admin())
-				$links[] = array(__('Debugger',$this->plugin_text_domain),'http://developers.facebook.com/tools/debug/og/object?q='.urlencode($this->get_current_url()));
+				$links[] = array(__('Debugger',$this->ptd),'http://developers.facebook.com/tools/debug/og/object?q='.urlencode($this->get_current_url()));
 		}
 		$links = apply_filters('AWD_facebook_admin_bar_links', $links);
 		
@@ -428,7 +425,7 @@ Class AWD_facebook
 			));
 			foreach ($links as $link => $infos) {
 				$wp_admin_bar->add_menu( array(
-					'id' => $this->plugin_slug.'_submenu',
+					'id' => $this->plugin_slug.'_submenu'.$link,
 					'title' => $infos[0],
 					'href' => $infos[1],
 					'parent' => $this->plugin_slug,
@@ -449,31 +446,31 @@ Class AWD_facebook
 		$fb_publish_to_user = false;
 		$post = get_post($post_id);
 		if(!wp_is_post_revision($post->ID)){
+			$narray = array();
 			foreach($_POST as $__post=>$val){
 				//should have ogtags in prefix present to be saved
-				if(preg_match('@ogtags_@',$__post)){
-					update_post_meta($post->ID, $__post, $val);
+				if(preg_match('@'.$this->plugin_option_pref.'@',$__post)){
+					$name = str_ireplace($this->plugin_option_pref,'',$__post);
+					$narray[$name] = $val;
 				}
-				if(preg_match('@'.$this->plugin_option_pref.'like_button@',$__post)){
-					update_post_meta($post->ID, $__post, $val);
-				}				
 			}
+			update_post_meta($post->ID, $this->plugin_slug, $narray);
 			//check if the post is published
 			if($post->post_status == 'publish'){
 				//check if facebook user before to try to publish
 				if($this->is_user_logged_in_facebook()){
 					//Publish to Graph api
-					$message = $_POST[$this->plugin_option_pref.'publish_message_text'];
-					$read_more_text = $_POST[$this->plugin_option_pref.'publish_read_more_text'];
+					$message = $_POST[$this->plugin_option_pref.'fbpublish']['message_text'];
+					$read_more_text = $_POST[$this->plugin_option_pref.'fbpublish']['read_more_text'];
 					//Check if we want to publish on facebook pages and profile
-					if($_POST[$this->plugin_option_pref.'publish_to_pages'] == 1 && $this->current_facebook_user_can('publish_stream') && $this->current_facebook_user_can('manage_pages')){
+					if($_POST[$this->plugin_option_pref.'fbpublish']['to_pages'] == 1 && $this->current_facebook_user_can('publish_stream') && $this->current_facebook_user_can('manage_pages')){
 						$fb_publish_to_pages = $this->get_pages_to_publish();
 						if(count($fb_publish_to_pages)>0){
 							$this->publish_post_to_facebook($message,$read_more_text,$fb_publish_to_pages,$post->ID);
 						}
 					}
 					//Check if we want to publish on facebook pages and profile
-					if($_POST[$this->plugin_option_pref.'publish_to_profile'] == 1 && $this->current_facebook_user_can('publish_stream')){
+					if($_POST[$this->plugin_option_pref.'fbpublish']['to_profile'] == 1 && $this->current_facebook_user_can('publish_stream')){
 						$this->publish_post_to_facebook($message,$read_more_text, $this->uid ,$post->ID);
 					}
 				}
@@ -491,7 +488,39 @@ Class AWD_facebook
 	 */
 	public function admin_footer_text($footer_text)
 	{
-	    return $footer_text."  ".__('| With:',$this->plugin_text_domain)." <a href='http://www.ahwebdev.fr/plugins/facebook-awd.html'>".$this->plugin_name." v".$this->get_version()."</a>";
+	    return $footer_text."  ".__('| With:',$this->ptd)." <a href='http://www.ahwebdev.fr/plugins/facebook-awd.html'>".$this->plugin_name." v".$this->get_version()."</a>";
+	}
+	
+	
+	/**
+	 * Set Admin Roles
+	 * Add FB capabalities to default WP roles
+	 * @return void
+	 */
+	public function set_admin_roles()
+	{
+		$roles = array(
+			'administrator' => array(
+				'manage_facebook_awd_settings',
+				'manage_facebook_awd_plugins',
+				'manage_facebook_awd_opengraph',
+				'manage_facebook_awd_publish_to_pages',
+			),
+			'editor' => array(
+				'manage_facebook_awd_publish_to_pages',
+				'manage_facebook_awd_opengraph'
+			),
+			'author' => array(
+				'manage_facebook_awd_publish_to_pages'
+			)
+		);
+		$roles = apply_filters('AWD_facebook_admin_roles', $roles);
+		foreach($roles as $role=>$caps){
+			$wp_role = get_role($role);
+			foreach($caps as $cap){
+				$wp_role->add_cap($cap);
+			}
+		}
 	}
 	
 	/**
@@ -501,41 +530,40 @@ Class AWD_facebook
 	 */
 	public function admin_menu()
 	{
+		$this->set_admin_roles();
+		
 		add_action('save_post', array(&$this,'save_options_post_editor'));
 		
+		//global $wp_roles;
+		//print_r($wp_roles);
+		//exit();
+		
 		//admin hook
-		$this->blog_admin_page_hook = add_menu_page($this->plugin_page_admin_name, __($this->plugin_name,$this->plugin_text_domain), 'administrator', $this->plugin_slug, array($this,'admin_content'), $this->plugin_url_images.'facebook-mini.png',$this->blog_admin_hook_position);
-		$this->blog_admin_settings_hook = add_submenu_page($this->plugin_slug, __('Settings',$this->plugin_text_domain), '<img src="'.$this->plugin_url_images.'settings.png" /> '.__('Settings',$this->plugin_text_domain), 'administrator', $this->plugin_slug);
-		$this->blog_admin_plugins_hook = add_submenu_page($this->plugin_slug, __('Plugins',$this->plugin_text_domain), '<img src="'.$this->plugin_url_images.'plugins.png" /> '.__('Plugins',$this->plugin_text_domain), 'administrator', $this->plugin_slug.'_plugins', array($this,'admin_content'));
+		$this->blog_admin_page_hook = add_menu_page($this->plugin_page_admin_name, __($this->plugin_name,$this->ptd), 'manage_facebook_awd_publish_to_pages', $this->plugin_slug, array($this,'admin_content'), $this->plugin_url_images.'facebook-mini.png',$this->blog_admin_hook_position);
+		$this->blog_admin_settings_hook = add_submenu_page($this->plugin_slug, __('Settings',$this->ptd), '<img src="'.$this->plugin_url_images.'settings.png" /> '.__('Settings',$this->ptd), 'manage_facebook_awd_publish_to_pages', $this->plugin_slug);
+		$this->blog_admin_plugins_hook = add_submenu_page($this->plugin_slug, __('Plugins',$this->ptd), '<img src="'.$this->plugin_url_images.'plugins.png" /> '.__('Plugins',$this->ptd), 'manage_facebook_awd_plugins', $this->plugin_slug.'_plugins', array($this,'admin_content'));
 		if($this->options['open_graph_enable'] == 1){
-			$this->blog_admin_opengraph_hook = add_submenu_page($this->plugin_slug, __('Open Graph',$this->plugin_text_domain), '<img src="'.$this->plugin_url_images.'ogp-logo.png" /> '.__('Open Graph',$this->plugin_text_domain), 'administrator', $this->plugin_slug.'_open_graph', array($this,'admin_content'));
+			$this->blog_admin_opengraph_hook = add_submenu_page($this->plugin_slug, __('Open Graph',$this->ptd), '<img src="'.$this->plugin_url_images.'ogp-logo.png" /> '.__('Open Graph',$this->ptd), 'manage_facebook_awd_opengraph', $this->plugin_slug.'_open_graph', array($this,'admin_content'));
+			add_action( "load-".$this->blog_admin_opengraph_hook, array(&$this,'admin_initialisation'));
+			add_action( 'admin_print_styles-'.$this->blog_admin_opengraph_hook, array(&$this,'admin_enqueue_css'));
+			add_action( 'admin_print_scripts-'.$this->blog_admin_opengraph_hook, array(&$this,'admin_enqueue_js'));
 		}
-		//$this->blog_admin_support_hook = add_submenu_page($this->plugin_slug, __('Support',$this->plugin_text_domain), '<img src="'.$this->plugin_url_images.'info.png" /> '.__('Support',$this->plugin_text_domain), 'administrator', $this->plugin_slug.'_support', array($this,'admin_content'));
-
 		add_action( "load-".$this->blog_admin_page_hook, array(&$this,'admin_initialisation'));
-		//add_action( "load-".$this->blog_admin_support_hook, array(&$this,'admin_initialisation'));
 		add_action( "load-".$this->blog_admin_plugins_hook, array(&$this,'admin_initialisation'));
-		add_action( "load-".$this->blog_admin_opengraph_hook, array(&$this,'admin_initialisation'));
 		add_action( 'admin_print_styles-'.$this->blog_admin_page_hook, array(&$this,'admin_enqueue_css'));		
-		//add_action( 'admin_print_styles-'.$this->blog_admin_support_hook, array(&$this,'admin_enqueue_css'));
 		add_action( 'admin_print_styles-'.$this->blog_admin_plugins_hook, array(&$this,'admin_enqueue_css'));
-		add_action( 'admin_print_styles-'.$this->blog_admin_opengraph_hook, array(&$this,'admin_enqueue_css'));
 		add_action( 'admin_print_styles-post-new.php', array(&$this,'admin_enqueue_css'));
 		add_action( 'admin_print_styles-post.php', array(&$this,'admin_enqueue_css'));
 		add_action( 'admin_print_scripts-'.$this->blog_admin_page_hook, array(&$this,'admin_enqueue_js'));
-		//add_action( 'admin_print_scripts-'.$this->blog_admin_support_hook, array(&$this,'admin_enqueue_js'));
 		add_action( 'admin_print_scripts-'.$this->blog_admin_plugins_hook, array(&$this,'admin_enqueue_js'));
-		add_action( 'admin_print_scripts-'.$this->blog_admin_opengraph_hook, array(&$this,'admin_enqueue_js'));
 		add_action( 'admin_print_scripts-post-new.php', array(&$this,'admin_enqueue_js'));
 		add_action( 'admin_print_scripts-post.php', array(&$this,'admin_enqueue_js'));
 		
 		//test-widgets.php
 		add_action( 'admin_print_styles-widgets.php', array(&$this,'admin_enqueue_css'));
-
 		
 		//enqueue here the library facebook connect
 		$this->add_js_options();
-		
 		//Add meta box
 		$this->add_meta_boxes();
 	}
@@ -546,6 +574,7 @@ Class AWD_facebook
 	*/
 	public function admin_initialisation()
 	{			
+		//add 2 column screen
 		add_screen_option('layout_columns', array('max' => 2, 'default' => 2));
 	}
 	
@@ -559,41 +588,45 @@ Class AWD_facebook
 		$icon = isset($this->options['app_infos']['icon_url']) ? '<img style="vertical-align:middle;" src="'.$this->options['app_infos']['icon_url'].'" alt=""/>' : '';
 	
 		//Settings page
-		add_meta_box($this->plugin_slug."_settings_metabox", __('Settings',$this->plugin_text_domain).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'settings.png" />', array(&$this,'settings_content'), $this->blog_admin_page_hook , 'normal', 'core');
-		add_meta_box($this->plugin_slug."_meta_metabox",  __('My Facebook',$this->plugin_text_domain).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'fcbk_content'),  $this->blog_admin_page_hook, 'side', 'core');
-		add_meta_box($this->plugin_slug."_app_infos_metabox",  __('Application Infos', $this->plugin_text_domain).' '.$icon, array(&$this,'app_infos_content'),  $this->blog_admin_page_hook, 'side', 'core');
-		add_meta_box($this->plugin_slug."_info_metabox",  __('Informations',$this->plugin_text_domain), array(&$this,'general_content'),  $this->blog_admin_page_hook, 'side', 'core');
-		add_meta_box($this->plugin_slug."_activity_metabox",  __('Activity on your site',$this->plugin_text_domain), array(&$this,'activity_content'),  $this->blog_admin_page_hook , 'side', 'core');
-		add_meta_box($this->plugin_slug."_discover_metabox",  __('Facebook AWD Plugins',$this->plugin_text_domain), array(&$this,'get_feed_meta_box'),  $this->blog_admin_page_hook , 'normal', 'core', $this->get_plugins_feed_config());
-		add_meta_box($this->plugin_slug."_blog_metabox",  __('Facebook AWD News',$this->plugin_text_domain), array(&$this,'get_feed_meta_box'),  $this->blog_admin_page_hook , 'normal', 'core', $this->get_news_feed_config());
-
+		if($this->blog_admin_page_hook != ''){
+			add_meta_box($this->plugin_slug."_settings_metabox", __('Settings',$this->ptd).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'settings.png" />', array(&$this,'settings_content'), $this->blog_admin_page_hook , 'normal', 'core');
+			add_meta_box($this->plugin_slug."_meta_metabox",  __('My Facebook',$this->ptd).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'fcbk_content'),  $this->blog_admin_page_hook, 'side', 'core');
+			add_meta_box($this->plugin_slug."_app_infos_metabox",  __('Application Infos', $this->ptd).' '.$icon, array(&$this,'app_infos_content'),  $this->blog_admin_page_hook, 'side', 'core');
+			add_meta_box($this->plugin_slug."_info_metabox",  __('Informations',$this->ptd), array(&$this,'general_content'),  $this->blog_admin_page_hook, 'side', 'core');
+			if(current_user_can('manage_facebook_awd_settings')){
+				add_meta_box($this->plugin_slug."_activity_metabox",  __('Activity on your site',$this->ptd), array(&$this,'activity_content'),  $this->blog_admin_page_hook , 'side', 'core');
+			}
+		}
 		//Plugins page
-		add_meta_box($this->plugin_slug."_plugins_metabox", __('Plugins Settings',$this->plugin_text_domain).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'plugins.png" />', array(&$this,'plugins_content'),  $this->blog_admin_plugins_hook , 'normal', 'core');
-		add_meta_box($this->plugin_slug."_meta_metabox",  __('My Facebook',$this->plugin_text_domain).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'fcbk_content'),  $this->blog_admin_plugins_hook , 'side', 'core');
-		add_meta_box($this->plugin_slug."_app_infos_metabox",  __('Application Infos', $this->plugin_text_domain).' '.$icon, array(&$this,'app_infos_content'),  $this->blog_admin_plugins_hook , 'side', 'core');
-		add_meta_box($this->plugin_slug."_info_metabox",  __('Informations',$this->plugin_text_domain), array(&$this,'general_content'),  $this->blog_admin_plugins_hook , 'side', 'core');
-		add_meta_box($this->plugin_slug."_activity_metabox",  __('Activity on your site',$this->plugin_text_domain), array(&$this,'activity_content'),  $this->blog_admin_plugins_hook , 'side', 'core');
-		add_meta_box($this->plugin_slug."_discover_metabox",  __('Facebook AWD Plugins',$this->plugin_text_domain), array(&$this,'get_feed_meta_box'),  $this->blog_admin_plugins_hook , 'normal', 'core',$this->get_plugins_feed_config());
-		add_meta_box($this->plugin_slug."_blog_metabox",  __('Facebook AWD News',$this->plugin_text_domain), array(&$this,'get_feed_meta_box'),  $this->blog_admin_plugins_hook , 'normal', 'core', $this->get_news_feed_config());
-
-		
+		if($this->blog_admin_plugins_hook != ''){
+			add_meta_box($this->plugin_slug."_plugins_metabox", __('Plugins Settings',$this->ptd).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'plugins.png" />', array(&$this,'plugins_content'),  $this->blog_admin_plugins_hook , 'normal', 'core');
+			add_meta_box($this->plugin_slug."_meta_metabox",  __('My Facebook',$this->ptd).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'fcbk_content'),  $this->blog_admin_plugins_hook , 'side', 'core');
+			add_meta_box($this->plugin_slug."_app_infos_metabox",  __('Application Infos', $this->ptd).' '.$icon, array(&$this,'app_infos_content'),  $this->blog_admin_plugins_hook , 'side', 'core');
+			add_meta_box($this->plugin_slug."_info_metabox",  __('Informations',$this->ptd), array(&$this,'general_content'),  $this->blog_admin_plugins_hook , 'side', 'core');
+			if(current_user_can('manage_facebook_awd_settings')){
+				add_meta_box($this->plugin_slug."_activity_metabox",  __('Activity on your site',$this->ptd), array(&$this,'activity_content'),  $this->blog_admin_plugins_hook , 'side', 'core');
+			}
+		}
 		//OpenGraph And post edito pages
-		add_meta_box($this->plugin_slug."_open_graph_metabox", __('Open Graph',$this->plugin_text_domain).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'ogp-logo.png" />', array(&$this,'open_graph_content'),  $this->blog_admin_opengraph_hook, 'normal', 'core');
-		$post_types = get_post_types();
-		foreach($post_types as $type){
+		if($this->blog_admin_opengraph_hook != ''){
 			if($this->options['open_graph_enable'] == 1){
-				//add_meta_box($this->plugin_slug."_open_graph_post_metas_form", __('Open Graph Metas',$this->plugin_text_domain).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'ogp-logo.png" />', array(&$this,'open_graph_post_metas_form'),  $type , 'normal', 'core',array("prefix"=>$this->plugin_option_pref.'ogtags_'));
 			}
-			//Like button manager on post page type
-			//add_meta_box($this->plugin_slug."_awd_mini_form_metabox", __('Facebook AWD Manager',$this->plugin_text_domain).' <img style="vertical-align:middle;" style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'post_manager_content'),  $type , 'side', 'core');
 		}
-		if($this->options['open_graph_enable'] == 1){			
-			add_meta_box($this->plugin_slug."_meta_metabox",  __('My Facebook',$this->plugin_text_domain).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'fcbk_content'),  $this->blog_admin_opengraph_hook , 'side', 'core');
-			add_meta_box($this->plugin_slug."_app_infos_metabox",  __('Application Infos', $this->plugin_text_domain).' '.$icon, array(&$this,'app_infos_content'),  $this->blog_admin_opengraph_hook , 'side', 'core');
-			add_meta_box($this->plugin_slug."_info_metabox",  __('Informations',$this->plugin_text_domain), array(&$this,'general_content'),  $this->blog_admin_opengraph_hook , 'side', 'core');
-			add_meta_box($this->plugin_slug."_activity_metabox",  __('Activity on your site',$this->plugin_text_domain), array(&$this,'activity_content'),  $this->blog_admin_opengraph_hook , 'side', 'core');
-			add_meta_box($this->plugin_slug."_discover_metabox",  __('Facebook AWD Plugins',$this->plugin_text_domain), array(&$this,'get_feed_meta_box'),  $this->blog_admin_opengraph_hook , 'normal', 'core',$this->get_plugins_feed_config());
-			add_meta_box($this->plugin_slug."_blog_metabox",  __('Facebook AWD News',$this->plugin_text_domain), array(&$this,'get_feed_meta_box'),  $this->blog_admin_opengraph_hook , 'normal', 'core', $this->get_news_feed_config());
+		$post_types = get_post_types();
+		foreach($post_types as $type){
+			//Like button manager on post page type
+			add_meta_box($this->plugin_slug."_awd_mini_form_metabox", __('Facebook AWD Manager',$this->ptd).' <img style="vertical-align:middle;" style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'post_manager_content'),  $type , 'side', 'core');
+		}
+		if($this->blog_admin_opengraph_hook != ''){
+			if($this->options['open_graph_enable'] == 1){	
+				add_meta_box($this->plugin_slug."_open_graph_metabox", __('Open Graph',$this->ptd).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'ogp-logo.png" />', array(&$this,'open_graph_content'),  $this->blog_admin_opengraph_hook, 'normal', 'core');
+				add_meta_box($this->plugin_slug."_meta_metabox",  __('My Facebook',$this->ptd).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'fcbk_content'),  $this->blog_admin_opengraph_hook , 'side', 'core');
+				add_meta_box($this->plugin_slug."_app_infos_metabox",  __('Application Infos', $this->ptd).' '.$icon, array(&$this,'app_infos_content'),  $this->blog_admin_opengraph_hook , 'side', 'core');
+				add_meta_box($this->plugin_slug."_info_metabox",  __('Informations',$this->ptd), array(&$this,'general_content'),  $this->blog_admin_opengraph_hook , 'side', 'core');
+				if(current_user_can('manage_facebook_awd_settings')){
+					add_meta_box($this->plugin_slug."_activity_metabox",  __('Activity on your site',$this->ptd), array(&$this,'activity_content'),  $this->blog_admin_opengraph_hook , 'side', 'core');
+				}
+			}
 		}
 		
 		//Call the menu init to get page hook for each menu
@@ -602,26 +635,17 @@ Class AWD_facebook
 		$plugins = $this->plugins;
 		if(is_array($plugins)){
 			foreach($plugins as $plugin){
-				$page_hook = $plugin->plugin_admin_hook;
-				add_meta_box($this->plugin_slug."_meta_metabox",  __('My Facebook',$this->plugin_text_domain).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'fcbk_content'),  $page_hook , 'side', 'core');
-				add_meta_box($this->plugin_slug."_app_infos_metabox",  __('Application Infos', $this->plugin_text_domain).' '.$icon, array(&$this,'app_infos_content'),  $page_hook , 'side', 'core');
-				add_meta_box($this->plugin_slug."_info_metabox",  __('Informations',$this->plugin_text_domain), array(&$this,'general_content'),  $page_hook , 'side', 'core');
-				add_meta_box($this->plugin_slug."_activity_metabox",  __('Activity on your site',$this->plugin_text_domain), array(&$this,'activity_content'),  $page_hook , 'side', 'core');
-				add_meta_box($this->plugin_slug."_discover_metabox",  __('Facebook AWD Plugins',$this->plugin_text_domain), array(&$this,'get_feed_meta_box'),  $page_hook , 'normal', 'core',$this->get_plugins_feed_config());
-				add_meta_box($this->plugin_slug."_blog_metabox",  __('Facebook AWD News',$this->plugin_text_domain), array(&$this,'get_feed_meta_box'),  $page_hook , 'normal', 'core', $this->get_news_feed_config());
+				if(isset($plugin->plugin_admin_hook) &&  $plugin->plugin_admin_hook != ''){
+					$page_hook = $plugin->plugin_admin_hook;
+					add_meta_box($this->plugin_slug."_meta_metabox",  __('My Facebook',$this->ptd).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'fcbk_content'),  $page_hook , 'side', 'core');
+					add_meta_box($this->plugin_slug."_app_infos_metabox",  __('Application Infos', $this->ptd).' '.$icon, array(&$this,'app_infos_content'),  $page_hook , 'side', 'core');
+					add_meta_box($this->plugin_slug."_info_metabox",  __('Informations',$this->ptd), array(&$this,'general_content'),  $page_hook , 'side', 'core');
+					if(current_user_can('manage_facebook_awd_settings')){
+						add_meta_box($this->plugin_slug."_activity_metabox",  __('Activity on your site',$this->ptd), array(&$this,'activity_content'),  $page_hook , 'side', 'core');
+					}
+				}
 			}
 		}
-		
-		//Support page
-		/*
-		add_meta_box($this->plugin_slug."_support_metabox",  __('Support',$this->plugin_text_domain).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'info.png" />', array(&$this,'support_content'),  $this->blog_admin_support_hook, 'normal', 'core');
-		add_meta_box($this->plugin_slug."_meta_metabox",  __('My Facebook',$this->plugin_text_domain).' <img style="vertical-align:middle;" src="'.$this->plugin_url_images.'facebook-mini.png" alt="facebook logo"/>', array(&$this,'fcbk_content'),  $this->blog_admin_support_hook , 'side', 'core');
-		add_meta_box($this->plugin_slug."_app_infos_metabox",  __('Application Infos', $this->plugin_text_domain).' '.$icon, array(&$this,'app_infos_content'),  $this->blog_admin_support_hook , 'side', 'core');
-		add_meta_box($this->plugin_slug."_info_metabox",  __('Informations',$this->plugin_text_domain), array(&$this,'general_content'),  $this->blog_admin_support_hook , 'side', 'core');
-		add_meta_box($this->plugin_slug."_activity_metabox",  __('Activity on your site',$this->plugin_text_domain), array(&$this,'activity_content'),  $this->blog_admin_support_hook , 'side', 'core');
-		add_meta_box($this->plugin_slug."_discover_metabox",  __('Facebook AWD Plugins',$this->plugin_text_domain), array(&$this,'get_feed_meta_box'),  $this->blog_admin_support_hook , 'normal', 'core',$this->get_plugins_feed_config());
-		add_meta_box($this->plugin_slug."_blog_metabox",  __('Facebook AWD News',$this->plugin_text_domain), array(&$this,'get_feed_meta_box'),  $this->blog_admin_support_hook , 'normal', 'core', $this->get_news_feed_config());
-		*/
 	}
 	
 	/**
@@ -686,39 +710,39 @@ Class AWD_facebook
 	 */		                               
 	public function get_the_help_box($type)
 	{
-		$html = '<p><u>'.__('You can use Pattern code in fields, paste it where you need:',$this->plugin_text_domain).'</u></p>';
+		$html = '<p><u>'.__('You can use Pattern code in fields, paste it where you need:',$this->ptd).'</u></p>';
 		switch($type){
 			case 'taxonomies':
 				$html .= '<div class="awd_pre">';
-					$html .= '<p><b>%BLOG_TITLE%</b> - '.__('Use blog name',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%BLOG_DESCRIPTION%</b> - '.__('Use blog description',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%BLOG_URL%</b> - '.__('Use blog url',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%TERM_TITLE%</b> - '.__('Use term name',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%TERM_DESCRIPTION%</b> - '.__('Use term description',$this->plugin_text_domain).'</p>';
+					$html .= '<p><b>%BLOG_TITLE%</b> - '.__('Use blog name',$this->ptd).'</p>';
+					$html .= '<p><b>%BLOG_DESCRIPTION%</b> - '.__('Use blog description',$this->ptd).'</p>';
+					$html .= '<p><b>%BLOG_URL%</b> - '.__('Use blog url',$this->ptd).'</p>';
+					$html .= '<p><b>%TERM_TITLE%</b> - '.__('Use term name',$this->ptd).'</p>';
+					$html .= '<p><b>%TERM_DESCRIPTION%</b> - '.__('Use term description',$this->ptd).'</p>';
 				$html .= '</div>';
 			break;
 			case 'frontpage':
 				$html .= '<div class="awd_pre">';
-					$html .= '<p><b>%BLOG_TITLE%</b> - '.__('Use blog name',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%BLOG_DESCRIPTION%</b> - '.__('Use blog description',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%BLOG_URL%</b> - '.__('Use blog url',$this->plugin_text_domain).'</p>';
+					$html .= '<p><b>%BLOG_TITLE%</b> - '.__('Use blog name',$this->ptd).'</p>';
+					$html .= '<p><b>%BLOG_DESCRIPTION%</b> - '.__('Use blog description',$this->ptd).'</p>';
+					$html .= '<p><b>%BLOG_URL%</b> - '.__('Use blog url',$this->ptd).'</p>';
 				$html .= '</div>';
 			break;
 			case 'archive':
 				$html .= '<div class="awd_pre">';
-				 	$html .= '<p><b>%BLOG_TITLE%</b> - '.__('Use blog name',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%BLOG_DESCRIPTION%</b> - '.__('Use blog description',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%BLOG_URL%</b> - '.__('Use blog url',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%ARCHIVE_TITLE%</b> - '.__('Use archive name',$this->plugin_text_domain).'</p>';
+				 	$html .= '<p><b>%BLOG_TITLE%</b> - '.__('Use blog name',$this->ptd).'</p>';
+					$html .= '<p><b>%BLOG_DESCRIPTION%</b> - '.__('Use blog description',$this->ptd).'</p>';
+					$html .= '<p><b>%BLOG_URL%</b> - '.__('Use blog url',$this->ptd).'</p>';
+					$html .= '<p><b>%ARCHIVE_TITLE%</b> - '.__('Use archive name',$this->ptd).'</p>';
 				$html .= '</div>';
 			break;
 			case 'author':
 				$html .= '<div class="awd_pre">';
-					$html .= '<p><b>%BLOG_TITLE%</b> - '.__('Use blog name',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%BLOG_DESCRIPTION%</b> - '.__('Use blog description',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%BLOG_URL%</b> - '.__('Use blog url',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%AUTHOR_TITLE%</b> - '.__('Use title of post',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%AUTHOR_IMAGE%</b> - '.__('Use excerpt',$this->plugin_text_domain).'</p>';
+					$html .= '<p><b>%BLOG_TITLE%</b> - '.__('Use blog name',$this->ptd).'</p>';
+					$html .= '<p><b>%BLOG_DESCRIPTION%</b> - '.__('Use blog description',$this->ptd).'</p>';
+					$html .= '<p><b>%BLOG_URL%</b> - '.__('Use blog url',$this->ptd).'</p>';
+					$html .= '<p><b>%AUTHOR_TITLE%</b> - '.__('Use title of post',$this->ptd).'</p>';
+					$html .= '<p><b>%AUTHOR_IMAGE%</b> - '.__('Use excerpt',$this->ptd).'</p>';
 					$html .= '<p><b>%AUTHOR_DESCRIPTION%</b></p>';
 				$html .= '</div>';
 			break;
@@ -727,273 +751,44 @@ Class AWD_facebook
 			case 'page':
 			default:
 				$html .= '<div class="awd_pre">';
-					$html .= '<p><b>%BLOG_TITLE%</b> - '.__('Use blog name',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%BLOG_DESCRIPTION%</b> - '.__('Use blog description',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%BLOG_URL%</b> - '.__('Use blog url',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%POST_TITLE%</b> - '.__('Use title of post',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%POST_EXCERPT%</b> - '.__('Use excerpt',$this->plugin_text_domain).'</p>';
-					$html .= '<p><b>%POST_IMAGE%</b> - '.__('Use featured image (if activated)',$this->plugin_text_domain).'</p>';
+					$html .= '<p><b>%BLOG_TITLE%</b> - '.__('Use blog name',$this->ptd).'</p>';
+					$html .= '<p><b>%BLOG_DESCRIPTION%</b> - '.__('Use blog description',$this->ptd).'</p>';
+					$html .= '<p><b>%BLOG_URL%</b> - '.__('Use blog url',$this->ptd).'</p>';
+					$html .= '<p><b>%POST_TITLE%</b> - '.__('Use title of post',$this->ptd).'</p>';
+					$html .= '<p><b>%POST_EXCERPT%</b> - '.__('Use excerpt',$this->ptd).'</p>';
+					$html .= '<p><b>%POST_IMAGE%</b> - '.__('Use featured image (if activated)',$this->ptd).'</p>';
 				$html .= '</div>';
 		}
 		return $html;
 	}
 	
-	
-	/**
-	 * Feeds functions
-	 */
-	protected function get_documentation_feed_config()
-	{
-		return array(
-			'link' => 'http://facebook-awd.ahwebdev.fr/documentation/',
-			'url' => 'http://facebook-awd.ahwebdev.fr/feed/?post_type=page&parent=220',
-			'title' => $this->plugin_name.' Documentation',
-			'items' => 100,
-			'show_summary' => 1,
-			'show_author' => 0,
-			'show_date' => 0,
-		);
-	}
-	
-	protected function get_plugins_feed_config()
-	{
-		return array(
-			'link' => 'http://facebook-awd.ahwebdev.fr/plugins/',
-			'url' => 'http://facebook-awd.ahwebdev.fr/feed/?post_type=btp_work',
-			'title' => $this->plugin_name.' Plugins list',
-			'items' => 100,
-			'show_summary' => 1,
-			'show_author' => 0,
-			'show_date' => 0,
-		);
-	}
-	
-	protected function get_news_feed_config()
-	{
-		return array(
-			'link' => 'http://facebook-awd.ahwebdev.fr/',
-			'url' => 'http://facebook-awd.ahwebdev.fr/feed/',
-			'title' => $this->plugin_name.' News',
-			'items' => 100,
-			'show_summary' => 1,
-			'show_author' => 0,
-			'show_date' => 0,
-		);
-	}
-	
-	public function get_documentation_feed()
-	{
-		$widget_awd_rss = $this->get_documentation_feed_config();
-		return '
-		<h1>'.__('Documentation',$this->plugin_text_domain).'</h1>
-		<div class="row">
-			<div class="span6">'.$this->admin_get_feeds($widget_awd_rss).'</div>
-			<div class="span2">'."
-				<a name='b_54c8ac3055ea012fbb7e000d60d4c902'></a><object type='application/x-shockwave-flash' data='https://giving.paypallabs.com/flash/badge.swf' width='205' height='350' id='badge54c8ac3055ea012fbb7e000d60d4c902' align='middle'>
-				<param name='allowScriptAccess' value='always' />
-				<param name='allowNetworking' value='all' />
-				<param name='movie' value='https://giving.paypallabs.com/flash/badge.swf' />
-				<param name='quality' value='high' />
-				<param name='bgcolor' value='#FFFFFF' />
-				<param name='wmode' value='transparent' />
-				<param name='FlashVars' value='Id=54c8ac3055ea012fbb7e000d60d4c902'/>
-				<embed src='https://giving.paypallabs.com/flash/badge.swf' FlashVars='Id=54c8ac3055ea012fbb7e000d60d4c902' quality='high' bgcolor='#FFFFFF' wmode='transparent' width='205' height='350' Id='badge54c8ac3055ea012fbb7e000d60d4c902' align='middle' allowScriptAccess='always' allowNetworking='all' type='application/x-shockwave-flash' pluginspage='http://www.macromedia.com/go/getflashplayer'></embed>
-				</object>".'
-			</div>
-		</div>
-		';	
-	}
-	
-	public function get_plugins_feed()
-	{
-		$widget_awd_rss = $this->get_plugins_feed_config();
-		return '
-		<h1>'.__('Plugins for Facebook AWD',$this->plugin_text_domain).'</h1>
-		<div class="row">
-			<div class="span6">'.$this->admin_get_feeds($widget_awd_rss).'</div>
-			<div class="span2">'."
-				<a name='b_54c8ac3055ea012fbb7e000d60d4c902'></a><object type='application/x-shockwave-flash' data='https://giving.paypallabs.com/flash/badge.swf' width='205' height='350' id='badge54c8ac3055ea012fbb7e000d60d4c902' align='middle'>
-				<param name='allowScriptAccess' value='always' />
-				<param name='allowNetworking' value='all' />
-				<param name='movie' value='https://giving.paypallabs.com/flash/badge.swf' />
-				<param name='quality' value='high' />
-				<param name='bgcolor' value='#FFFFFF' />
-				<param name='wmode' value='transparent' />
-				<param name='FlashVars' value='Id=54c8ac3055ea012fbb7e000d60d4c902'/>
-				<embed src='https://giving.paypallabs.com/flash/badge.swf' FlashVars='Id=54c8ac3055ea012fbb7e000d60d4c902' quality='high' bgcolor='#FFFFFF' wmode='transparent' width='205' height='350' Id='badge54c8ac3055ea012fbb7e000d60d4c902' align='middle' allowScriptAccess='always' allowNetworking='all' type='application/x-shockwave-flash' pluginspage='http://www.macromedia.com/go/getflashplayer'></embed>
-				</object>".'
-			</div>
-		</div>
-		';	
-	}
-	
-	public function get_feed_meta_box($post, $widget_awd_rss)
-	{
-		echo $this->admin_get_feeds($widget_awd_rss['args']);			
-	}
-	
-	/**
-	 * Fetch Feed infos in admin side.
-	 * Rss Feed $url
-	 */
-	 public function admin_get_feeds($widget_awd_rss)
-	 {
-	 	$html = '';
-		$rss = @fetch_feed( $widget_awd_rss['url'] );
-		if ( is_wp_error($rss) ) {
-			if ( is_admin() || current_user_can('manage_options') ) {
-				$html .='<div class="rss-widget"><p>';
-				$html .= sprintf(__('<strong>RSS Error</strong>: %s'), $rss->get_error_message());
-				$html .= '</p></div>';
-			}
-		} elseif ( !$rss->get_item_quantity() ) {
-			$rss->__destruct();
-			unset($rss);
-			return false;
-		} else {
-			$html .= '<div class="rss-widget">';
-			$html .= $this->wp_widget_rss_output( $rss, $widget_awd_rss );
-			$html .= '</div>';
-			$rss->__destruct();
-			unset($rss);
-		}
-		return $html;
-	}
-	
-	/**
-	 * Display the RSS entries in a list.
-	 *
-	 * @since 2.5.0
-	 *
-	 * @param string|array|object $rss RSS url.
-	 * @param array $args Widget arguments.
-	 */
-	public function wp_widget_rss_output( $rss, $args = array() ) {
-		$html = '';
-		if ( is_string( $rss ) ) {
-			$rss = fetch_feed($rss);
-		} elseif ( is_array($rss) && isset($rss['url']) ) {
-			$args = $rss;
-			$rss = fetch_feed($rss['url']);
-		} elseif ( !is_object($rss) ) {
-			return;
-		}
-	
-		if ( is_wp_error($rss) ) {
-			if ( is_admin() || current_user_can('manage_options') )
-				echo '<p>' . sprintf( __('<strong>RSS Error</strong>: %s'), $rss->get_error_message() ) . '</p>';
-			return;
-		}
-	
-		$default_args = array( 'show_author' => 0, 'show_date' => 0, 'show_summary' => 0 );
-		$args = wp_parse_args( $args, $default_args );
-		extract( $args, EXTR_SKIP );
-	
-		$items = (int) $items;
-		if ( $items < 1 || 20 < $items )
-			$items = 10;
-		$show_summary  = (int) $show_summary;
-		$show_author   = (int) $show_author;
-		$show_date     = (int) $show_date;
-	
-		if ( !$rss->get_item_quantity() ) {
-			$html .=  '<ul><li>' . __( 'An error has occurred; the feed is probably down. Try again later.' ) . '</li></ul>';
-			$rss->__destruct();
-			unset($rss);
-			return;
-		}
-	
-		$html .= '<ul class="thumbnails">';
-		foreach ( $rss->get_items(0, $items) as $item ) {
-			$link = $item->get_link();
-			while ( stristr($link, 'http') != $link )
-				$link = substr($link, 1);
-			$link = esc_url(strip_tags($link));
-			$title = esc_attr(strip_tags($item->get_title()));
-			if ( empty($title) )
-				$title = __('Untitled');
-			$desc = str_replace( array("\n", "\r"), ' ', esc_attr( strip_tags( @html_entity_decode( $item->get_description(), ENT_QUOTES, get_option('blog_charset') ) ) ) );
-			$desc = wp_html_excerpt( $desc, 360 );
-	
-			// Append ellipsis. Change existing [...] to [&hellip;].
-			if ( '[...]' == substr( $desc, -5 ) )
-				$desc = substr( $desc, 0, -5 ) . '[&hellip;]';
-			elseif ( '[&hellip;]' != substr( $desc, -10 ) )
-				$desc .= ' [&hellip;]';
-	
-			$desc = esc_html( $desc );
-	
-			if ( $show_summary ) {
-				$summary = "<div class='rssSummary'>$desc</div>";
-			} else {
-				$summary = '';
-			}
-	
-			$date = '';
-			if ( $show_date ) {
-				$date = $item->get_date( 'U' );
-	
-				if ( $date ) {
-					$date = ' <span class="rss-date">' . date_i18n( get_option( 'date_format' ), $date ) . '</span>';
-				}
-			}
-	
-			$author = '';
-			if ( $show_author ) {
-				$author = $item->get_author();
-				if ( is_object($author) ) {
-					$author = $author->get_name();
-					$author = ' <cite>' . esc_html( strip_tags( $author ) ) . '</cite>';
-				}
-			}
-	
-			if ( $link == '' ) {
-				$html .= "<li>$title{$date}{$summary}{$author}</li>";
-			} else {             
-				$html .= '
-				<li class="span3">
-					<div class="thumbnail">
-						<img src="'.$this->catch_that_image($item->get_content()).'" />
-						<h4>'.$title.'</h4>
-						<p>'.$summary.'</p>
-						<p><a class="btn btn-mini btn-success" href="'.$link.'" title="'.$desc.'"><i class="icon-download-alt icon-white"></i> '.__('Download',$this->plugin_text_domain).'</a><p>
-					</div>   
-				</li>';
-			
-			}
-		}
-		$html .= '</ul>';
-		$rss->__destruct();
-		unset($rss);
-		return $html;
-	}
-	
-	
 	/**
 	 * Admin Infos
 	 * @return void
 	 */
 	public function general_content()
 	{
-		echo '<h2>'.__('Plugins installed',$this->plugin_text_domain).'</h2>';
-		if(is_array($this->plugins) && count($this->plugins)){
-			foreach($this->plugins as $plugin){
+		if(current_user_can('manage_facebook_awd_settings')){
+			echo '<h2>'.__('Plugins installed',$this->ptd).'</h2>';
+			if(is_array($this->plugins) && count($this->plugins)){
+				foreach($this->plugins as $plugin){
+					echo'
+					<p><span class="label label-success">
+						'.$plugin->plugin_name.'
+						<small>v'.$plugin->get_version().'</small>
+					</span></p>';
+				}
+			}else{
 				echo'
-				<p><span class="label label-success">
-					'.$plugin->plugin_name.'
-					<small>v'.$plugin->get_version().'</small>
-				</span></p>';
+				<p><span class="label label-inverse">'.__('No plugin found',$this->ptd).'</span></p>';
 			}
-		}else{
 			echo'
-			<p><span class="label label-inverse">'.__('No plugin found',$this->plugin_text_domain).'</span></p>';
+			<p><a href="http://facebook-awd.ahwebdev.fr/plugins/" class="btn btn-important" target="blank">'.__('Find plugins',$this->ptd).'</a></p>';
 		}
-		echo'
-		<p><a href="http://facebook-awd.ahwebdev.fr/plugins/" class="btn btn-important" target="blank">'.__('Find plugins',$this->plugin_text_domain).'</a></p>';
 		
-		echo '<h4>'.__('Follow me on Facebook',$this->plugin_text_domain).'</h4>';
+		echo '<h4>'.__('Follow me on Facebook',$this->ptd).'</h4>';
 		echo do_shortcode('[AWD_likebox href="https://www.facebook.com/Ahwebdev" colorscheme="light" stream="0" show_faces="0" xfbml="0" header="0" width="257" height="60"]');
-		echo '<h4>'.__('Follow me on Twitter',$this->plugin_text_domain).'</h4>
+		echo '<h4>'.__('Follow me on Twitter',$this->ptd).'</h4>
 		<a href="https://twitter.com/ah_webdev" class="twitter-follow-button" data-show-count="false" data-size="large" data-show-screen-name="true">Follow @ah_webdev</a>
 		<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
 		';
@@ -1022,12 +817,10 @@ Class AWD_facebook
 		if(is_object($this->fcbk)){
 			try{
 				$app_info = $this->fcbk->api('/'.$this->options['app_id']);
-				$this->optionsManager->update_option('app_infos', $app_info, true);
-				$this->options = $this->optionsManager->getOptions();
+				$this->options['app_infos'] = $this->optionsManager->updateOption('app_infos', $app_info, true);
 			}catch(Exception $e){
-				$this->optionsManager->update_option('app_infos', '', true);
-				$this->options = $this->optionsManager->getOptions();
-				return $this->return_error($e);
+				$this->options['app_infos'] = $this->optionsManager->updateOption('app_infos', array(), true);
+				return new WP_Error($e->getCode(), $e->getMessage());
 			}
 		}
 		return false;
@@ -1039,25 +832,23 @@ Class AWD_facebook
 	 */
 	public function app_infos_content()
 	{	
-	
+		
 		$infos = $this->options['app_infos'];
 		if(empty($infos)){
-			?>
-			<div class="alert alert-error"><?php _e('You must set a valid Facebook Application ID and Secret Key and your Facebook User ID in settings.',$this->plugin_text_domain); ?></div>
-			<br />
-			<a href="#" id="reload_app_infos" class="btn btn-danger" data-loading-text="<i class='icon-time icon-white'></i> Testing..."><i class="icon-refresh icon-white"></i> <?php _e('Reload',$this->plugin_text_domain); ?></a>
-			<?php
+			$error = new WP_Error('AWD_facebook_not_ready', __('You must set a valid Facebook Application ID and Secret Key and your Facebook User ID in settings.',$this->ptd));
+			echo $error->get_error_message();
+			echo '<br /><a href="#" id="reload_app_infos" class="btn btn-danger" data-loading-text="<i class=\'icon-time icon-white\'></i> Testing... "><i class="icon-refresh icon-white"></i> '.__('Reload',$this->ptd).'</a>';
 		}else{
 			?>
 			<div id="awd_app">
 				<table class="table table-condensed">
 					<thead>
-						<th><?php _e('Info' ,$this->plugin_text_domain); ?></th>
-						<th><?php _e('Value' ,$this->plugin_text_domain); ?></th>
+						<th><?php _e('Info' ,$this->ptd); ?></th>
+						<th><?php _e('Value' ,$this->ptd); ?></th>
 					</thead>
 					<tbody>
 						<tr>
-							<th><?php _e('Name' ,$this->plugin_text_domain); ?>:</th>
+							<th><?php _e('Name' ,$this->ptd); ?>:</th>
 							<td><?php echo $infos['name']; ?></td>
 						</tr>
 						<tr>
@@ -1065,30 +856,34 @@ Class AWD_facebook
 							<td><?php echo $infos['id']; ?></td>
 						</tr>
 						<tr>
-							<th><?php _e('Link' ,$this->plugin_text_domain); ?>:</th>
+							<th><?php _e('Link' ,$this->ptd); ?>:</th>
 							<td><a href="<?php echo $infos['link']; ?>" target="_blank">View App</a></td>
 						</tr>
 						<tr>
-							<th><?php _e('Namespace' ,$this->plugin_text_domain); ?>:</th>
+							<th><?php _e('Namespace' ,$this->ptd); ?>:</th>
 							<td><?php echo $infos['namespace']; ?></td>
 						</tr>
 						<tr>
-							<th><?php _e('Daily active users' ,$this->plugin_text_domain); ?>:</th>
-							<td class="app_active_users"><?php echo $infos['daily_active_users']; ?></td>
+							<th><?php _e('Daily active users' ,$this->ptd); ?>:</th>
+							<td class="app_active_users"><?php echo isset($infos['daily_active_users']) ? $infos['daily_active_users'] : 0; ?></td>
 						</tr>
 						<tr>
-							<th><?php _e('Weekly active users' ,$this->plugin_text_domain); ?>:</th>
-							<td class="app_active_users"><?php echo $infos['weekly_active_users']; ?></td>
+							<th><?php _e('Weekly active users' ,$this->ptd); ?>:</th>
+							<td class="app_active_users"><?php echo isset($infos['weekly_active_users']) ? $infos['weekly_active_users'] : 0; ?></td>
 						</tr>
 						<tr>
-							<th><?php _e('Monthly active users' ,$this->plugin_text_domain); ?>:</th>
-							<td class="app_active_users"><?php echo $infos['monthly_active_users']; ?></td>
+							<th><?php _e('Monthly active users' ,$this->ptd); ?>:</th>
+							<td class="app_active_users"><?php echo isset($infos['monthly_active_users']) ? $infos['monthly_active_users'] : 0; ?></td>
 						</tr>
 					</tbody>
 					<tfoot>
 						<tr>
 							<th><img src="<?php echo $infos['logo_url']; ?>" class="thumbnail"/></th>
-							<td><a href="#" id="reload_app_infos" class="btn btnNormal" data-loading-text="<i class='icon-time'></i> Loading..."><i class="icon-wrench"></i> <?php _e('Test Settings',$this->plugin_text_domain); ?></a></td>
+							<?php if(current_user_can('manage_facebook_awd_settings')){ ?>
+								<td><a href="#" id="reload_app_infos" class="btn btnNormal" data-loading-text="<i class='icon-time'></i> Loading..."><i class="icon-wrench"></i> <?php _e('Test Settings',$this->ptd); ?></a></td>
+							<?php }else{ ?>
+								<td></td>
+							<?php } ?>
 						</tr>
 					</tfoot>
 				</table>
@@ -1177,9 +972,9 @@ Class AWD_facebook
 					<td><strong>'.$object['object_title'].'</strong></td>
 					<td>
 						<div class="btn-group pull-right" data-object-id="'.$object['id'].'">
-							<button class="btn btn-mini awd_edit_opengraph_object"><i class="icon-edit"></i> '.__('Edit',$this->plugin_text_domain).'</button>
-							<button class="btn btn-mini awd_edit_opengraph_object copy"><i class="icon-share"></i> '.__('Copy',$this->plugin_text_domain).'</button>
-							<button class="btn btn-mini awd_delete_opengraph_object btn-warning"><i class="icon-remove icon-white"></i> '.__('Delete',$this->plugin_text_domain).'</button>
+							<button class="btn btn-mini awd_edit_opengraph_object"><i class="icon-edit"></i> '.__('Edit',$this->ptd).'</button>
+							<button class="btn btn-mini awd_edit_opengraph_object copy"><i class="icon-share"></i> '.__('Copy',$this->ptd).'</button>
+							<button class="btn btn-mini awd_delete_opengraph_object btn-warning"><i class="icon-remove icon-white"></i> '.__('Delete',$this->ptd).'</button>
 						</div>
 					</td>
 				</tr>';
@@ -1200,7 +995,7 @@ Class AWD_facebook
 			
 			//verification submitted value
 			if($opengraph_object['object_title'] == '')
-				$opengraph_object['object_title'] = __('Default Opengraph Object', $this->plugin_text_domain);
+				$opengraph_object['object_title'] = __('Default Opengraph Object', $this->ptd);
 			
 			//Check if the id  of the object was supplied
 			if($opengraph_object['id'] == '')
@@ -1213,8 +1008,7 @@ Class AWD_facebook
 				$this->options['opengraph_objects'][$opengraph_object['id']] = $opengraph_object;
 			}
 			//save with option manager
-			$this->optionsManager->update_option('opengraph_objects',$this->options['opengraph_objects'], true);
-			$this->options = $this->optionsManager->getOptions();
+			$this->options['opengraph_objects'] = $this->optionsManager->updateOption('opengraph_objects',$this->options['opengraph_objects'], true);
 			echo json_encode(array(
 				'success'=>1, 
 				'item'=> $this->get_open_graph_object_list_item($opengraph_object),
@@ -1238,10 +1032,8 @@ Class AWD_facebook
 				foreach($_POST[$this->plugin_option_pref.'opengraph_object_link'] as $context=>$object_id){
 					$opengraph_object_links[$context] = $object_id;
 				}
-				$this->options['opengraph_object_links'] = $opengraph_object_links;
 				//save with option manager
-				$this->optionsManager->update_option('opengraph_object_links',$this->options['opengraph_object_links'], true);
-				$this->options = $this->optionsManager->getOptions();
+				$this->options['opengraph_object_links'] = $this->optionsManager->updateOption('opengraph_object_links',$opengraph_object_links, true);
 				echo json_encode(array(
 					'success'=>1
 				));
@@ -1254,8 +1046,8 @@ Class AWD_facebook
 	{
 		$object_id = $_POST['object_id'];
 		unset($this->options['opengraph_objects'][$object_id]);
-		//delete relation here ?
-		$this->optionsManager->update_option('opengraph_objects', $this->options['opengraph_objects'], true);
+		
+		$this->options['opengraph_objects'] = $this->optionsManager->updateOption('opengraph_objects', $this->options['opengraph_objects'], true);
 		echo json_encode(array(
 			'success'=>1,
 			'count'=> count($this->options['opengraph_objects']),
@@ -1309,13 +1101,7 @@ Class AWD_facebook
 		$html = ''; 
 		$form = new AWD_facebook_form('form_create_opengraph_object_links', 'POST', '', $this->plugin_option_pref);
 		$ogp_objects = apply_filters('AWD_facebook_ogp_objects', $this->options['opengraph_objects']);
-		$page_contexts = array(
-			'frontpage' => __('Frontpage',$this->plugin_text_domain),
-			'page' => __('Pages',$this->plugin_text_domain),
-			'post' => __('Posts',$this->plugin_text_domain),
-			'archive' => __('Archives',$this->plugin_text_domain),
-			'author' => __('Authors',$this->plugin_text_domain),				
-		);
+		$page_contexts = $this->options['opengraph_contexts'];
 		$taxonomies = get_taxonomies(array('public'=> true,'show_ui'=>true),'objects');
 		if(!empty($taxonomies)){
 			foreach($taxonomies as $taxonomie_name=>$tax_values){
@@ -1337,15 +1123,15 @@ Class AWD_facebook
 		if(is_array($ogp_objects) && count($ogp_objects)){
 			foreach($page_contexts as $key=>$context){
 				$options = array();
-				$options[] = array('value'=>'', 'label'=> __('Disabled', $this->plugin_text_domain));
+				$options[] = array('value'=>'', 'label'=> __('Disabled', $this->ptd));
 				$linked_object = isset($this->options['opengraph_object_links'][$key]) ? $this->options['opengraph_object_links'][$key] : '';
-				foreach($ogp_objects as $ogp_object){
-					$options[] = array('value'=>$ogp_object['id'], 'label'=> $ogp_object['object_title']);
+				foreach($ogp_objects as $key=>$ogp_object){
+					$options[] = array('value'=> $key, 'label'=> $ogp_object['object_title']);
 				}
-				$html.= $form->addSelect( __('Choose Opengraph object for',$this->plugin_text_domain).' '.$context, 'opengraph_object_link['.$key.']', $options, $linked_object, 'span4', array('class'=>'span4'));
+				$html.= $form->addSelect( __('Choose Opengraph object for',$this->ptd).' '.$context, 'opengraph_object_link['.$key.']', $options, $linked_object, 'span4', array('class'=>'span4'));
 			}
 		}else{
-			$html.= '<p class="alert alert-warning">'.__('No Object found',$this->plugin_text_domain).'</p></td>';
+			$html.= $this->display_messages(__('No Object found',$this->ptd), 'warning', false);
 		}
 		$html.= wp_nonce_field($this->plugin_slug.'_update_object_links',$this->plugin_option_pref.'_nonce_options_object_links',null,false);
 		$html.= $form->end();
@@ -1378,11 +1164,11 @@ Class AWD_facebook
 			case is_front_page():
 			case is_home():
 				$array_replace = array($blog_name,$blog_description,$home_url);
-				$linked_object = $this->options['opengraph_object_links']['frontpage'];
+				$linked_object = isset($this->options['opengraph_object_links']['frontpage']) ? $this->options['opengraph_object_links']['frontpage'] : null;
 			break;
 			
 			case is_author():
-				$linked_object = $this->options['opengraph_object_links']['author'];
+				$linked_object = isset($this->options['opengraph_object_links']['author']) ? $this->options['opengraph_object_links']['author'] : null;
 				$current_author = get_user_by('slug',$wp_query->query_vars['author_name']);
 				$avatar = get_avatar($current_author->ID, '50');
 				if($avatar) $gravatar_attributes = simplexml_load_string($avatar);
@@ -1392,37 +1178,38 @@ Class AWD_facebook
 			case is_archive():
 				switch(1){
 					case is_tag():
-						$linked_object = $this->options['opengraph_object_links']['post_tag'];
+						$linked_object = isset($this->options['opengraph_object_links']['post_tag']) ? $this->options['opengraph_object_links']['post_tag'] : null;
 						$array_replace = array($blog_name,$blog_description,$home_url,trim(wp_title('',false)),'','',$this->get_current_url());
 					break;
 					case is_tax():
 						$taxonomy_slug = $wp_query->query_vars['taxonomy'];
-						$linked_object = $this->options['opengraph_object_links'][$taxonomy_slug];
+						$linked_object = isset($this->options['opengraph_object_links'][$taxonomy_slug]) ? $this->options['opengraph_object_links'][$taxonomy_slug] : null;
 						$array_replace = array($blog_name,$blog_description,$home_url,trim(wp_title('',false)),term_description(),'',$this->get_current_url());
 					break;
 					case is_category():
-						$linked_object = $this->options['opengraph_object_links']['category'];
+						$linked_object = isset($this->options['opengraph_object_links']['category']) ? $this->options['opengraph_object_links']['category'] : null;
 						$array_replace = array($blog_name,$blog_description,$home_url,trim(wp_title('',false)),category_description(),'',$this->get_current_url());
 					break;
 					default:
-						$linked_object = $this->options['opengraph_object_links']['archive'];
+						$linked_object = isset($this->options['opengraph_object_links']['archive']) ? $this->options['opengraph_object_links']['archive'] : null;
 						$array_replace = array($blog_name,$blog_description,$home_url,trim(wp_title('',false)),'','',$this->get_current_url());
 					break;
 				}
 			break;
 			case is_attachment():
-				$linked_object = $this->options['opengraph_object_links']['attachment'];
+				$linked_object = isset($this->options['opengraph_object_links']['attachment']) ? $this->options['opengraph_object_links']['attachment'] : null;
 				$array_replace = array($blog_name,$blog_description,$home_url,trim(wp_title('',false)),'','',$this->get_current_url());
 			break;
 			case is_page():
 			case is_single():
-				$linked_object = $this->options['opengraph_object_links'][(is_single() ? 'post' : 'page')];
+				$linked_object = isset($this->options['opengraph_object_links'][(is_single() ? 'post' : 'page')]) ? $this->options['opengraph_object_links'][(is_single() ? 'post' : 'page')] : null;
+				$img = '';
 				if(current_theme_supports('post-thumbnails')){
 					if(has_post_thumbnail($post->ID)){
 						$img = $this->catch_that_image(get_the_post_thumbnail($post->ID, 'AWD_facebook_ogimage'));
 					}
 				}
-                if($img == ""){
+                if(empty($img)){
                 	if(isset($this->options['app_infos']['logo_url']))
                 		$img = $this->options['app_infos']['logo_url'];
                 }
@@ -1434,9 +1221,20 @@ Class AWD_facebook
 				$array_replace = array($blog_name,$blog_description,$home_url,$post->post_title,$description,$img,get_permalink($post->ID));
 			break;
 		}
+		
+		//redefine object type from post if value is set
+		$set_from_post = 0;
+		if(is_object($post)){
+			$custom = get_post_meta($post->ID, $this->plugin_slug, true);
+			if(isset($custom['opengraph']['object_link'])){
+				$set_from_post = 1;
+				$linked_object = $custom['opengraph']['object_link'];
+			}
+		}
 
-		//define object value depending on TYPE
-		$object_template = $this->options['opengraph_objects'][$linked_object];
+		//define object value depending on object
+		$object_template = isset($this->options['opengraph_objects'][$linked_object]) ? $this->options['opengraph_objects'][$linked_object] : null;
+		
 		if(is_array($object_template)){
 			foreach($object_template as $field=>$value){
 				$value = str_replace($array_pattern, $array_replace, $value);
@@ -1444,7 +1242,7 @@ Class AWD_facebook
 			}
 			//construct related ogp object
 			$ogp = $this->opengraph_array_to_object($object_template);
-			echo '<!-- '.$this->plugin_name.' Opengraph [v'.$this->get_version().'] (object reference: "'.$object_template['object_title'].'") -->'."\n";
+			echo '<!-- '.$this->plugin_name.' Opengraph [v'.$this->get_version().'] (object reference: "'.$object_template['object_title'].'" '.($set_from_post == 1 ? 'Defined from post' : '').') -->'."\n";
 			echo $ogp->toHTML();
 			echo "\n".'<!-- '.$this->plugin_name.' END Opengraph -->'."\n";
 		}
@@ -1474,7 +1272,7 @@ Class AWD_facebook
 	 */
 	public function support()
 	{
-		//$html='<h1>'.__("Support",$this->plugin_text_domain).'</h1>';
+		//$html='<h1>'.__("Support",$this->ptd).'</h1>';
 		//return $html;
 	}
 
@@ -1518,15 +1316,15 @@ Class AWD_facebook
 	{
 		$options = array(
 			'width' => 200,
-			'logout_label' => '<i class="icon-off icon-white"></i> '.__("Logout",$this->plugin_text_domain)
+			'logout_label' => '<i class="icon-off icon-white"></i> '.__("Logout",$this->ptd)
 		);
 		if($this->is_user_logged_in_facebook()){
 			echo $this->get_the_login_button($options);
-			echo '<p class="alert alert-info">'.sprintf(__("%s Facebook ID: %s",$this->plugin_text_domain),'<i class="icon-user"></i> ',$this->uid).'</p>';
+			$this->display_messages(sprintf(__("%s Facebook ID: %s",$this->ptd),'<i class="icon-user"></i> ',$this->uid));
 		}else if($this->options['connect_enable']){
-			echo '<a href="#" class="AWD_facebook_connect_button btn btn-info"><i class="icon-user icon-white"></i> '.__("Login with Facebook",$this->plugin_text_domain).'</a>';
+			echo '<a href="#" class="AWD_facebook_connect_button btn btn-info"><i class="icon-user icon-white"></i> '.__("Login with Facebook",$this->ptd).'</a>';
 		}else{
-			echo '<div class="alert alert-warning">'.sprintf(__('You should enable FB connect in %sApp settings%s',$this->plugin_text_domain),'<a href="admin.php?page='.$this->plugin_slug.'">','</a>').'</div>';
+			$this->display_messages(sprintf(__('You should enable FB connect in %sApp settings%s',$this->ptd),'<a href="admin.php?page='.$this->plugin_slug.'">','</a>'), 'warning');
 		}
 	}
 	
@@ -1568,23 +1366,34 @@ Class AWD_facebook
 					$is_term_to_exclude = true;
 			}
 		
-		$custom = get_post_custom($post->ID);
-	 	//enable by default lke button
-	 	if($custom[$this->plugin_option_pref.'like_button_redefine'][0] == 1){
+		$custom = get_post_meta($post->ID, $this->plugin_slug, true);
+		if(!is_array($custom)){
+			$custom = array();
+		}
+		$options = array_merge($this->options['content_manager'], $custom);
+
+	 	//enable by default like button
+	 	if(isset($options['like_button']['redefine']) && $options['like_button']['redefine'] == 1){
 	 		$like_button = $this->get_the_like_button($post);
-	 		if($custom[$this->plugin_option_pref.'like_button_enabled'][0] == 1){
-	 			if($custom[$this->plugin_option_pref.'like_button_place'][0] == 'bottom')
+	 		if($options['like_button']['enabled'] == 1){
+	 			if($options['like_button']['place'] == 'bottom')
 					return $content.$like_button;
-				elseif($custom[$this->plugin_option_pref.'like_button_place'][0] == 'both')
+				elseif($options['like_button']['place'] == 'both')
 					return $like_button.$content.$like_button;
-				elseif($custom[$this->plugin_option_pref.'like_button_place'][0] == 'top')
+				elseif($options['like_button']['place'] == 'top')
 				    return $like_button.$content;
-				    
-				echo $custom[$this->plugin_option_pref.'like_button_place'][0];
 			}else{
 				return $content;
 			}
-		}elseif(!in_array($post->post_type,$exclude_post_type) && !in_array($post->ID,$exclude_post_page_id) && !$is_term_to_exclude && $custom[$this->plugin_option_pref.'like_button_enabled'][0] == 1 OR $custom[$this->plugin_option_pref.'like_button_enabled'][0] == ''){
+		}elseif(
+				//if
+				//no in posts to exclude
+				!in_array($post->post_type,$exclude_post_type)
+				//no in pages to exclude
+				&& !in_array($post->ID,$exclude_post_page_id)
+				//no in terms to exclude
+				&& !$is_term_to_exclude
+			){
 			$like_button = $this->get_the_like_button($post);
 			if($post->post_type == 'page' && $this->options['like_button']['on_pages']){
 				if($this->options['like_button']['place_on_pages'] == 'bottom')
@@ -1675,8 +1484,7 @@ Class AWD_facebook
 					//try to post batch request to publish on all pages asked + profile at one time
 					$post_id = $this->fcbk->api($feed_dir, 'POST', $params);
 				}catch (FacebookApiException $e) { 
-				    error_log("Facebook AWD Publish to Facebook Error:  ".$e->getMessage());
-					$this->messages[] = $this->return_error($e);
+					$this->errors[] = new WP_Error($e->getCode(), $e->getMessage());
 					$this->optionsManager->setOptions($this->options);
 					$this->optionsManager->save();
 				}
@@ -1696,7 +1504,7 @@ Class AWD_facebook
 				$post_id = $this->fcbk->api($feed_dir, 'POST', $params);
 			}catch (FacebookApiException $e) { 
 				error_log("Facebook AWD Publish to Facebook Error:  ".$e->getMessage());
-				$this->messages[] = $this->return_error($e);
+				$this->error[] = new WP_Error($e->getCode(), $e->getMessage());
 				$this->optionsManager->setOptions($this->options);
 				$this->optionsManager->save();
 			}
@@ -1715,7 +1523,6 @@ Class AWD_facebook
             	$option_name = str_ireplace($this->plugin_option_pref,"",$option);
                 $new_options[$option_name] = $value;
             }
-            
             $this->optionsManager->setOptions($new_options);
             $this->optionsManager->save();
             return true;
@@ -1741,14 +1548,15 @@ Class AWD_facebook
 			if($this->update_options_from_post()){
 				$this->get_facebook_user_data();
 				$this->get_app_info();
-				$this->save_facebook_user_data($this->current_user->ID);
-				$this->messages[] = '<div class="alert alert-success fadeOnload"><p>'.__('Options updated',$this->plugin_text_domain).'</p></div>';
-			}else
-				$this->messages[] = '<div class="alert alert-error"><p>'.__('Options not updated there is an error...',$this->plugin_text_domain).'</p></div>';
+				$this->save_facebook_user_data($this->get_current_user()->ID);
+				$this->messages['success'] = __('Options updated',$this->ptd);
+			}else{
+				$this->errors[] = new WP_Error('AWD_facebook_save_option', __('Options not updated there is an error...',$this->ptd));
+			}
 		
 		}else if(isset($_POST[$this->plugin_option_pref.'_nonce_reset_options']) && wp_verify_nonce($_POST[$this->plugin_option_pref.'_nonce_reset_options'],$this->plugin_slug.'_reset_options')){
 			$this->optionsManager->reset();
-			$this->messages[] = '<div class="alert alert-success fadeOnload"><p>'.__('Options were reseted',$this->plugin_text_domain).'</p></div>';
+			$this->messages['success'] = __('Options were reseted',$this->ptd);
 		}
 	}
 	
@@ -1765,27 +1573,27 @@ Class AWD_facebook
 	{
 		
 		if(current_user_can('read')): ?>
-		<h3><?php _e('Facebook infos',$this->plugin_text_domain); ?></h3>
+		<h3><?php _e('Facebook infos',$this->ptd); ?></h3>
 		<table class="form-table">
 		<tr>
-			<th><label for="fb_email"><?php _e('Facebook Email',$this->plugin_text_domain); ?></label></th>
+			<th><label for="fb_email"><?php _e('Facebook Email',$this->ptd); ?></label></th>
 			<td>
 				<input type="text" name="fb_email" id="fb_email" value="<?php echo esc_attr( get_user_meta($user->ID , 'fb_email', true) ); ?>" class="regular-text" /><br />
-				<span class="description"><?php _e('Enter your Facebook Email',$this->plugin_text_domain); ?></span>
+				<span class="description"><?php _e('Enter your Facebook Email',$this->ptd); ?></span>
 			</td>
 		</tr>
 		<tr>
-			<th><label for="fb_uid"><?php _e('Facebook ID',$this->plugin_text_domain); ?></label></th>
+			<th><label for="fb_uid"><?php _e('Facebook ID',$this->ptd); ?></label></th>
 			<td>
 				<input type="text" name="fb_uid" id="fb_uid" value="<?php echo esc_attr( get_user_meta($user->ID , 'fb_uid', true) ); ?>" class="regular-text" /><br />
-				<span class="description"><?php _e('Enter your Facebook ID',$this->plugin_text_domain); ?></span>
+				<span class="description"><?php _e('Enter your Facebook ID',$this->ptd); ?></span>
 			</td>
 		</tr>
 		<tr>
-			<th><label for="fb_reset"><?php _e('Unsync Facebook Account ?',$this->plugin_text_domain); ?></label></th>
+			<th><label for="fb_reset"><?php _e('Unsync Facebook Account ?',$this->ptd); ?></label></th>
 			<td>
 				<input type="checkbox" name="fb_reset" id="fb_reset" value="1" /><br />
-				<span class="description"><?php _e('Note: This will clear all your facebook data linked with this account, you could login with WP account.',$this->plugin_text_domain); ?></span>
+				<span class="description"><?php _e('Note: This will clear all your facebook data linked with this account.',$this->ptd); ?></span>
 			</td>
 		</tr>
 		</table>
@@ -1800,16 +1608,17 @@ Class AWD_facebook
 	{
 		if (!current_user_can('read', $user_id))
 			return false;
-		if($_POST['fb_reset']){
+		if(isset($_POST['fb_reset'])){
 			wp_redirect($this->_unsync_url);
 			exit();
 		}
-		if($_POST['fb_email'] != ''){
+		if(isset($_POST['fb_email'])){
 			update_user_meta( $user_id, 'fb_email', $_POST['fb_email'] );
 		}
-		if($_POST['fb_uid'] != ''){
+		if(isset($_POST['fb_uid'])){
 			update_user_meta( $user_id, 'fb_uid', $_POST['fb_uid'] );
 		}
+		
 	}
 	
 	//****************************************************************************************
@@ -1836,7 +1645,7 @@ Class AWD_facebook
 	 * Load the javascript sdk Facebook
 	 * @return void
 	 */
-	public function load_sdj_js()
+	public function load_sdk_js()
 	{
 		?>
 		<div id="fb-root"></div>
@@ -1895,6 +1704,7 @@ Class AWD_facebook
 					$fbuid = get_user_meta($user->ID,'fb_uid', true);
 				}
 			}
+			
 			if($fbuid !='' && $fbuid !=0){
                 if( $size <= 64 ){
 			        $type = 'square';
@@ -1923,7 +1733,6 @@ Class AWD_facebook
 					return true;
 			}
 		}
-		
 		return false;
 	}
 	
@@ -1934,40 +1743,45 @@ Class AWD_facebook
 	 */
 	public function get_facebook_user_data()
 	{
-		if($this->is_user_logged_in_facebook()){
+		if($this->uid){
+			$me = array();
 			//Try batch request on user
 			$fb_queries = array(array('method' => 'GET', 'relative_url' => '/me'));
 			$fb_queries[] = array('method' => 'GET', 'relative_url' => '/me/permissions');
 			$fb_queries[] = array('method' => 'GET', 'relative_url' => '/me/accounts');
-			$me = array();
 			//Catch error for new batch request error.
 			try{
-				$batchResponse = $this->fcbk->api('?batch='.urlencode(json_encode($fb_queries)),'POST');
+				$call = '?batch='.urlencode(json_encode($fb_queries));
+				$batchResponse = $this->fcbk->api($call ,'POST');
 				$me = json_decode($batchResponse[0]['body'], true);
 			}catch(FacebookApiException $e){
-				$me['error'] = $e->getMessage();
+				$fb_error = $e->getResult();
+				$error = new WP_Error(403, $this->plugin_name.' Error: '.$fb_error['error']['type'].' '.$fb_error['error']['message']);
+				wp_die($error);				
 			}
 			//Try to find if the batch return error. IF yes, the user acces token is no more good.
 			if(!isset($me['error'])){
 				// Proceed knowing you have a logged in user who's authenticated.
-				$me['AWD_access_token'] = $this->fcbk->getAccessToken();
-				$fb_perms = json_decode($batchResponse[1]['body'], true);
-				$me['permissions'] = $fb_perms['data'][0];
-				$fb_pages = json_decode($batchResponse[2]['body'], true);
-				if(isset($fb_pages['data'])){
-					foreach($fb_pages['data'] as $fb_page){
-						$me['pages'][$fb_page['id']] = $fb_page;
+				$me['permissions'] = '';
+				if(isset($batchResponse[1]['body'])){
+					$perms = json_decode($batchResponse[1]['body'], true);
+					$me['permissions'] = isset($perms['data'][0]) ? $perms['data'][0] : '';
+				}
+				if(isset($batchResponse[2]['body'])){
+					$fb_pages = json_decode($batchResponse[2]['body'], true);
+					if(isset($fb_pages['data'])){
+						foreach($fb_pages['data'] as $fb_page){
+							$me['pages'][$fb_page['id']] = $fb_page;
+						}
 					}
 				}
 				$this->me = $me;
 			}else{
-				$result = array();
-				$result['error_description'] = $me['error']['message'];
-				$result['error_code'] = $me['error']['code'];
-				return new WP_Error($me['error']['code'], $result['error_description']);
-				//manually trow error, since errors are not catched in batch request.
-				//wp_die(new FacebookApiException($result));
+				$error = new WP_Error($me['error']['code'], $this->plugin_name.' Error: (#'.$me['error']['code'].') '.$me['error']['message']);
+				wp_die($error);
 			}
+		}else{
+			//if the error come from access token, try to redirect to login on Facebook page
 		}
 	}
 	
@@ -1979,15 +1793,20 @@ Class AWD_facebook
 		$this->me = get_user_meta($user_id, 'fb_user_infos', true);
 	}
 	public function save_facebook_user_data($user_id){
-		update_user_meta($user_id, 'fb_email', $this->me['email']);
-		update_user_meta($user_id,'fb_user_infos',$this->me);
-		update_user_meta($user_id,'fb_uid',$this->uid);
+		if($this->is_user_logged_in_facebook()){
+			$this->get_facebook_user_data();
+			update_user_meta($user_id, 'fb_email', $this->me['email']);
+			update_user_meta($user_id,'fb_user_infos',$this->me);
+			update_user_meta($user_id,'fb_uid',$this->uid);
+		}else{
+			$this->clear_facebook_user_data($user_id);
+		}
 	}
 	
 	public function clear_facebook_user_data($user_id){
-		delete_user_meta($user_id, 'fb_email');
-		delete_user_meta($user_id,'fb_user_infos');
-		delete_user_meta($user_id,'fb_uid');
+		update_user_meta($user_id, 'fb_email', '');
+		update_user_meta($user_id,'fb_user_infos',array());
+		update_user_meta($user_id,'fb_uid','');
 	}
 	
 	
@@ -1996,7 +1815,6 @@ Class AWD_facebook
 	 * @return int
 	 */
 	public function get_existing_user_from_facebook(){
-		require_once(ABSPATH . WPINC . '/registration.php');
 	    $existing_user = email_exists($this->me['email']);
 	    //if not email, verify in metas.
 	    if(!$existing_user) {
@@ -2019,7 +1837,9 @@ Class AWD_facebook
 	{
 	    if(isset($this->uid) && $this->uid != 0)
 	        return true;
-	    
+	 
+	 	if(is_object($this->fcbk))
+	 		$this->fcbk->destroySession();   
 	    return false;
 	}
 	
@@ -2030,24 +1850,22 @@ Class AWD_facebook
 	*/
 	public function php_sdk_init()
 	{
-		$this->fcbk = new Facebook(array(
-			'appId'  => $this->options['app_id'],
-			'secret' => $this->options['app_secret_key'],
-			'timeOut_AWD' => $this->options['timeout']
-		));
+		$this->fcbk = new AWD_facebook_api($this->options);
+
 		try{
 			$this->uid = $this->fcbk->getUser();
 		}catch(FacebookApiException $e){
 			$this->uid = null;
 		}
+		
 		//Set the current WP user data
-		$this->get_current_user();
-		$this->init_facebook_user_data($this->current_user->ID);
+		$this->init_facebook_user_data($this->get_current_user()->ID);
 		$login_options = array(
 			'scope' => current_user_can("manage_options") ? $this->options["perms_admin"] : $this->options["perms"],
 			'redirect_uri' => $this->_login_url.(get_option('permalink_structure') != '' ? '?' : '&').'redirect_to='.$this->get_current_url()
 		);
 		$this->_oauth_url = $this->fcbk->getLoginUrl($login_options);
+		$this->facebook_page_url = $this->get_facebook_page_url();
 	}
 	
 	/**
@@ -2059,7 +1877,7 @@ Class AWD_facebook
 	{
 		$html = '';
 		if($this->options['connect_enable'] == 1){
-			$html = "\n".'<script type="text/javascript">window.fbAsyncInit = function(){ FB.init({ appId : awd_fcbk.app_id, cookie : true, xfbml : true, oauth : true }); AWD_facebook.FBEventHandler(); };</script>'."\n"; 
+			$html = "\n".'<script type="text/javascript">window.fbAsyncInit = function(){ FB.init({ appId : awd_fcbk.app_id, cookie : true, status: true, xfbml : true, oauth : true }); AWD_facebook.FBEventHandler(); };</script>'."\n"; 
 		}
 		echo $html;
 	}
@@ -2112,7 +1930,7 @@ Class AWD_facebook
 		$userdata = apply_filters( 'AWD_facebook_register_userdata', $userdata);
 		$new_user = wp_insert_user($userdata);
 		//Test the creation							
-		if($new_user->errors){
+		if(isset($new_user->errors)){
 			wp_die($this->Debug($new_user->errors));
 		}
 		if(is_int($new_user)){
@@ -2152,15 +1970,14 @@ Class AWD_facebook
 	}
 	
 	
-	public function login($redirect_url)
+	public function login($redirect_url = '')
 	{
 		$referer = wp_get_referer();
-		if($this->is_user_logged_in_facebook()) {
+		if($this->uid) {
 			$this->get_facebook_user_data();
-			
 			//If user is already logged in and lauch a connect with facebook, try to change info about user account
 			if(is_user_logged_in()){
-				$user_id = $this->current_user->ID;
+				$user_id = $this->get_current_user()->ID;
 			}else{
 				//Found existing user in WP
 				$user_id = $this->get_existing_user_from_facebook();
@@ -2173,15 +1990,14 @@ Class AWD_facebook
 			$this->init_facebook_user_data($user_id);
 			$this->connect_the_user($user_id);
 		}else{
-			wp_redirect(home_url('?awd_fcbk_error=403'));
-			exit();
+			wp_die('Facebook AWD Error: The api cannot connect the user...');
 		}
 		//if we are in an iframe or a canvas page, redirect to
 		if(!empty($this->facebook_page_url)){
 			wp_redirect($this->facebook_page_url);
-		}elseif($redirect_url){
+		}elseif(!empty($redirect_url)){
 			wp_redirect($redirect_url);
-		}elseif($referer){
+		}elseif(!empty($referer)){
 			wp_redirect($referer);
 		}else{
 			wp_redirect(home_url());
@@ -2198,18 +2014,19 @@ Class AWD_facebook
 	{
 		if($this->is_user_logged_in_facebook()){
 			$parsing = parse_url($url);
-			
 			if(get_option('permalink_structure') != '')
-				$redirect_url = str_ireplace('action=logout&amp;','', $this->_logout_url.'?'.$parsing['query']);
+				$redirect_url = str_replace('action=logout&amp;','', $this->_logout_url.'?'.$parsing['query']);
 			else
-				$redirect_url = str_ireplace('action=logout&amp;','', $this->_logout_url.'&'.$parsing['query']);
-				
-			return $this->fcbk->getLogoutUrl(array('next' =>$redirect_url));
+				$redirect_url = str_replace('action=logout&amp;','', $this->_logout_url.'&'.$parsing['query']);
+						
+			$logout_url = $this->fcbk->getLogoutUrl(array('next' => $redirect_url));
+			
+			return $logout_url;
 		}
 		return $url;
 	}
 	
-	public function logout($redirect_url)
+	public function logout($redirect_url = '')
 	{
 		$referer = wp_get_referer();
 		$this->fcbk->destroySession();
@@ -2218,9 +2035,9 @@ Class AWD_facebook
 		//if we are in an iframe or a canvas page, redirect to
 		if(!empty($this->facebook_page_url)){
 			wp_redirect($this->facebook_page_url);
-		}elseif($redirect_url){
+		}elseif(!empty($redirect_url)){
 			wp_redirect($redirect_url);
-		}elseif($referer){
+		}elseif(!empty($referer)){
 			wp_redirect($referer);
 		}else{
 			wp_redirect(home_url());
@@ -2231,13 +2048,11 @@ Class AWD_facebook
 	public function parse_request()
 	{
 		global $wp_query;
-		$this->facebook_page_url = $this->get_facebook_page_url();
 		$query = get_query_var('facebook_awd');
-		
+		$redirect_url = isset($_REQUEST['redirect_to']) ? $_REQUEST['redirect_to'] : '';
 		//Parse the query for internal process
 		if(!empty($query)){
 			$action = $query['action'];
-			$redirect_url = $_REQUEST['redirect_to'];
 			switch($action){
 				//LOGIN
 				case 'login':
@@ -2251,21 +2066,23 @@ Class AWD_facebook
 				
 				//UNSYNC
 				case 'unsync':
-					$this->clear_facebook_user_data($this->current_user->ID);
-					$this->logout($redirect_url);
+					if($this->is_user_logged_in_facebook()){
+						$this->clear_facebook_user_data($this->get_current_user()->ID);
+						wp_redirect(wp_logout_url());
+					}else{
+						wp_redirect(wp_get_referer());
+					}
+					exit();
 				break;
 				
-				//LISTENERS	
-				default:				
-					//if we want to force the login for the entire website.
-					if($this->options['login_required_enable'] == 1)
-						$this->login_required($redirect_url);
-					//listen for any session that is create by facebook and redirected here.
-					//exemple for featured dialogs and force login (php redirect)
-					$this->login_listener($redirect_url);
-				break;
 			}
 		}
+		//if we want to force the login for the entire website.
+		//if($this->options['login_required_enable'] == 1)
+			//$this->login_required($redirect_url);
+		//listen for any session that is create by facebook and redirected here.
+		//exemple for featured dialogs and force login (php redirect)
+		$this->login_listener($redirect_url);
 	}
 	
 	/**
@@ -2324,11 +2141,12 @@ Class AWD_facebook
 		//we set faces options to false, if user not connected
 		$options = array_replace($this->options['login_button'], $options);	
 		$html = '';
+
 		switch(1){
-			case ($this->is_user_logged_in_facebook() && $this->options['connect_enable'] && is_user_logged_in()):
+			case ($this->is_user_logged_in_facebook() && $this->options['connect_enable'] && is_user_logged_in() && count($this->me)):
 				$html .= '<div class="AWD_profile">'."\n";
 				if($options['show_profile_picture'] == 1 && $options['show_faces'] == 0){
-					$html .= '<div class="AWD_profile_image"><a href="'.$this->me['link'].'" target="_blank" class="thumbnail"> '.get_avatar($this->current_user->ID,'50').'</a></div>'."\n";
+					$html .= '<div class="AWD_profile_image"><a href="'.$this->me['link'].'" target="_blank" class="thumbnail"> '.get_avatar($this->get_current_user()->ID,'50').'</a></div>'."\n";
 				}
 				$html .='<div class="AWD_right">'."\n";
 					if($options['show_faces'] == 1){
@@ -2339,7 +2157,7 @@ Class AWD_facebook
 					}
 					//display logout button only if we are not in facebook tab.
 					if($this->facebook_page_url == ''){
-						$html .='<div class="AWD_logout"><a href="'.wp_logout_url($option['logout_redirect_url']).'">'.$option['logout_label'].'</a></div>'."\n";
+						$html .='<div class="AWD_logout"><a href="'.wp_logout_url($options['logout_redirect_url']).'">'.$options['logout_label'].'</a></div>'."\n";
 					}
 				$html .='</div>'."\n";
 				$html .='<div class="clear"></div>'."\n";
@@ -2349,12 +2167,12 @@ Class AWD_facebook
 			case $this->options['connect_enable']:
 				return '
 				<div class="AWD_facebook_login">
-					<a href="'.$this->login_url.'" class="AWD_facebook_connect_button" data-redirect="'.urlencode($option['login_redirect_url']).'"><img src="'.$login_button_image.'" border="0" /></a>
+					<a href="'.$this->_oauth_url.'" class="AWD_facebook_connect_button" data-redirect="'.urlencode($options['login_redirect_url']).'"><img src="'.$options['image'].'" border="0" alt="Login"/></a>
 				</div>'."\n";
 			break;
 			default:
 				if(is_admin())
-					return '<div class="alert alert-warning">'.sprintf(__('You should enable FB connect in %sApp settings%s',$this->plugin_text_domain),'<a href="admin.php?page='.$this->plugin_slug.'">','</a>').'</div>';
+					return $this->display_messages(sprintf(__('You should enable FB connect in %sApp settings%s',$this->ptd),'<a href="admin.php?page='.$this->plugin_slug.'">','</a>'), 'warning', false);
 			break;
 		}
 	}
@@ -2366,15 +2184,15 @@ Class AWD_facebook
 	public function the_login_button_wp_login()
 	{
 		echo'
-		<div class="AWD_facebook_connect_wplogin">
-			<label>'.__('Connect with Facebook',$this->plugin_text_domain).'</label>
+		<div class="AWD_facebook_connect_wplogin" style="text-align:right;">
+			<label>'.__('Connect with Facebook',$this->ptd).'</label>
 			'.$this->get_the_login_button().'
 		</div>
 		<br />
 		';
 		//force manual wp_localize script on login page
 		$this->add_js_options(true);
-		$this->load_sdj_js();
+		$this->load_sdk_js();
 		$this->js_sdk_init();
 	}
 	
@@ -2397,15 +2215,18 @@ Class AWD_facebook
 	 */
 	public function get_the_like_button($post="",$options=array())
 	{
-		$options = array_replace($this->options['like_button'], $options);	
+		
 		if(!isset($options['href']) OR empty($options['href']))
 			if(is_object($post))
 				$options['href'] = get_permalink($post->ID);
+	
+		$options = array_replace($this->options['like_button'], $options);	
+		
 		try {
 			$AWD_facebook_likebutton = new AWD_facebook_likebutton($options);
 			return '<div class="AWD_facebook_likebutton">'.$AWD_facebook_likebutton->get().'</div>';
 		} catch (Exception $e){
-			return '<div class="alert alert-warning">'.$e->getMessage().'</div>';
+			return $this->display_messages($e->getMessage(), 'error', false);
 		}
 	}
 	
@@ -2415,93 +2236,99 @@ Class AWD_facebook
 	 * @return void
 	 */
 	public function post_manager_content($post){
-	 	$custom = get_post_custom($post->ID);
-	 	//disabled  redefine by default like button
-	 	if($custom[$this->plugin_option_pref.'like_button_redefine'][0] == '')
-	 		$custom[$this->plugin_option_pref.'like_button_redefine'][0] == 0;
-	 	//enable by default like button
-	 	if($custom[$this->plugin_option_pref.'like_button_enabled'][0] == '')
-	 		$custom[$this->plugin_option_pref.'like_button_enabled'][0] = 1;
-	 	?>
+	 	$custom = get_post_meta($post->ID, $this->plugin_slug, true);
+	 	$options = array();
+	 	if(isset($custom)){
+			$options = $custom;
+	 	}
+		$options = array_merge($this->options['content_manager'], $options);	
+		$form = new AWD_facebook_form('form_posts_settings', 'POST', '', $this->plugin_option_pref);	
+		?>
 	 	<div class="AWD_facebook_wrap">
-			<div class="misc-pub-section">
+			<?php do_action('AWD_facebook_admin_notices'); ?>
+
+			<h2><?php _e('Like Button',$this->ptd); ?></h2>
+			<div class="alert alert-info">
+			<?php
+			echo do_shortcode('[AWD_likebutton width="250" href="'.get_permalink($post->ID).'"]');
+			?>
+			</div>
+			<div class="row">
 				<?php 
-				do_action('AWD_facebook_admin_notices');
-				echo do_shortcode('[AWD_likebutton width="250" href="'.get_permalink($post->ID).'"]');
+				echo $form->addSelect(__('Redefine globals settings ?',$this->ptd), 'like_button[redefine]', array(
+					array('value'=>0, 'label'=>__('No',$this->ptd)),
+					array('value'=>1, 'label'=>__('Yes',$this->ptd))									
+				), $options['like_button']['redefine'], 'span3', array('class'=>'span3')); 
+				echo $form->addSelect(__('Activate ?',$this->ptd), 'like_button[enabled]', array(
+					array('value'=>0, 'label'=>__('No',$this->ptd)),
+					array('value'=>1, 'label'=>__('Yes',$this->ptd))									
+				), $options['like_button']['enabled'], 'span3', array('class'=>'span3'));
+				echo $form->addSelect(__('Where ?',$this->ptd), 'like_button[place]', array(
+					array('value'=>'top', 'label'=>__('Top',$this->ptd)),
+					array('value'=>'bottom', 'label'=>__('Bottom',$this->ptd)),								
+					array('value'=>'both', 'label'=>__('Both',$this->ptd))									
+				), $options['like_button']['place'], 'span3', array('class'=>'span3'));
 				?>
 			</div>
-			<div class="uiForm">
-				<h3 class="center"><?php _e('Like Button',$this->plugin_text_domain); ?></h3>
-				<span class="label"><?php _e('Redefine globals settings?',$this->plugin_text_domain); ?></span>
-				<br />
-				<input type="radio" class="uiRadio" id="<?php echo $this->plugin_option_pref; ?>like_button_redefine_on" name="<?php echo $this->plugin_option_pref; ?>like_button_redefine" value="1" <?php if($custom[$this->plugin_option_pref.'like_button_redefine'][0] == 1) echo 'checked="checked"'; ?>  /> <label for="<?php echo $this->plugin_option_pref; ?>like_button_redefine_on"><?php echo __('On',$this->plugin_text_domain); ?></label>
-				<input type="radio" class="uiRadio" id="<?php echo $this->plugin_option_pref; ?>like_button_redefine_off" name="<?php echo $this->plugin_option_pref; ?>like_button_redefine" value="0" <?php if($custom[$this->plugin_option_pref.'like_button_redefine'][0] == 0) echo 'checked="checked"'; ?>  /> <label for="<?php echo $this->plugin_option_pref; ?>like_button_redefine_off"><?php echo __('Off',$this->plugin_text_domain); ?></label>
-				<div class="AWD_likebutton_enable <?php if($custom[$this->plugin_option_pref.'like_button_redefine'][0] == 0){ echo 'hidden'; } ?>">
-					<span class="label"><?php _e('Activate ?',$this->plugin_text_domain); ?></span>
-					<br />
-					<input type="radio" class="uiRadio" id="<?php echo $this->plugin_option_pref; ?>like_button_enabled_on" name="<?php echo $this->plugin_option_pref; ?>like_button_enabled" value="1" <?php if($custom[$this->plugin_option_pref.'like_button_enabled'][0] == 1) echo 'checked="checked"'; ?>  /> <label for="<?php echo $this->plugin_option_pref; ?>like_button_enabled_on"><?php echo __('On',$this->plugin_text_domain); ?></label>
-					<input type="radio" class="uiRadio" id="<?php echo $this->plugin_option_pref; ?>like_button_enabled_off" name="<?php echo $this->plugin_option_pref; ?>like_button_enabled" value="0" <?php if($custom[$this->plugin_option_pref.'like_button_enabled'][0] == 0) echo 'checked="checked"'; ?>  /> <label for="<?php echo $this->plugin_option_pref; ?>like_button_enabled_off"><?php echo __('Off',$this->plugin_text_domain); ?></label>
-					<br />
-					<div class="AWD_likebutton_positionning <?php if($custom[$this->plugin_option_pref.'like_button_enabled'][0] == 0){ echo 'hidden'; } ?>">
-						<span class="label"><?php _e('Where ?',$this->plugin_text_domain); ?></span>
-						<br />
-						<input type="radio" class="uiRadio" id="<?php echo $this->plugin_option_pref; ?>like_button_place_top" name="<?php echo $this->plugin_option_pref; ?>like_button_place" value="top" <?php if($custom[$this->plugin_option_pref.'like_button_place'][0] == 'top') echo 'checked="checked"'; ?>  /> <label for="<?php echo $this->plugin_option_pref; ?>like_button_place"><?php echo __('Top',$this->plugin_text_domain); ?></label>
-						<input type="radio" class="uiRadio" id="<?php echo $this->plugin_option_pref; ?>like_button_place_bottom" name="<?php echo $this->plugin_option_pref; ?>like_button_place" value="bottom" <?php if($custom[$this->plugin_option_pref.'like_button_place'][0] == 'bottom') echo 'checked="checked"'; ?>  /> <label for="<?php echo $this->plugin_option_pref; ?>like_button_place"><?php _e('Bottom',$this->plugin_text_domain); ?></label>
-						<input type="radio" class="uiRadio" id="<?php echo $this->plugin_option_pref; ?>like_button_place_both" name="<?php echo $this->plugin_option_pref; ?>like_button_place" value="both" <?php if($custom[$this->plugin_option_pref.'like_button_place'][0] == 'both') echo 'checked="checked"'; ?>  /> <label for="<?php echo $this->plugin_option_pref; ?>like_button_place"><?php _e('Both',$this->plugin_text_domain); ?></label>
-					</div>
-				</div>
-					<br />
-					<h3 class="center"><?php _e('Publish',$this->plugin_text_domain); ?><?php echo $this->get_the_help('awd_publish_pages','help'); ?></h3>
-					<?php if($this->is_user_logged_in_facebook()): ?>
-						<?php if($this->current_facebook_user_can('publish_stream')): ?>
-							<?php if($this->current_facebook_user_can('manage_pages')): ?>
-								<div class="AWD_button_succes help_awd_publish_pages hidden">
-								<?php echo __('You can publish this post to facebook when you save it, It is recommended to use OpenGraph. You can set the linked FB pages in settings. If you selected a lot of pages, the loading may be long.',$this->plugin_text_domain); ?>
-								</div>
-								<br />
-								<input type="checkbox" class="uiCheckbox" id="<?php echo $this->plugin_option_pref; ?>publish_to_pages" name="<?php echo $this->plugin_option_pref; ?>publish_to_pages" value="1" <?php if($this->options['publish_to_pages'] == 1) echo 'checked="checked"'; ?>  /> <label for="<?php echo $this->plugin_option_pref; ?>publish_to_pages"><?php echo __('Publish to Facebook pages ?',$this->plugin_text_domain); ?></label>
-								<br />
-								<input type="checkbox" class="uiCheckbox" id="<?php echo $this->plugin_option_pref; ?>publish_to_profile" name="<?php echo $this->plugin_option_pref; ?>publish_to_profile" value="1" <?php if($this->options['publish_to_profile'] == 1) echo 'checked="checked"'; ?>  /> <label for="<?php echo $this->plugin_option_pref; ?>publish_to_profile"><?php echo __('Publish to your Facebook profile ?',$this->plugin_text_domain); ?></label>
-								<br />
-								<label for="<?php echo $this->plugin_option_pref; ?>publish_message_text"><?php echo __('Add a message to the post ?',$this->plugin_text_domain); ?></label><br />
-								<textarea class="uiTextarea" id="<?php echo $this->plugin_option_pref; ?>publish_message_text" name="<?php echo $this->plugin_option_pref; ?>publish_message_text"></textarea> 
-								<br />
-								<label for="<?php echo $this->plugin_option_pref; ?>publish_read_more_text"><?php echo __('Custom Action Label',$this->plugin_text_domain); ?></label><br />
-								<input type="text" class="uiTextarea" value="<?php echo $this->options['publish_read_more_text']; ?>" id="<?php echo $this->plugin_option_pref; ?>publish_read_more_text" name="<?php echo $this->plugin_option_pref; ?>publish_read_more_text" maxlengh="25"/>
-							<?php 
-							else:
-								echo $this->return_error(__('You must authorize manage_pages permission in the settings of the plugin', $this->plugin_text_domain));
-							endif;
-						else: 
-							echo $this->return_error(__('You must authorize publish_stream permission in the settings of the plugin', $this->plugin_text_domain));
-						endif;
-					else:
+			
+			<?php if(current_user_can('manage_facebook_awd_publish_to_pages')){ ?>
+				<h2><?php _e('Publish to Facebook',$this->ptd); ?></h2>
+				<div class="row">
+					<?php 
+					if($this->is_user_logged_in_facebook()){
+						if($this->current_facebook_user_can('publish_stream')){
+							if($this->current_facebook_user_can('manage_pages')){
+								echo $form->addSelect(__('Publish to pages ?',$this->ptd), 'fbpublish[to_pages]', array(
+									array('value'=>0, 'label'=>__('No',$this->ptd)),
+									array('value'=>1, 'label'=>__('Yes',$this->ptd))									
+								), $options['fbpublish']['to_pages'], 'span3', array('class'=>'span3'));
+								echo $form->addSelect(__('Publish to profile ?',$this->ptd), 'fbpublish[to_profile]', array(
+									array('value'=>0, 'label'=>__('No',$this->ptd)),
+									array('value'=>1, 'label'=>__('Yes',$this->ptd))
+								), $options['fbpublish']['to_profile'], 'span3', array('class'=>'span3'));
+								
+								echo $form->addInputText(__('Custom Action Label',$this->ptd), 'fbpublish[read_more_text]', $options['fbpublish']['read_more_text'], 'span3', array('class'=>'span3'));
+	
+								echo $form->addInputTextArea(__('Add a message to the post ?',$this->ptd), 'fbpublish[message_text]', $options['fbpublish']['message_text'], 'span3', array('class'=>'span3'));
+								
+							}else{
+								$this->warnings[] =  new WP_Error('AWD_facebook_pages_auth', __('You must authorize manage_pages permission in the settings of the plugin', $this->ptd));
+								$this->display_all_errors();
+							}
+						}else{
+							$this->warnings[] = new WP_Error('AWD_facebook_pages_auth_publish_stream', __('You must authorize publish_stream permission in the settings of the plugin', $this->ptd));
+							$this->display_all_errors();
+						}
+					}else{
 						echo '<p>'.do_shortcode('[AWD_loginbutton]').'</p>';
-					endif;
-				?>
-			</div>
-		</div>
-		<script type="text/javascript">
-			jQuery(document).ready(function($){
-				$('#<?php echo $this->plugin_option_pref; ?>like_button_enabled_on').click(function(){
-					$('.AWD_likebutton_positionning').slideDown();
-				});
-				$('#<?php echo $this->plugin_option_pref; ?>like_button_enabled_off').click(function(){
-					$('.AWD_likebutton_positionning').slideUp();
-				});
-				$('#<?php echo $this->plugin_option_pref; ?>like_button_redefine_on').click(function(){
-					$('.AWD_likebutton_enable').slideDown();
-				});
-				$('#<?php echo $this->plugin_option_pref; ?>like_button_redefine_off').click(function(){
-					$('.AWD_likebutton_enable').slideUp();
-				});
-				//special toogle for help in the manager
-				$('#help_awd_publish_pages').click(function(e){
-					e.preventDefault();
-					$('.help_awd_publish_pages').slideToggle();
-				});
-			});
-		</script>						
+					}
+					?>
+				</div>
+			<?php } ?>
+			<?php if(current_user_can('manage_facebook_awd_opengraph')){ ?>
+				<?php if($this->options['open_graph_enable'] == 1){ ?>
+					<h2><?php _e('Opengraph',$this->ptd); ?></h2>			
+					<?php
+					$add_link = '<a class="btn btn btn-mini" href="'.admin_url('admin.php?page='.$this->plugin_slug.'_open_graph').'" target="_blank"><i class="icon-plus"></i> '.__('Create an object',$this->ptd).'</a>';
+					$ogp_objects = apply_filters('AWD_facebook_ogp_objects', $this->options['opengraph_objects']);			
+					if(is_array($ogp_objects) && count($ogp_objects)){
+						$linked_object = '';
+						$select_objects_options = array(array('value'=>'', 'label'=> __('Default', $this->ptd)));
+						foreach($ogp_objects as $key=>$ogp_object){
+							$select_objects_options[] = array('value'=> $key, 'label'=> $ogp_object['object_title']);
+						}
+						echo '
+						<div class="row">
+							'.$form->addSelect( __('Redefine Opengraph object for this post',$this->ptd), 'opengraph[object_link]', $select_objects_options, $options['opengraph']['object_link'], 'span4', array('class'=>'span4')).'
+						</div>
+						'.$add_link;
+					}else{
+						$this->display_messages(sprintf(__('No Object found.',$this->ptd).' '.$add_link , '<a href="'.admin_url('admin.php?page='.$this->plugin_slug.'_open_graph').'" target="_blank">','</a>'), 'warning');
+					}
+				}
+			}
+			?>
+		</div>						
 	 	<?php
 	 }
 	
@@ -2528,15 +2355,17 @@ Class AWD_facebook
 	 */
 	public function get_the_comments_box($post=null,$options=array())
 	{
-		$options = array_replace($this->options['comments_box'], $options);	
 		if(!isset($options['href']) OR empty($options['href']))
 			if(is_object($post))
 				$options['href'] = get_permalink($post->ID);
+
+		$options = array_replace($this->options['comments_box'], $options);	
+		
 		try {
 			$AWD_facebook_comments = new AWD_facebook_comments($options);
 			return '<div class="AWD_facebook_comments">'.$AWD_facebook_comments->get().'</div>';
 		} catch (Exception $e){
-			return '<div class="alert alert-warning">'.$e->getMessage().'</div>';
+			return $this->display_messages($e->getMessage(), 'error', false);
 		}
 	}
 	
@@ -2585,7 +2414,7 @@ Class AWD_facebook
 			$AWD_facebook_likebox = new AWD_facebook_likebox($options);
 			return '<div class="AWD_facebook_likebox">'.$AWD_facebook_likebox->get().'</div>';
 		} catch (Exception $e){
-			return '<div class="alert alert-warning">'.$e->getMessage().'</div>';
+			return $this->display_messages($e->getMessage(), 'error', false);
 		}
 	}
 	
@@ -2615,7 +2444,7 @@ Class AWD_facebook
 			$AWD_facebook_activity = new AWD_facebook_activity($options);
 			return '<div class="AWD_facebook_activity">'.$AWD_facebook_activity->get().'</div>';
 		} catch (Exception $e){
-			return '<div class="alert alert-warning">'.$e->getMessage().'</div>';
+			return $this->display_messages($e->getMessage(), 'error', false);
 		}
 	}
 	
@@ -2635,11 +2464,11 @@ Class AWD_facebook
 		 $wp_widget_factory->widgets['AWD_facebook_widget_likebox'] = new AWD_facebook_widget(
 		 	array(
 		 		'id_base'		=> 'like_box',
-		 		'name'			=> $this->plugin_name.' '.__('Like Box',$this->plugin_text_domain),
-		 		'description' 	=> __('Add a Facebook Like Box' , $this->plugin_text_domain),
+		 		'name'			=> $this->plugin_name.' '.__('Like Box',$this->ptd),
+		 		'description' 	=> __('Add a Facebook Like Box' , $this->ptd),
 		 		'model' 		=> $fields['like_box'],
 		 		'self_callback' => array($this, 'shortcode_like_box'),
-				'text_domain' 	=> $this->plugin_text_domain,
+				'text_domain' 	=> $this->ptd,
 				'preview'		=> true
 		 	)
 		 );
@@ -2648,11 +2477,11 @@ Class AWD_facebook
 		 $wp_widget_factory->widgets['AWD_facebook_widget_like_button'] = new AWD_facebook_widget(
 		 	array(
 		 		'id_base'		=> 'like_button',
-		 		'name'			=> $this->plugin_name.' '.__('Like Button',$this->plugin_text_domain),
-		 		'description' 	=> __('Add a Facebook Like Button' , $this->plugin_text_domain),
+		 		'name'			=> $this->plugin_name.' '.__('Like Button',$this->ptd),
+		 		'description' 	=> __('Add a Facebook Like Button' , $this->ptd),
 		 		'model' 		=> $fields['like_button'],
 		 		'self_callback' => array($this, 'shortcode_like_button'),
-				'text_domain' 	=> $this->plugin_text_domain,
+				'text_domain' 	=> $this->ptd,
 				'preview'		=> true
 		 	)
 		 );
@@ -2661,11 +2490,11 @@ Class AWD_facebook
 		 $wp_widget_factory->widgets['AWD_facebook_widget_login_button'] = new AWD_facebook_widget(
 		 	array(
 		 		'id_base'		=> 'login_button',
-		 		'name'			=> $this->plugin_name.' '.__('Login Button',$this->plugin_text_domain),
-		 		'description' 	=> __('Add a Facebook Login Button' , $this->plugin_text_domain),
+		 		'name'			=> $this->plugin_name.' '.__('Login Button',$this->ptd),
+		 		'description' 	=> __('Add a Facebook Login Button' , $this->ptd),
 		 		'model' 		=> $fields['login_button'],
 		 		'self_callback' => array($this, 'shortcode_login_button'),
-				'text_domain' 	=> $this->plugin_text_domain
+				'text_domain' 	=> $this->ptd
 			)
 		 );
 		 
@@ -2673,11 +2502,11 @@ Class AWD_facebook
 		 $wp_widget_factory->widgets['AWD_facebook_widget_activity_box'] = new AWD_facebook_widget(
 		 	array(
 		 		'id_base'		=> 'activity_box',
-		 		'name'			=> $this->plugin_name.' '.__('Activity Box',$this->plugin_text_domain),
-		 		'description' 	=> __('Add a Facebook Activity Box' , $this->plugin_text_domain),
+		 		'name'			=> $this->plugin_name.' '.__('Activity Box',$this->ptd),
+		 		'description' 	=> __('Add a Facebook Activity Box' , $this->ptd),
 		 		'model' 		=> $fields['activity_box'],
 		 		'self_callback' => array($this, 'shortcode_activity_box'),
-				'text_domain' 	=> $this->plugin_text_domain,
+				'text_domain' 	=> $this->ptd,
 				'preview'		=> true
 		 	)
 		 );
@@ -2686,11 +2515,11 @@ Class AWD_facebook
 		 $wp_widget_factory->widgets['AWD_facebook_widget_comments_box'] = new AWD_facebook_widget(
 		 	array(
 		 		'id_base'		=> 'comments_box',
-		 		'name'			=> $this->plugin_name.' '.__('Comments Box',$this->plugin_text_domain),
-		 		'description' 	=> __('Add a Facebook Comments Box' , $this->plugin_text_domain),
+		 		'name'			=> $this->plugin_name.' '.__('Comments Box',$this->ptd),
+		 		'description' 	=> __('Add a Facebook Comments Box' , $this->ptd),
 		 		'model' 		=> $fields['comments_box'],
 		 		'self_callback' => array($this, 'shortcode_comments_box'),
-				'text_domain' 	=> $this->plugin_text_domain,
+				'text_domain' 	=> $this->ptd,
 		 	)
 		 );
 		 		 
@@ -2716,19 +2545,19 @@ Class AWD_facebook
 			<div class="AWD_facebook_wrap">
 				<div class="container-fluid">
 					<div class="awd_debug well">
-						<div class="page-header"><h2><?php _e('Facebook AWD API',$this->plugin_text_domain); ?></h2></div>
+						<div class="page-header"><h2><?php _e('Facebook AWD API',$this->ptd); ?></h2></div>
 						<?php $this->Debug($_this['fcbk']);	?>
 						
-						<div class="page-header"><h2><?php _e('Facebook AWD APPLICATIONS INFOS',$this->plugin_text_domain); ?></h2></div>
+						<div class="page-header"><h2><?php _e('Facebook AWD APPLICATIONS INFOS',$this->ptd); ?></h2></div>
 						<?php $this->Debug($_this['options']['app_infos']);	?>
 						
-						<div class="page-header"><h2><?php _e('Facebook AWD CURRENT USER',$this->plugin_text_domain); ?></h2></div>
+						<div class="page-header"><h2><?php _e('Facebook AWD CURRENT USER',$this->ptd); ?></h2></div>
 						<?php $this->Debug($_this['me']); ?>
 						
-						<div class="page-header"><h2><?php _e('Facebook AWD Options',$this->plugin_text_domain); ?></h2></div>
+						<div class="page-header"><h2><?php _e('Facebook AWD Options',$this->ptd); ?></h2></div>
 						<?php $this->Debug($_this['options']); ?>
 						
-						<div class="page-header"><h2><?php _e('Facebook AWD FULL',$this->plugin_text_domain); ?></h2></div>
+						<div class="page-header"><h2><?php _e('Facebook AWD FULL',$this->ptd); ?></h2></div>
 						<?php $this->Debug($_this); ?>
 					</div>
 				</div>
@@ -2744,6 +2573,8 @@ Class AWD_facebook
 //****************************************************************************************
 //	LIBRARY FACEBOOK AWD
 //****************************************************************************************
+//Class Facebook
+require_once(dirname(__FILE__).'/inc/classes/facebook/class.AWD_facebook_api.php');
 require_once(dirname(__FILE__).'/inc/classes/model/class.AWD_facebook_likebutton.php');
 require_once(dirname(__FILE__).'/inc/classes/model/class.AWD_facebook_activity.php');
 require_once(dirname(__FILE__).'/inc/classes/model/class.AWD_facebook_likebox.php');
diff --git a/assets/js/facebook_awd.js b/assets/js/facebook_awd.js
index 5f6f281..81319c1 100755
--- a/assets/js/facebook_awd.js
+++ b/assets/js/facebook_awd.js
@@ -25,10 +25,10 @@ var AWD_facebook = {
 		var redirect = '';
 		if(response.authResponse){
 			if(!redirect_url){
-				window.location.href = awd_fcbk.loginUrl;
+				window.location.replace(awd_fcbk.loginUrl);
 			}else{
 				redirect = "?redirect_to="+redirect_url;
-				window.location.href = awd_fcbk.loginUrl+redirect;
+				window.location.replace(awd_fcbk.loginUrl+redirect);
 			}
 		}
 	},
diff --git a/assets/js/facebook_awd_admin.js b/assets/js/facebook_awd_admin.js
index 9d735fc..1a55742 100755
--- a/assets/js/facebook_awd_admin.js
+++ b/assets/js/facebook_awd_admin.js
@@ -151,8 +151,7 @@ function AWDFacebookAdmin($){
 			FB.login(function(response)
 			{
 				if(response.authResponse) {
-					console.log(response);
-				    $('#awd_fcbk_form_settings').submit();
+				    $('#awd_fcbk_option_form_settings').submit();
 				}
 			},{scope: scope});
 		});
diff --git a/inc/admin/forms/activity_box.php b/inc/admin/forms/activity_box.php
index a7f9732..150e320 100644
--- a/inc/admin/forms/activity_box.php
+++ b/inc/admin/forms/activity_box.php
@@ -10,7 +10,7 @@ $fields['activity_box'] = array(
 	'title_config' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Configure the box',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Configure the box',$this->ptd).'</h1>
 		',
 		'widget_no_display' => true
 	),
@@ -24,7 +24,7 @@ $fields['activity_box'] = array(
 	
 	'domain'=> array(
 		'type'=> 'text',
-		'label'=> __('Domain',$this->plugin_text_domain),
+		'label'=> __('Domain',$this->ptd),
 		'class'=>'span4',
 		'attr'=> array('class'=>'span4')
 	),
@@ -46,32 +46,32 @@ $fields['activity_box'] = array(
 	'type'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'iframe', 'label'=>__('Iframe',$this->plugin_text_domain)),
-			array('value'=>'xfbml', 'label'=>__('Xfbml',$this->plugin_text_domain)),							
-			array('value'=>'html5', 'label'=>__('html5',$this->plugin_text_domain)),				
+			array('value'=>'iframe', 'label'=>__('Iframe',$this->ptd)),
+			array('value'=>'xfbml', 'label'=>__('Xfbml',$this->ptd)),							
+			array('value'=>'html5', 'label'=>__('html5',$this->ptd)),				
 		),
-		'label'=> __('Type',$this->plugin_text_domain),
+		'label'=> __('Type',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'filter'=> array(
 		'type'=> 'text',
-		'label'=> __('Filter',$this->plugin_text_domain),
+		'label'=> __('Filter',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'ref'=> array(
 		'type'=> 'text',
-		'label'=> __('Ref',$this->plugin_text_domain),
+		'label'=> __('Ref',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'max_age'=> array(
 		'type'=> 'text',
-		'label'=> __('Max Age',$this->plugin_text_domain),
+		'label'=> __('Max Age',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -80,18 +80,18 @@ $fields['activity_box'] = array(
 	'linktarget'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'_blank', 'label'=>__('Blank',$this->plugin_text_domain)),
-			array('value'=>'_top', 'label'=>__('Top',$this->plugin_text_domain)),							
-			array('value'=>'_parent', 'label'=>__('Parent',$this->plugin_text_domain)),				
+			array('value'=>'_blank', 'label'=>__('Blank',$this->ptd)),
+			array('value'=>'_top', 'label'=>__('Top',$this->ptd)),							
+			array('value'=>'_parent', 'label'=>__('Parent',$this->ptd)),				
 		),
-		'label'=> __('Links Target',$this->plugin_text_domain),
+		'label'=> __('Links Target',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'width'=> array(
 		'type'=> 'text',
-		'label'=> __('Width of box',$this->plugin_text_domain),
+		'label'=> __('Width of box',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -99,7 +99,7 @@ $fields['activity_box'] = array(
 	
 	'height'=> array(
 		'type'=> 'text',
-		'label'=> __('Height of box',$this->plugin_text_domain),
+		'label'=> __('Height of box',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -107,10 +107,10 @@ $fields['activity_box'] = array(
 	'header'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Show Header ?',$this->plugin_text_domain),
+		'label'=> __('Show Header ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -118,10 +118,10 @@ $fields['activity_box'] = array(
 	'recommendations'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Recommendations',$this->plugin_text_domain),
+		'label'=> __('Recommendations',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -129,10 +129,10 @@ $fields['activity_box'] = array(
 	'colorscheme'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'light', 'label'=>__('light',$this->plugin_text_domain)),
-			array('value'=>'dark', 'label'=>__('Dark',$this->plugin_text_domain)),							
+			array('value'=>'light', 'label'=>__('light',$this->ptd)),
+			array('value'=>'dark', 'label'=>__('Dark',$this->ptd)),							
 		),
-		'label'=> __('Colors',$this->plugin_text_domain),
+		'label'=> __('Colors',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -140,21 +140,21 @@ $fields['activity_box'] = array(
 	'font'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'arial', 'label'=>__('Arial',$this->plugin_text_domain)),
-			array('value'=>'lucida grande', 'label'=>__('Lucida grande',$this->plugin_text_domain)),
-			array('value'=>'segoe ui', 'label'=>__('Segoe ui',$this->plugin_text_domain)),
-			array('value'=>'tahoma', 'label'=>__('Tahoma',$this->plugin_text_domain)),
-			array('value'=>'trebuchet ms', 'label'=>__('Trebuchet ms',$this->plugin_text_domain)),
-			array('value'=>'verdana', 'label'=>__('Verdana',$this->plugin_text_domain))							
+			array('value'=>'arial', 'label'=>__('Arial',$this->ptd)),
+			array('value'=>'lucida grande', 'label'=>__('Lucida grande',$this->ptd)),
+			array('value'=>'segoe ui', 'label'=>__('Segoe ui',$this->ptd)),
+			array('value'=>'tahoma', 'label'=>__('Tahoma',$this->ptd)),
+			array('value'=>'trebuchet ms', 'label'=>__('Trebuchet ms',$this->ptd)),
+			array('value'=>'verdana', 'label'=>__('Verdana',$this->ptd))							
 		),
-		'label'=> __('Fonts',$this->plugin_text_domain),
+		'label'=> __('Fonts',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'border_color'=> array(
 		'type'=> 'text',
-		'label'=> __('Border color',$this->plugin_text_domain),
+		'label'=> __('Border color',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -170,9 +170,9 @@ $fields['activity_box'] = array(
 	'preview' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Preview',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Preview',$this->ptd).'</h1>
 			<div class="well">'.$this->get_the_activity_box().'</div>
-			<h1>'.__('Options List',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Options List',$this->ptd).'</h1>
 			<table class="table table-bordered table-condensed table-striped">
 				<thead>
 					<tr>
diff --git a/inc/admin/forms/comments_box.php b/inc/admin/forms/comments_box.php
index 8a818c1..3b3355c 100644
--- a/inc/admin/forms/comments_box.php
+++ b/inc/admin/forms/comments_box.php
@@ -10,7 +10,7 @@ $fields['comments_box'] = array(
 	'title_config' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Configure the comments box',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Configure the comments box',$this->ptd).'</h1>
 		',
 		'widget_no_display' => true
 	),
@@ -24,7 +24,7 @@ $fields['comments_box'] = array(
 	
 	'href'=> array(
 		'type'=> 'text',
-		'label'=> __('Default Url',$this->plugin_text_domain),
+		'label'=> __('Default Url',$this->ptd),
 		'class'=>'span4',
 		'attr'=> array('class'=>'span4')
 	),
@@ -48,10 +48,10 @@ $fields['comments_box'] = array(
 	'type'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'xfbml', 'label'=>__('Xfbml',$this->plugin_text_domain)),							
-			array('value'=>'html5', 'label'=>__('html5',$this->plugin_text_domain)),				
+			array('value'=>'xfbml', 'label'=>__('Xfbml',$this->ptd)),							
+			array('value'=>'html5', 'label'=>__('html5',$this->ptd)),				
 		),
-		'label'=> __('Type',$this->plugin_text_domain),
+		'label'=> __('Type',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -59,7 +59,7 @@ $fields['comments_box'] = array(
 	
 	'num_posts'=> array(
 		'type'=> 'text',
-		'label'=> __('Nb of comments',$this->plugin_text_domain),
+		'label'=> __('Nb of comments',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -67,10 +67,10 @@ $fields['comments_box'] = array(
 	'mobile'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Mobile version',$this->plugin_text_domain),
+		'label'=> __('Mobile version',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -93,10 +93,10 @@ $fields['comments_box'] = array(
 	'on_pages'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Add Comments to pages',$this->plugin_text_domain),
+		'label'=> __('Add Comments to pages',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2'),
 		'widget_no_display' => true
@@ -105,10 +105,10 @@ $fields['comments_box'] = array(
 	'on_posts'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Add Comments to posts',$this->plugin_text_domain),
+		'label'=> __('Add Comments to posts',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2'),
 		'widget_no_display' => true
@@ -117,10 +117,10 @@ $fields['comments_box'] = array(
 	'on_custom_post_types'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Add Comments to custom posts',$this->plugin_text_domain),
+		'label'=> __('Add Comments to custom posts',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2'),
 		'widget_no_display' => true
@@ -143,7 +143,7 @@ $fields['comments_box'] = array(
 	
 	'exclude_post_id'=> array(
 		'type'=> 'text',
-		'label'=> __('Exclude Posts or Pages ID (example: 12,46,234)',$this->plugin_text_domain),
+		'label'=> __('Exclude Posts or Pages ID (example: 12,46,234)',$this->ptd),
 		'class'=>'span4',
 		'attr'=> array('class'=>'span4'),
 		'widget_no_display' => true
@@ -151,7 +151,7 @@ $fields['comments_box'] = array(
 	
 	'width'=> array(
 		'type'=> 'text',
-		'label'=> __('Width',$this->plugin_text_domain),
+		'label'=> __('Width',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -159,10 +159,10 @@ $fields['comments_box'] = array(
 	'colorscheme'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'light', 'label'=>__('light',$this->plugin_text_domain)),
-			array('value'=>'dark', 'label'=>__('Dark',$this->plugin_text_domain)),							
+			array('value'=>'light', 'label'=>__('light',$this->ptd)),
+			array('value'=>'dark', 'label'=>__('Dark',$this->ptd)),							
 		),
-		'label'=> __('Colors',$this->plugin_text_domain),
+		'label'=> __('Colors',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -177,9 +177,9 @@ $fields['comments_box'] = array(
 	'preview' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Preview',$this->plugin_text_domain).'</h1>			
+			<h1>'.__('Preview',$this->ptd).'</h1>			
 			<div class="well">'.$this->get_the_comments_box("",array("width"=>"420")).'</div> 
-			<h1>'.__('Options List',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Options List',$this->ptd).'</h1>
 			<table class="table table-bordered table-condensed table-striped">
 				<thead>
 					<tr>
diff --git a/inc/admin/forms/like_box.php b/inc/admin/forms/like_box.php
index a44ef65..d2b5469 100644
--- a/inc/admin/forms/like_box.php
+++ b/inc/admin/forms/like_box.php
@@ -10,7 +10,7 @@ $fields['like_box'] = array(
 	'title_config' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Configure the box',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Configure the box',$this->ptd).'</h1>
 		',
 		'widget_no_display' => true
 	),
@@ -24,7 +24,7 @@ $fields['like_box'] = array(
 	
 	'href'=> array(
 		'type'=> 'text',
-		'label'=> __('Url of the page',$this->plugin_text_domain),
+		'label'=> __('Url of the page',$this->ptd),
 		'class'=>'span4',
 		'attr'=> array('class'=>'span4')
 	),
@@ -46,11 +46,11 @@ $fields['like_box'] = array(
 	'type'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'iframe', 'label'=>__('Iframe',$this->plugin_text_domain)),
-			array('value'=>'xfbml', 'label'=>__('Xfbml',$this->plugin_text_domain)),							
-			array('value'=>'html5', 'label'=>__('html5',$this->plugin_text_domain)),				
+			array('value'=>'iframe', 'label'=>__('Iframe',$this->ptd)),
+			array('value'=>'xfbml', 'label'=>__('Xfbml',$this->ptd)),							
+			array('value'=>'html5', 'label'=>__('html5',$this->ptd)),				
 		),
-		'label'=> __('Type',$this->plugin_text_domain),
+		'label'=> __('Type',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -58,10 +58,10 @@ $fields['like_box'] = array(
 	'colorscheme'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'light', 'label'=>__('light',$this->plugin_text_domain)),
-			array('value'=>'dark', 'label'=>__('Dark',$this->plugin_text_domain)),							
+			array('value'=>'light', 'label'=>__('light',$this->ptd)),
+			array('value'=>'dark', 'label'=>__('Dark',$this->ptd)),							
 		),
-		'label'=> __('Colors',$this->plugin_text_domain),
+		'label'=> __('Colors',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -69,10 +69,10 @@ $fields['like_box'] = array(
 	'show_faces'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Show faces',$this->plugin_text_domain),
+		'label'=> __('Show faces',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -80,10 +80,10 @@ $fields['like_box'] = array(
 	'stream'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Show Stream',$this->plugin_text_domain),
+		'label'=> __('Show Stream',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -91,10 +91,10 @@ $fields['like_box'] = array(
 	'header'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Show Header ?',$this->plugin_text_domain),
+		'label'=> __('Show Header ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -102,31 +102,31 @@ $fields['like_box'] = array(
 	'force_wall'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Force Wall ?',$this->plugin_text_domain),
+		'label'=> __('Force Wall ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'width'=> array(
 		'type'=> 'text',
-		'label'=> __('Width of box',$this->plugin_text_domain),
+		'label'=> __('Width of box',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'height'=> array(
 		'type'=> 'text',
-		'label'=> __('Height of box',$this->plugin_text_domain),
+		'label'=> __('Height of box',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'border_color'=> array(
 		'type'=> 'text',
-		'label'=> __('Border color',$this->plugin_text_domain),
+		'label'=> __('Border color',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -141,9 +141,9 @@ $fields['like_box'] = array(
 	'preview' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Preview',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Preview',$this->ptd).'</h1>
 			<div class="well">'.$this->get_the_like_box().'</div>
-			<h1>'.__('Options List',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Options List',$this->ptd).'</h1>
 			<table class="table table-bordered table-condensed table-striped">
 				<thead>
 					<tr>
diff --git a/inc/admin/forms/like_button.php b/inc/admin/forms/like_button.php
index 8116c65..5788d0f 100644
--- a/inc/admin/forms/like_button.php
+++ b/inc/admin/forms/like_button.php
@@ -10,7 +10,7 @@ $fields['like_button'] = array(
 	'title_config' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Configure the button',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Configure the button',$this->ptd).'</h1>
 		',
 		'widget_no_display' => true
 	),
@@ -25,14 +25,14 @@ $fields['like_button'] = array(
 	'font'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'arial', 'label'=>__('Arial',$this->plugin_text_domain)),
-			array('value'=>'lucida grande', 'label'=>__('Lucida grande',$this->plugin_text_domain)),
-			array('value'=>'segoe ui', 'label'=>__('Segoe ui',$this->plugin_text_domain)),
-			array('value'=>'tahoma', 'label'=>__('Tahoma',$this->plugin_text_domain)),
-			array('value'=>'trebuchet ms', 'label'=>__('Trebuchet ms',$this->plugin_text_domain)),
-			array('value'=>'verdana', 'label'=>__('Verdana',$this->plugin_text_domain))							
+			array('value'=>'arial', 'label'=>__('Arial',$this->ptd)),
+			array('value'=>'lucida grande', 'label'=>__('Lucida grande',$this->ptd)),
+			array('value'=>'segoe ui', 'label'=>__('Segoe ui',$this->ptd)),
+			array('value'=>'tahoma', 'label'=>__('Tahoma',$this->ptd)),
+			array('value'=>'trebuchet ms', 'label'=>__('Trebuchet ms',$this->ptd)),
+			array('value'=>'verdana', 'label'=>__('Verdana',$this->ptd))							
 		),
-		'label'=> __('Fonts',$this->plugin_text_domain),
+		'label'=> __('Fonts',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -40,10 +40,10 @@ $fields['like_button'] = array(
 	'action'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'like', 'label'=>__('Like',$this->plugin_text_domain)),
-			array('value'=>'recommend', 'label'=>__('Recommend',$this->plugin_text_domain))						
+			array('value'=>'like', 'label'=>__('Like',$this->ptd)),
+			array('value'=>'recommend', 'label'=>__('Recommend',$this->ptd))						
 		),
-		'label'=> __('Action',$this->plugin_text_domain),
+		'label'=> __('Action',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -51,11 +51,11 @@ $fields['like_button'] = array(
 	'layout'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'standard', 'label'=>__('Standard',$this->plugin_text_domain)),
-			array('value'=>'button_count', 'label'=>__('Button Count',$this->plugin_text_domain)),							
-			array('value'=>'box_count', 'label'=>__('Box Count',$this->plugin_text_domain))					
+			array('value'=>'standard', 'label'=>__('Standard',$this->ptd)),
+			array('value'=>'button_count', 'label'=>__('Button Count',$this->ptd)),							
+			array('value'=>'box_count', 'label'=>__('Box Count',$this->ptd))					
 		),
-		'label'=> __('Layout style',$this->plugin_text_domain),
+		'label'=> __('Layout style',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -63,11 +63,11 @@ $fields['like_button'] = array(
 	'type'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'iframe', 'label'=>__('Iframe',$this->plugin_text_domain)),
-			array('value'=>'xfbml', 'label'=>__('Xfbml',$this->plugin_text_domain)),							
-			array('value'=>'html5', 'label'=>__('html5',$this->plugin_text_domain)),				
+			array('value'=>'iframe', 'label'=>__('Iframe',$this->ptd)),
+			array('value'=>'xfbml', 'label'=>__('Xfbml',$this->ptd)),							
+			array('value'=>'html5', 'label'=>__('html5',$this->ptd)),				
 		),
-		'label'=> __('Type',$this->plugin_text_domain),
+		'label'=> __('Type',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -75,10 +75,10 @@ $fields['like_button'] = array(
 	'send'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Send button ?',$this->plugin_text_domain),
+		'label'=> __('Send button ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2','disabled'=>($this->options['like_button']['type'] == "iframe" ? 'disabled' : ''))
 	),
@@ -86,10 +86,10 @@ $fields['like_button'] = array(
 	'colorscheme'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'light', 'label'=>__('light',$this->plugin_text_domain)),
-			array('value'=>'dark', 'label'=>__('Dark',$this->plugin_text_domain)),							
+			array('value'=>'light', 'label'=>__('light',$this->ptd)),
+			array('value'=>'dark', 'label'=>__('Dark',$this->ptd)),							
 		),
-		'label'=> __('Colors',$this->plugin_text_domain),
+		'label'=> __('Colors',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -97,31 +97,31 @@ $fields['like_button'] = array(
 	'show_faces'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Show Faces ?',$this->plugin_text_domain),
+		'label'=> __('Show Faces ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'width'=> array(
 		'type'=> 'text',
-		'label'=> __('Width of button',$this->plugin_text_domain),
+		'label'=> __('Width of button',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'height'=> array(
 		'type'=> 'text',
-		'label'=> __('Height of button',$this->plugin_text_domain),
+		'label'=> __('Height of button',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'ref'=> array(
 		'type'=> 'text',
-		'label'=> __('Ref',$this->plugin_text_domain),
+		'label'=> __('Ref',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -136,7 +136,7 @@ $fields['like_button'] = array(
 	'title_usage' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Define a default usage',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Define a default usage',$this->ptd).'</h1>
 		',
 		'widget_no_display' => true
 		
@@ -151,7 +151,7 @@ $fields['like_button'] = array(
 	
 	'href'=> array(
 		'type'=> 'text',
-		'label'=> __('Default Url to like',$this->plugin_text_domain),
+		'label'=> __('Default Url to like',$this->ptd),
 		'class'=>'span4',
 		'attr'=> array('class'=>'span4')
 	),
@@ -174,10 +174,10 @@ $fields['like_button'] = array(
 	'on_pages'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Display on pages ?',$this->plugin_text_domain),
+		'label'=> __('Display on pages ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2'),
 		'widget_no_display' => true
@@ -187,11 +187,11 @@ $fields['like_button'] = array(
 	'place_on_pages'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'top', 'label'=>__('Top',$this->plugin_text_domain)),
-			array('value'=>'bottom', 'label'=>__('Bottom',$this->plugin_text_domain)),							
-			array('value'=>'both', 'label'=>__('Both',$this->plugin_text_domain)),							
+			array('value'=>'top', 'label'=>__('Top',$this->ptd)),
+			array('value'=>'bottom', 'label'=>__('Bottom',$this->ptd)),							
+			array('value'=>'both', 'label'=>__('Both',$this->ptd)),							
 		),
-		'label'=> __('Where ?',$this->plugin_text_domain),
+		'label'=> __('Where ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2', 'disabled'=>($this->options['like_button']['on_pages'] == "0" ? 'disabled' : '')),
 		'widget_no_display' => true
@@ -216,10 +216,10 @@ $fields['like_button'] = array(
 	'on_posts'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('Display on posts ?',$this->plugin_text_domain),
+		'label'=> __('Display on posts ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2'),
 		'widget_no_display' => true
@@ -228,11 +228,11 @@ $fields['like_button'] = array(
 	'place_on_posts'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'top', 'label'=>__('Top',$this->plugin_text_domain)),
-			array('value'=>'bottom', 'label'=>__('Bottom',$this->plugin_text_domain)),							
-			array('value'=>'both', 'label'=>__('Both',$this->plugin_text_domain)),							
+			array('value'=>'top', 'label'=>__('Top',$this->ptd)),
+			array('value'=>'bottom', 'label'=>__('Bottom',$this->ptd)),							
+			array('value'=>'both', 'label'=>__('Both',$this->ptd)),							
 		),
-		'label'=> __('Where ?',$this->plugin_text_domain),
+		'label'=> __('Where ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2', 'disabled'=>($this->options['like_button']['on_posts'] == "0" ? 'disabled' : '')),
 		'widget_no_display' => true
@@ -257,10 +257,10 @@ $fields['like_button'] = array(
 	'on_custom_post_types'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),
-		'label'=> __('On custom posts ?',$this->plugin_text_domain),
+		'label'=> __('On custom posts ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2'),
 		'widget_no_display' => true
@@ -269,11 +269,11 @@ $fields['like_button'] = array(
 	'place_on_custom_post_types'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'top', 'label'=>__('Top',$this->plugin_text_domain)),
-			array('value'=>'bottom', 'label'=>__('Bottom',$this->plugin_text_domain)),							
-			array('value'=>'both', 'label'=>__('Both',$this->plugin_text_domain)),							
+			array('value'=>'top', 'label'=>__('Top',$this->ptd)),
+			array('value'=>'bottom', 'label'=>__('Bottom',$this->ptd)),							
+			array('value'=>'both', 'label'=>__('Both',$this->ptd)),							
 		),
-		'label'=> __('Where ?',$this->plugin_text_domain),
+		'label'=> __('Where ?',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2', 'disabled'=>($this->options['like_button']['on_custom_post_types'] == "0" ? 'disabled' : '')),
 		'widget_no_display' => true
@@ -297,7 +297,7 @@ $fields['like_button'] = array(
 
 	'exclude_post_type'=> array(
 		'type'=> 'text',
-		'label'=> __('Exclude Post types',$this->plugin_text_domain),
+		'label'=> __('Exclude Post types',$this->ptd),
 		'class'=>'span4',
 		'attr'=> array('class'=>'span4'),
 		'widget_no_display' => true
@@ -305,7 +305,7 @@ $fields['like_button'] = array(
 	
 	'exclude_terms_slug'=> array(
 		'type'=> 'text',
-		'label'=> __('Exclude Categories or other terms',$this->plugin_text_domain),
+		'label'=> __('Exclude Categories or other terms',$this->ptd),
 		'class'=>'span4',
 		'attr'=> array('class'=>'span4'),
 		'widget_no_display' => true
@@ -313,7 +313,7 @@ $fields['like_button'] = array(
 	
 	'exclude_post_id'=> array(
 		'type'=> 'text',
-		'label'=> __('Exclude Posts or Pages ID',$this->plugin_text_domain),
+		'label'=> __('Exclude Posts or Pages ID',$this->ptd),
 		'class'=>'span4',
 		'attr'=> array('class'=>'span4'),
 		'widget_no_display' => true
@@ -330,9 +330,9 @@ $fields['like_button'] = array(
 	'preview' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Preview',$this->plugin_text_domain).'</h1>			
+			<h1>'.__('Preview',$this->ptd).'</h1>			
 			<div class="well">'.$this->get_the_like_button().'</div> 
-			<h1>'.__('Options List',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Options List',$this->ptd).'</h1>
 			<table class="table table-bordered table-condensed table-striped">
 				<thead>
 					<tr>
diff --git a/inc/admin/forms/login_button.php b/inc/admin/forms/login_button.php
index 6a0da6f..0fd4a97 100644
--- a/inc/admin/forms/login_button.php
+++ b/inc/admin/forms/login_button.php
@@ -11,7 +11,7 @@ $fields['login_button'] = array(
 	'title_config' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Configure the button',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Configure the button',$this->ptd).'</h1>
 		',
 		'widget_no_display' => true
 	),
@@ -26,10 +26,10 @@ $fields['login_button'] = array(
 	'display_on_login_page'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),		
-		'label'=> __('Logout Label',$this->plugin_text_domain),
+		'label'=> __('Logout Label',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2'),
 		'widget_no_display' => true
@@ -37,21 +37,21 @@ $fields['login_button'] = array(
 	
 	'login_redirect_url'=> array(
 		'type'=> 'text',
-		'label'=> __('Width of button',$this->plugin_text_domain),
+		'label'=> __('Width of button',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'logout_redirect_url'=> array(
 		'type'=> 'text',
-		'label'=> __('Url after login',$this->plugin_text_domain),
+		'label'=> __('Url after login',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'logout_label'=> array(
 		'type'=> 'text',
-		'label'=> __('Url after logout',$this->plugin_text_domain),
+		'label'=> __('Url after logout',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -59,10 +59,10 @@ $fields['login_button'] = array(
 	'show_profile_picture'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),		
-		'label'=> __('Show profile picture',$this->plugin_text_domain),
+		'label'=> __('Show profile picture',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
@@ -70,31 +70,31 @@ $fields['login_button'] = array(
 	'show_faces'=> array(
 		'type'=> 'select',
 		'options' => array(
-			array('value'=>'0', 'label'=>__('No',$this->plugin_text_domain)),
-			array('value'=>'1', 'label'=>__('Yes',$this->plugin_text_domain)),							
+			array('value'=>'0', 'label'=>__('No',$this->ptd)),
+			array('value'=>'1', 'label'=>__('Yes',$this->ptd)),							
 		),		
-		'label'=> __('Show faces',$this->plugin_text_domain),
+		'label'=> __('Show faces',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'maxrow'=> array(
 		'type'=> 'text',
-		'label'=> __('Max row',$this->plugin_text_domain),
+		'label'=> __('Max row',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2', 'disabled'=>($this->options['login_button']['show_faces'] == "0" ? 'disabled' : ''))
 	),
 	
 	'width'=> array(
 		'type'=> 'text',
-		'label'=> __('Width of button',$this->plugin_text_domain),
+		'label'=> __('Width of button',$this->ptd),
 		'class'=>'span2',
 		'attr'=> array('class'=>'span2')
 	),
 	
 	'image'=> array(
 		'type'=> 'media',
-		'label'=> __('Button Image',$this->plugin_text_domain),
+		'label'=> __('Button Image',$this->ptd),
 		'class'=> 'span8',
 		'attr'=> array('class'=>'span6')
 	),
@@ -109,9 +109,9 @@ $fields['login_button'] = array(
 	'preview' => array(
 		'type'=>'html',
 		'html'=> '
-			<h1>'.__('Preview',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Preview',$this->ptd).'</h1>
 			<div class="well">'.$this->get_the_login_button().'</div>
-			<h1>'.__('Options List',$this->plugin_text_domain).'</h1>
+			<h1>'.__('Options List',$this->ptd).'</h1>
 			<table class="table table-bordered table-condensed table-striped">
 				<thead>
 					<tr>
diff --git a/inc/admin/forms/plugins_menu.php b/inc/admin/forms/plugins_menu.php
index fbd9242..da12898 100644
--- a/inc/admin/forms/plugins_menu.php
+++ b/inc/admin/forms/plugins_menu.php
@@ -7,10 +7,10 @@
 *
 */
 $list_menu_plugins = array(
-	'like_button_settings' => __('Like Button',$this->plugin_text_domain),
-	'like_box_settings' => __('Like Box',$this->plugin_text_domain),
-	'activity_settings' => __('Activity Feed',$this->plugin_text_domain),
-	'login_button_settings' => __('Login Button',$this->plugin_text_domain),
-	'comments_settings' => __('Comments',$this->plugin_text_domain)
+	'like_button_settings' => __('Like Button',$this->ptd),
+	'like_box_settings' => __('Like Box',$this->ptd),
+	'activity_settings' => __('Activity Feed',$this->ptd),
+	'login_button_settings' => __('Login Button',$this->ptd),
+	'comments_settings' => __('Comments',$this->ptd)
 );
 ?>
\ No newline at end of file
diff --git a/inc/admin/views/admin.php b/inc/admin/views/admin.php
index 1e95254..2fc7707 100755
--- a/inc/admin/views/admin.php
+++ b/inc/admin/views/admin.php
@@ -54,14 +54,22 @@ $current_screen = get_current_screen();
     			<ul class="nav">
 					<?php
 					global $submenu;
-					foreach($submenu[$this->plugin_slug] as $page){
-						if (current_user_can($page[1])){
-							echo '
-							<li '.($_GET['page'] == $page[2] ? 'class="active"': '').'><a href="'.admin_url('admin.php?page='.$page[2]).'" title="'.$page[3].'">'.$page[0].'</a></li>
-							';
+					if(isset($submenu[$this->plugin_slug] )){
+						foreach($submenu[$this->plugin_slug] as $page){
+							if (current_user_can($page[1])){
+								echo '
+								<li '.($_GET['page'] == $page[2] ? 'class="active"': '').'><a href="'.admin_url('admin.php?page='.$page[2]).'" title="'.$page[3].'">'.$page[0].'</a></li>
+								';
+							}
 						}
-					}
+					} 
 					?>
+					<?php if(current_user_can('manage_facebook_awd_settings')){ ?>
+						<li><a href="http://facebook-awd.ahwebdev.fr/plugins/" target="blank" title="Facebook AWD plugins">Facebook AWD plugins</a></li>
+					<?php } ?>
+					<li><a href="http://facebook-awd.ahwebdev.fr/documentation/" target="blank" title="Documentation">Documentation</a></li>
+					<li><a href="http://facebook-awd.ahwebdev.fr/support/" target="blank" title="Support">Support</a></li>
+					<?php ?>
     			</ul>
     			<form class="navbar-search pull-right" action="http://facebook-awd.ahwebdev.fr/" method="GET" target="_blank">
     				<input type="text" name="s" class="search-query span2" placeholder="Search">
diff --git a/inc/admin/views/admin_open_graph.php b/inc/admin/views/admin_open_graph.php
index 6534f22..f6a32a2 100755
--- a/inc/admin/views/admin_open_graph.php
+++ b/inc/admin/views/admin_open_graph.php
@@ -12,7 +12,7 @@
 	<div id="settings_ogp" class="tabbable tabs-left">
 		<div class="tab-content">
 			<div id="ogtags_objects">
-				<h1><?php _e('Create Objects',$this->plugin_text_domain); ?></h1>
+				<h1><?php _e('Create Objects',$this->ptd); ?></h1>
 				<?php $ogp_objects = apply_filters('AWD_facebook_ogp_objects', $this->options['opengraph_objects']); ?>
 				<table class="table table-bordered awd_list_opengraph_object">
 					<thead>
@@ -27,69 +27,28 @@
 						}
 					}
 					echo '<tr class="awd_no_objects '.(is_array($ogp_objects) && count($ogp_objects) ? 'hidden' : '').'">
-							<td colspan="2"><p class="alert alert-warning">'.__('No Object found',$this->plugin_text_domain).'</p></td>
+							<td colspan="2">'.$this->display_messages(__('No Object found',$this->ptd), 'warning', false).'</td>
 						  </tr>';
 					?>
 					</tbody>
 					</tfoot>
-						<tr><td colspan="2"><button class="btn btn-success pull-right show_ogp_form" data-loading-text="<?php _e('Editing...',$this->plugin_text_domain); ?>"><i class="icon-plus icon-white"></i> <?php _e('Add an object',$this->plugin_text_domain); ?></button></td></tr>
+						<tr><td colspan="2"><button class="btn btn-success pull-right show_ogp_form" data-loading-text="<?php _e('Editing...',$this->ptd); ?>"><i class="icon-plus icon-white"></i> <?php _e('Add an object',$this->ptd); ?></button></td></tr>
 					</tfoot>
 				</table>
 				
 				<div class="hidden awd_ogp_form well">
 				</div>
 				
-				<h1><?php _e('Define Objects relation',$this->plugin_text_domain); ?></h1>
-				<div class="alert alert-info">
-					<?php _e('Select the object to use with type of pages.',$this->plugin_text_domain); ?>
-				</div>
+				<h1><?php _e('Define Objects relation',$this->ptd); ?></h1>
+				<?php $this->display_messages(__('Select the object to use with type of pages.',$this->ptd), 'info'); ?>
 				<div class="awd_ogp_links">
 					<?php echo $this->get_open_graph_object_links_form(); ?>
 				</div>
 			</div>
-		
-			<?php
-			
-			/*
-			<?php
-			$postypes_media = get_post_types(array('label'=>'Media'),'objects');
-			$postypes = get_post_types(array('show_ui'=>true),'objects');
-			//if find attachement
-			if(is_object($postypes_media['attachment']))
-					$postypes['attachment'] = $postypes_media['attachment'];
-							//remove page and post form custom
-			unset($postypes['post']);
-			unset($postypes['page']);
-			?>
-			<div id="ogtags_custom_posts" class="tab-pane">
-				<?php 
-				if(!empty($postypes)){
-					foreach($postypes as $postypes_name=>$type_values){
-					}
-				}else{
-					echo '<div class="alert alert-warning"><p>'.__('There is no custom post types',$this->plugin_text_domain).'</p></div>';
-				}
-				?>
-			</div>
-			<?php
-			$taxonomies = get_taxonomies(array('public'=> true,'show_ui'=>true),'objects');
-			?>
-			<div id="ogtags_taxonomies" class="tab-pane">
-				<?php 
-				if(!empty($taxonomies)){
-					foreach($taxonomies as $taxonomie_name=>$tax_values){
-					}
-				}else{
-					echo '<div class="alert alert-warning"><p>'.__('There is no Taxonomies',$this->plugin_text_domain).'</p></div>';
-				}
-				?>
-			</div>
-			*/ 
-			?>
 		</div>
 	</div>
 	<div class="form-actions">
-		<a href="#" id="submit_ogp" class="btn btn-primary" data-loading-text="<i class='icon-time icon-white'></i> <?php _e('Saving settings...',$this->plugin_text_domain); ?>"><i class="icon-cog icon-white"></i> <?php _e('Save all settings',$this->plugin_text_domain); ?></a>
-		<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=ZQ2VL33YXHJLC" class="awd_tooltip_donate btn pull-right" id="help_donate" target="_blank" class="btn pull-right"><i class="icon-heart"></i> <?php _e('Donate!',$this->plugin_text_domain); ?></a>
+		<a href="#" id="submit_ogp" class="btn btn-primary" data-loading-text="<i class='icon-time icon-white'></i> <?php _e('Saving settings...',$this->ptd); ?>"><i class="icon-cog icon-white"></i> <?php _e('Save all settings',$this->ptd); ?></a>
+		<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=ZQ2VL33YXHJLC" class="awd_tooltip_donate btn pull-right" id="help_donate" target="_blank" class="btn pull-right"><i class="icon-heart"></i> <?php _e('Donate!',$this->ptd); ?></a>
 	</div>
 </div>
\ No newline at end of file
diff --git a/inc/admin/views/admin_open_graph_form.php b/inc/admin/views/admin_open_graph_form.php
index f966293..d8a4e39 100755
--- a/inc/admin/views/admin_open_graph_form.php
+++ b/inc/admin/views/admin_open_graph_form.php
@@ -1,51 +1,58 @@
-<h1><?php _e('1. Define Object',$this->plugin_text_domain); ?></h1>
+<h1><?php _e('1. Define Object',$this->ptd); ?></h1>
 
 <?php
-if($object_id == '')
+if(true === ($object_id instanceof AWD_facebook_form)){
 	$object = array('id'=>'','title'=>'%TITLE%');
-else{
+	$form = $object_id;
+}else if($object_id == ''){
+	$object = array('id'=>'','title'=>'%TITLE%');
+	$form = new AWD_facebook_form('form_create_opengraph_object', 'POST', '', $this->plugin_option_pref);
+}else{
 	$object = $this->options['opengraph_objects'][$object_id];
+	$form = new AWD_facebook_form('form_create_opengraph_object', 'POST', '', $this->plugin_option_pref);
 }
+
 if($copy == 'true')
 	unset($object['id']);
 if(!isset($object['object_title']))
 	$object['object_title'] = '';
 	
 $ogp = $this->opengraph_array_to_object($object);
-$form = new AWD_facebook_form('form_create_opengraph_object', 'POST', '', $this->plugin_option_pref);
 
-echo $form->start();
+if(false === ($object_id instanceof AWD_facebook_form))
+	echo $form->start();
+	
 	?>
 	<div class="row">
 		<?php
 		//id of object
 		echo $form->addInputHidden('awd_ogp[id]', $object['id']);
 		//title of object
-		echo $form->addInputText(__('Title of object (only for reference)',$this->plugin_text_domain),  'awd_ogp[object_title]', $object['object_title'], 'span4', array('class'=>'span4'));
+		echo $form->addInputText(__('Title of object (only for reference)',$this->ptd),  'awd_ogp[object_title]', $object['object_title'], 'span4', array('class'=>'span4'));
 		//Locale
 		$locales = $ogp->supported_locales();
 		$_locales = array();
 		foreach($locales as $locale => $label){ $_locales[] = array('value'=>$locale, 'label'=> $label ); }
-		echo $form->addSelect(__('Locale',$this->plugin_text_domain), 'awd_ogp[locale]', $_locales, $ogp->getLocale(), 'span4', array('class'=>'span2'));					
+		echo $form->addSelect(__('Locale',$this->ptd), 'awd_ogp[locale]', $_locales, $ogp->getLocale(), 'span4', array('class'=>'span2'));					
 		?>
 	</div>
 	<div class="row">
 		<?php
 		//Determiners
 		$_determiners = array(
-			array('value'=> 'auto', 'label'=> __('Auto',$this->plugin_text_domain)),
-			array('value'=> 'a', 'label'=> __('A',$this->plugin_text_domain)),
-			array('value'=> 'an', 'label'=> __('An',$this->plugin_text_domain)),
-			array('value'=> 'the', 'label'=> __('The',$this->plugin_text_domain))
+			array('value'=> 'auto', 'label'=> __('Auto',$this->ptd)),
+			array('value'=> 'a', 'label'=> __('A',$this->ptd)),
+			array('value'=> 'an', 'label'=> __('An',$this->ptd)),
+			array('value'=> 'the', 'label'=> __('The',$this->ptd))
 		);
-		echo $form->addSelect(__('The determiner',$this->plugin_text_domain), 'awd_ogp[determiner]', $_determiners, $ogp->getDeterminer(), 'span2', array('class'=>'span2'));					
+		echo $form->addSelect(__('The determiner',$this->ptd), 'awd_ogp[determiner]', $_determiners, $ogp->getDeterminer(), 'span2', array('class'=>'span2'));					
 
 		//title of the page
 		echo $form->addInputText('Title',  'awd_ogp[title]', $ogp->getTitle(), 'span4', array('class'=>'span4'));
 		//type
 		$types = $ogp->supported_types(true);
 		foreach($types as $type){ $options[] = array('value'=>$type, 'label'=> ucfirst($type)); }
-		echo $form->addSelect(__('Type',$this->plugin_text_domain).' '.$this->get_the_help('type'), 'awd_ogp[type]', $options, $ogp->gettype(), 'span2', array('class'=>'span2'));
+		echo $form->addSelect(__('Type',$this->ptd).' '.$this->get_the_help('type'), 'awd_ogp[type]', $options, $ogp->gettype(), 'span2', array('class'=>'span2'));
 		?>
 	</div>
 	<div class="row">
@@ -62,8 +69,8 @@ echo $form->start();
 		echo $form->addInputText('Url',  'awd_ogp[url]', $ogp->getUrl(), 'span4', array('class'=>'span4'));
 		?>
 	</div>
-	<h1><?php _e('2. Add Media to Object',$this->plugin_text_domain); ?></h1>
-	<h2><?php _e('Images',$this->plugin_text_domain); ?> <button class="btn btn-mini awd_add_media_field" data-label="<?php _e('Image url',$this->plugin_text_domain); ?>" data-label2="<?php _e('Upload an Image',$this->plugin_text_domain); ?>" data-type="image" data-name="awd_ogp[images][]"><i class="icon-picture"></i> Add an image</button></h2>
+	<h1><?php _e('2. Add Media to Object',$this->ptd); ?></h1>
+	<h2><?php _e('Images',$this->ptd); ?> <button class="btn btn-mini awd_add_media_field" data-label="<?php _e('Image url',$this->ptd); ?>" data-label2="<?php _e('Upload an Image',$this->ptd); ?>" data-type="image" data-name="awd_ogp[images][]"><i class="icon-picture"></i> Add an image</button></h2>
 	<div class="row">
 		<div class="awd_ogp_fields_image">
 			<?php
@@ -72,41 +79,43 @@ echo $form->start();
 			$images = $object['images'];
 			if(count($images))
 			{
-				echo $form->addMediaButton('Image url', 'awd_ogp[images][]', $images[0],'span8', array('class'=>'span6'), array('data-title'=>__('Upload an Image',$this->plugin_text_domain), 'data-type'=> 'image'), false);
+				echo $form->addMediaButton('Image url', 'awd_ogp[images][]', $images[0],'span8', array('class'=>'span6'), array('data-title'=>__('Upload an Image',$this->ptd), 'data-type'=> 'image'), false);
 				unset($images[0]);
 				foreach($images as $image)
 				{
-					echo $form->addMediaButton('Image url', 'awd_ogp[images][]', $image,'span8', array('class'=>'span6'), array('data-title'=>__('Upload an Image',$this->plugin_text_domain), 'data-type'=> 'image'), true);
+					echo $form->addMediaButton('Image url', 'awd_ogp[images][]', $image,'span8', array('class'=>'span6'), array('data-title'=>__('Upload an Image',$this->ptd), 'data-type'=> 'image'), true);
 				}
 			}else{
-				echo $form->addMediaButton('Image url', 'awd_ogp[images][]', '','span8', array('class'=>'span6'), array('data-title'=>__('Upload an Image',$this->plugin_text_domain), 'data-type'=> 'image'), false);
+				echo $form->addMediaButton('Image url', 'awd_ogp[images][]', '','span8', array('class'=>'span6'), array('data-title'=>__('Upload an Image',$this->ptd), 'data-type'=> 'image'), false);
 			}
 			?>
 		</div>
 	</div>
-	<h2><?php _e('Videos',$this->plugin_text_domain); ?> <button class="btn btn-mini awd_add_media_field" data-label="<?php _e('Video url',$this->plugin_text_domain); ?>" data-label2="<?php _e('Upload an Image',$this->plugin_text_domain); ?>" data-type="video" data-name="awd_ogp[videos][]"><i class="icon-film"></i> Add a video</button></h2>
+	<h2><?php _e('Videos',$this->ptd); ?> <button class="btn btn-mini awd_add_media_field" data-label="<?php _e('Video url',$this->ptd); ?>" data-label2="<?php _e('Upload an Image',$this->ptd); ?>" data-type="video" data-name="awd_ogp[videos][]"><i class="icon-film"></i> Add a video</button></h2>
 	<div class="row">
 		<div class="awd_ogp_fields_video">
-			<?php echo $form->addMediaButton('Video url', 'awd_ogp[videos][]', '','span8', array('class'=>'span6'), array('data-title'=>__('Upload a Video',$this->plugin_text_domain), 'data-type'=> 'video'), false); ?>
+			<?php echo $form->addMediaButton('Video url', 'awd_ogp[videos][]', '','span8', array('class'=>'span6'), array('data-title'=>__('Upload a Video',$this->ptd), 'data-type'=> 'video'), false); ?>
 		</div>
 	</div>
-	<h2><?php _e('Audios',$this->plugin_text_domain); ?> <button class="btn btn-mini awd_add_media_field" data-label="<?php _e('Audio url',$this->plugin_text_domain); ?>" data-label2="<?php _e('Upload an Image',$this->plugin_text_domain); ?>" data-type="audio" data-name="awd_ogp[audios][]"><i class="icon-music"></i> Add a song</button></h2>
+	<h2><?php _e('Audios',$this->ptd); ?> <button class="btn btn-mini awd_add_media_field" data-label="<?php _e('Audio url',$this->ptd); ?>" data-label2="<?php _e('Upload an Image',$this->ptd); ?>" data-type="audio" data-name="awd_ogp[audios][]"><i class="icon-music"></i> Add a song</button></h2>
 	<div class="row">
 		<div class="awd_ogp_fields_audio">
-			<?php echo $form->addMediaButton('Audio url', 'awd_ogp[audios][]', '','span8', array('class'=>'span6'), array('data-title'=>__('Upload a Song',$this->plugin_text_domain), 'data-type'=> 'audio'), false); ?>
+			<?php echo $form->addMediaButton('Audio url', 'awd_ogp[audios][]', '','span8', array('class'=>'span6'), array('data-title'=>__('Upload a Song',$this->ptd), 'data-type'=> 'audio'), false); ?>
 		</div>
 	</div>
-	
-	<div class="form-actions">
-		<div class="btn-group pull-right">
-			<button class="btn btn-primary awd_submit_ogp"><i class="icon-ok icon-white"></i> <?php _e('Save this object',$this->plugin_text_domain); ?></button>
-			<button class="btn btn-danger pull-right hide_ogp_form"><i class="icon-remove icon-white"></i> <?php _e('Cancel',$this->plugin_text_domain); ?></button>
+	<?php if(false === ($object_id instanceof AWD_facebook_form)){ ?>
+		<div class="form-actions">
+			<div class="btn-group pull-right">
+				<button class="btn btn-primary awd_submit_ogp"><i class="icon-ok icon-white"></i> <?php _e('Save this object',$this->ptd); ?></button>
+				<button class="btn btn-danger pull-right hide_ogp_form"><i class="icon-remove icon-white"></i> <?php _e('Cancel',$this->ptd); ?></button>
+			</div>
 		</div>
-	</div>
-	<?php wp_nonce_field($this->plugin_slug.'_save_ogp_object',$this->plugin_option_pref.'_nonce_options_save_ogp_object'); ?>
-<?php echo $form->end();
+		<?php wp_nonce_field($this->plugin_slug.'_save_ogp_object',$this->plugin_option_pref.'_nonce_options_save_ogp_object'); ?>
+		<?php 
+		echo $form->end();
+	}
 ?>
-<h2><?php _e('Preview',$this->plugin_text_domain); ?></h2>
+<h2><?php _e('Preview',$this->ptd); ?></h2>
 <?php
 echo $this->render_ogp_tags($ogp);
 ?>
diff --git a/inc/admin/views/admin_plugins.php b/inc/admin/views/admin_plugins.php
index 60bd9cf..3b11324 100755
--- a/inc/admin/views/admin_plugins.php
+++ b/inc/admin/views/admin_plugins.php
@@ -47,8 +47,9 @@ $form = new AWD_facebook_form('form_settings', 'POST', '', $this->plugin_option_
 			<div class="tab-content">
 			
 				<div id="like_button_settings" class="tab-pane">
-					<p class="alert alert-info"><?php _e('Settings are defaults, you can redefine them in shortcodes, widgets, and themes functions',$this->plugin_text_domain); ?></p>
 					<?php 
+					$this->display_messages(__('Settings are defaults, you can redefine them in shortcodes, widgets, and themes functions',$this->ptd), 'info');
+					
 					if(isset($fields['like_button']) && is_array($fields['like_button'])){
 						echo $form->proccessFields('like_button',$fields['like_button']);
 					}
@@ -56,17 +57,19 @@ $form = new AWD_facebook_form('form_settings', 'POST', '', $this->plugin_option_
 				</div>
 				
 				<div id="like_box_settings" class="tab-pane">
-					<p class="alert alert-info"><?php _e('The like box is added via shortcodes, widgets, and themes functions',$this->plugin_text_domain); ?></p>
 					<?php 
+					$this->display_messages(__('The like box is added via shortcodes, widgets, and themes functions',$this->ptd), 'info');
+					
 					if(isset($fields['like_box']) && is_array($fields['like_box'])){						
 						echo $form->proccessFields('like_box',$fields['like_box']); 
 					}
 					?>
 				</div>
 				
-				<div id="activity_settings" class="tab-pane">
-					<p class="alert alert-info"><?php _e('The activity box is added via shortcodes, widgets, and themes functions',$this->plugin_text_domain); ?></p>
+				<div id="activity_settings" class="tab-pane">				
 					<?php 
+					$this->display_messages(__('The activity box is added via shortcodes, widgets, and themes functions',$this->ptd), 'info');
+
 					if(isset($fields['activity_box']) && is_array($fields['activity_box'])){
 						echo $form->proccessFields('activity_box',$fields['activity_box']);
 					}
@@ -81,19 +84,17 @@ $form = new AWD_facebook_form('form_settings', 'POST', '', $this->plugin_option_
 							echo $form->proccessFields('login_button',$fields['login_button']);
 						}
 					}else{
-						echo '<p class="alert alert-warning">'.__('You must enable FB Connect and set parameters in settings of the plugins',$this->plugin_text_domain).'</p>';
+						$this->display_messages(__('You must enable FB Connect and set parameters in settings of the plugins',$this->ptd), 'error');
 					}
 					?>
 				</div>
 				
 				<div id="comments_settings" class="tab-pane">
-					<p class="alert alert-info">
-						<?php _e('All that settings are defaults, you can redefine them in shortcodes, and themes functions',$this->plugin_text_domain); ?>
-						<br />
-						<i class="icon-warning-sign"></i> <?php _e('Your themes must use the action "do_action("comment_form_after");" or the function "commnent_form();" to work. (look in your theme, in comments.php file)',$this->plugin_text_domain); ?>
-					</p>
-					
 					<?php
+					$message = __('All that settings are defaults, you can redefine them in shortcodes, and themes functions',$this->ptd).'<br />
+					<i class="icon-warning-sign"></i> '.__('Your themes must use the action "do_action("comment_form_after");" or the function "commnent_form();" to work. (look in your theme, in comments.php file)',$this->ptd);
+					$this->display_messages($message, 'info');
+					
 					if(isset($fields['comments_box']) && is_array($fields['comments_box'])){
 						echo $form->proccessFields('comments_box',$fields['comments_box']);
 					}
@@ -127,8 +128,8 @@ $form = new AWD_facebook_form('form_settings', 'POST', '', $this->plugin_option_
 		<?php wp_nonce_field($this->plugin_slug.'_update_options',$this->plugin_option_pref.'_nonce_options_update_field'); ?>
 		
 		<div class="form-actions">
-			<a href="#" id="submit_settings" class="btn btn-primary" data-loading-text="<i class='icon-time icon-white'></i> <?php _e('Saving settings...',$this->plugin_text_domain); ?>"><i class="icon-cog icon-white"></i> <?php _e('Save all settings',$this->plugin_text_domain); ?></a>
-			<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=ZQ2VL33YXHJLC" class="awd_tooltip_donate btn pull-right" id="help_donate" target="_blank" class="btn pull-right"><i class="icon-heart"></i> <?php _e('Donate!',$this->plugin_text_domain); ?></a>
+			<a href="#" id="submit_settings" class="btn btn-primary" data-loading-text="<i class='icon-time icon-white'></i> <?php _e('Saving settings...',$this->ptd); ?>"><i class="icon-cog icon-white"></i> <?php _e('Save all settings',$this->ptd); ?></a>
+			<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=ZQ2VL33YXHJLC" class="awd_tooltip_donate btn pull-right" id="help_donate" target="_blank" class="btn pull-right"><i class="icon-heart"></i> <?php _e('Donate!',$this->ptd); ?></a>
 		</div>
 
 	<?php echo $form->end(); ?>
diff --git a/inc/admin/views/admin_settings.php b/inc/admin/views/admin_settings.php
index e36901f..9c98925 100755
--- a/inc/admin/views/admin_settings.php
+++ b/inc/admin/views/admin_settings.php
@@ -14,156 +14,186 @@ $form = new AWD_facebook_form('form_settings', 'POST', '', $this->plugin_option_
 	<?php echo $form->start(); ?>
 		<div id="settings" class="tabbable tabs-left">
 			<ul id="settings_menu" class="nav nav-tabs">
-				<li><a href="#general" data-toggle="tab">General</a></li>
-				<li><a href="#opengraph" data-toggle="tab">OpenGraph</a></li>
-				<li><a href="#fbconnect" data-toggle="tab">Facebook Connect</a></li>
-				<li><a href="#managepages" data-toggle="tab">Manage Pages</a></li>
+				<?php if(current_user_can('manage_facebook_awd_settings')){ ?>
+					<li><a href="#general" data-toggle="tab">General</a></li>
+					<li><a href="#fbconnect" data-toggle="tab">Facebook Connect</a></li>
+					<li><a href="#opengraph" data-toggle="tab">OpenGraph</a></li>
+				<?php } ?>
+				<?php if(current_user_can('manage_facebook_awd_publish_to_pages')){ ?>
+					<li><a href="#managepages" data-toggle="tab">Manage Pages</a></li>
+				<?php } ?>
 			</ul>
 			<div class="tab-content">
-				<div id="general" class="tab-pane">		
-					<div class="row">
-						<?php 
-						echo $form->addInputText(__('App ID (facebook)',$this->plugin_text_domain).' '.$this->get_the_help('app_id'), 'app_id', $this->options['app_id'], 'span4', array('class'=>'span3'), 'icon-barcode');
-						echo $form->addInputText(__('App SECRET KEY',$this->plugin_text_domain).' '.$this->get_the_help('app_secret_key'), 'app_secret_key', $this->options['app_secret_key'], 'span4', array('class'=>'span3'), 'icon-barcode'); 
-						echo $form->addInputText(__('Admins IDs (facebook)',$this->plugin_text_domain).' '.$this->get_the_help('admins'), 'admins', $this->options['admins'], 'span4', array('class'=>'span3'), 'icon-user'); 
-						?>
-						<div class="span4">
-							<div class="row">
-								<?php 						
-								echo $form->addInputText(__('Locale',$this->plugin_text_domain).' '.$this->get_the_help('locale'), 'locale', $this->options['locale'], 'span2', array('class'=>'span1'), 'icon-flag'); 
-								?>
+				<?php if(current_user_can('manage_facebook_awd_settings')){ ?>
+					<div id="general" class="tab-pane">		
+						<div class="row">
+							<?php 
+							echo $form->addInputText(__('App ID (facebook)',$this->ptd).' '.$this->get_the_help('app_id'), 'app_id', $this->options['app_id'], 'span4', array('class'=>'span3'), 'icon-barcode');
+							echo $form->addInputText(__('App SECRET KEY',$this->ptd).' '.$this->get_the_help('app_secret_key'), 'app_secret_key', $this->options['app_secret_key'], 'span4', array('class'=>'span3'), 'icon-barcode'); 
+							?>
+							<div class="span4">
+								<div class="row">
+									<?php 						
+									echo $form->addInputText(__('Locale',$this->ptd).' '.$this->get_the_help('locale'), 'locale', $this->options['locale'], 'span2', array('class'=>'span1'), 'icon-flag'); 
+									?>
+								</div>
 							</div>
+							<?php
+								echo $form->addSelect(__('Mode Debug ?',$this->ptd).' '.$this->get_the_help('debug_enable'), 'debug_enable', array(
+									array('value'=>0, 'label'=>__('No',$this->ptd)),
+									array('value'=>1, 'label'=>__('Yes',$this->ptd))									
+								), $this->options['debug_enable'], 'span4', array('class'=>'span1'));
+							?>
 						</div>
-						<?php
-							echo $form->addSelect(__('Mode Debug ?',$this->plugin_text_domain).' '.$this->get_the_help('debug_enable'), 'debug_enable', array(
-								array('value'=>0, 'label'=>__('No',$this->plugin_text_domain)),
-								array('value'=>1, 'label'=>__('Yes',$this->plugin_text_domain))									
-							), $this->options['debug_enable'], 'span4', array('class'=>'span1'));
-						?>
-					</div>
-					
-				</div>
-		
-				<div id="opengraph" class="tab-pane">							
-					<div class="row">
-						<?php 
-						echo $form->addSelect(__('Activate Open Graph ?',$this->plugin_text_domain).' '.$this->get_the_help('open_graph_enable'), 'open_graph_enable', array(
-							array('value'=>0, 'label'=>__('No',$this->plugin_text_domain)),
-							array('value'=>1, 'label'=>__('Yes',$this->plugin_text_domain).' '.__('(recommended)',$this->plugin_text_domain))									
-						), $this->options['open_graph_enable'], 'span3', array('class'=>'span3'));
-						?>
-					</div>
-				</div>
-		
-				<div id="fbconnect" class="tab-pane">								
-					<div class="row">
-						<?php 
-						echo $form->addSelect(__('Activate FB Connect ?', $this->plugin_text_domain).' '.$this->get_the_help('connect_enable'),'connect_enable',array(
-							array('value'=>0, 'label'=>__('No',$this->plugin_text_domain)),
-							array('value'=>1, 'label'=>__('Yes',$this->plugin_text_domain))									
-						),$this->options['connect_enable'],'span3',array('class'=>'span3'));
 						
-						echo $form->addSelect(__('Add FB avatar choice ?',$this->plugin_text_domain).' '.$this->get_the_help('connect_fbavatar'), 'connect_fbavatar', array(
-							array('value'=>0, 'label'=>__('No',$this->plugin_text_domain)),
-							array('value'=>1, 'label'=>__('Yes',$this->plugin_text_domain))									
-						), $this->options['connect_fbavatar'], 'span3', array('class'=>'span3 depend_fb_connect', 'disabled'=> $this->options['connect_enable']== '0' ? 'disabled':''));
-						?>
 					</div>
-					<div class="row">
-						<?php
-						echo $form->addInputText(__('Facebook Connect permissions',$this->plugin_text_domain).' '.$this->get_the_help('perms'), 'perms', $this->options['perms'], 'span3', array('class'=>'span3 depend_fb_connect', 'disabled'=> $this->options['connect_enable']== '0' ? 'disabled':'')); 
-						
-						echo $form->addInputText(__('Timeout Facebook connect API',$this->plugin_text_domain).' '.$this->get_the_help('timeout'), 'timeout', $this->options['timeout'], 'span3', array('class'=>'span3 depend_fb_connect', 'disabled'=> $this->options['connect_enable']== '0' ? 'disabled':''));
-						?>
-					</div>
-				</div>
-		
-				<div id="managepages" class="tab-pane">
-				<?php if($this->options['connect_enable'] == 0){ ?>
-					<div class="alert alert-warning"><?php _e('Facebook connect is required to manage pages',$this->plugin_text_domain); ?></div>
-				<?php }else{ ?>		
-					<?php if($this->current_facebook_user_can('publish_stream')){ ?>
-						<div class="alert alert-info"><?php _e('Publish Stream is enabled',$this->plugin_text_domain); ?></div>
-					<?php }else{ ?>
-						<a href="#" data-scope="email,publish_stream" class="get_permissions btn btn-info"><i class="icon-ok-sign icon-white"></i> <?php _e('Authorize App to publish on your pages',$this->plugin_text_domain); ?></a>
-					<?php } ?>
-				
-					<?php if($this->current_facebook_user_can('manage_pages')){ ?>
-						<div class="alert alert-info"><?php _e('Pages can be managed',$this->plugin_text_domain); ?>
-						<a href="#" id="toogle_list_pages" class="btn btn-info"><i class="icon-check icon-white"></i> <?php _e('Select pages to link with Wordpress',$this->plugin_text_domain); ?></a>
-						</div>
-					<?php }else{ ?>
-						<a href="#" data-scope="email,manage_pages" class="get_permissions btn btn-info"><i class="icon-ok-sign icon-white"></i> <?php _e('Authorize App to access your pages',$this->plugin_text_domain); ?></a>
-					<?php } ?>
-					<?php if($this->current_facebook_user_can('manage_pages')){ ?>
-						<div class="toogle_fb_pages hidden well">
-							<h2><?php _e('Check the page you want to sync with your blog.',$this->plugin_text_domain); ?></h2>
-							<?php
-							$fb_pages = $this->me['pages'];
-							if(is_array($fb_pages) AND count($fb_pages)){
-								echo '
-								<table class="table table-striped">
-									<tbody>';
-									foreach($fb_pages as $fb_page){
-										echo '
-										<tr>
-											<td><input value="1" type="checkbox" '.($this->options['fb_publish_to_pages'][$fb_page['id']] == 1 ? 'checked="checked";' : '').' name="'.$this->plugin_option_pref.'fb_publish_to_pages['.$fb_page['id'].']" id="fb_publish_to_pages'.$fb_page['id'].'" /></td>
-											<td><a href="#" class="thumbnail"><img class="fb_pages_picto" src="http://graph.facebook.com/'.$fb_page['id'].'/picture" width="30" height="30" /></a></td>
-											<td>'.$fb_page['name'].'</td>
-											<td>'.$fb_page['id'].'</td>
-											<td>'.$fb_page['category'].'</td>
-										</tr>';
-									}
-								echo '</tbody>
-								</table>';
-							}
+			
+					<div id="opengraph" class="tab-pane">							
+						<div class="row">
+							<?php 
+							echo $form->addSelect(__('Activate Open Graph ?',$this->ptd).' '.$this->get_the_help('open_graph_enable'), 'open_graph_enable', array(
+								array('value'=>0, 'label'=>__('No',$this->ptd)),
+								array('value'=>1, 'label'=>__('Yes',$this->ptd).' '.__('(recommended)',$this->ptd))									
+							), $this->options['open_graph_enable'], 'span3', array('class'=>'span3'));
 							?>
 						</div>
-					<?php } ?>
-					<?php if($this->current_facebook_user_can('publish_stream')){ ?>
+					</div>
+			
+					<div id="fbconnect" class="tab-pane">								
 						<div class="row">
 							<?php 
-							if($this->current_facebook_user_can('manage_pages')){ 
-								echo $form->addSelect(__('Auto publish post on Facebook pages ?',$this->plugin_text_domain).' '.$this->get_the_help('publish_to_pages'), 'publish_to_pages', array(
-									array('value'=>0, 'label'=>__('No',$this->plugin_text_domain)),
-									array('value'=>1, 'label'=>__('Yes',$this->plugin_text_domain))									
-								), $this->options['publish_to_pages'], 'span3', array('class'=>'span3'));
-							} 
+							echo $form->addSelect(__('Activate FB Connect ?', $this->ptd).' '.$this->get_the_help('connect_enable'),'connect_enable',array(
+								array('value'=>0, 'label'=>__('No',$this->ptd)),
+								array('value'=>1, 'label'=>__('Yes',$this->ptd))									
+							),$this->options['connect_enable'],'span3',array('class'=>'span3'));
 							
-							echo $form->addSelect(__('Auto publish post on Facebook profile ?',$this->plugin_text_domain).' '.$this->get_the_help('publish_to_profile'), 'publish_to_profile', array(
-								array('value'=>0, 'label'=>__('No',$this->plugin_text_domain)),
-								array('value'=>1, 'label'=>__('Yes',$this->plugin_text_domain))									
-							), $this->options['publish_to_profile'], 'span3', array('class'=>'span3'));
+							echo $form->addSelect(__('Add FB avatar choice ?',$this->ptd).' '.$this->get_the_help('connect_fbavatar'), 'connect_fbavatar', array(
+								array('value'=>0, 'label'=>__('No',$this->ptd)),
+								array('value'=>1, 'label'=>__('Yes',$this->ptd))									
+							), $this->options['connect_fbavatar'], 'span3', array('class'=>'span3 depend_fb_connect', 'disabled'=> $this->options['connect_enable']== '0' ? 'disabled':''));
 							?>
 						</div>
 						<div class="row">
 							<?php
-							echo $form->addInputText(__('Default link action Text',$this->plugin_text_domain).' '.$this->get_the_help('publish_read_more_text'), 'publish_read_more_text', $this->options['publish_read_more_text'], 'span3', array('class' => 'span3', 'maxlengh'=>'25')); 
+							echo $form->addInputText(__('Facebook Connect permissions',$this->ptd).' '.$this->get_the_help('perms'), 'perms', $this->options['perms'], 'span3', array('class'=>'span3 depend_fb_connect', 'disabled'=> $this->options['connect_enable']== '0' ? 'disabled':'')); 
+							
+							echo $form->addInputText(__('Timeout Facebook connect API',$this->ptd).' '.$this->get_the_help('timeout'), 'timeout', $this->options['timeout'], 'span3', array('class'=>'span3 depend_fb_connect', 'disabled'=> $this->options['connect_enable']== '0' ? 'disabled':''));
 							?>
 						</div>
+					</div>
+				<?php } ?>
+				
+				<?php if(current_user_can('manage_facebook_awd_publish_to_pages')){ ?>
+					<div id="managepages" class="tab-pane">
+					<?php 
+					if($this->options['connect_enable'] == 0){ 
+						$this->display_messages(__('Facebook connect is required to manage pages',$this->ptd), 'error');
+					}else{	
+						if($this->current_facebook_user_can('publish_stream')){
+							$this->display_messages(__('Publish Stream is enabled',$this->ptd), 'success');
+						}else{
+							echo '<a href="#" data-scope="email,publish_stream" class="get_permissions btn btn-info"><i class="icon-ok-sign icon-white"></i> '.__('Authorize App to publish on your pages',$this->ptd).'</a>';
+						}
+					
+						if($this->current_facebook_user_can('manage_pages')){
+							$message = __('Pages can be managed',$this->ptd).' <a href="#" id="toogle_list_pages" class="btn btn-info"><i class="icon-check icon-white"></i> '.__('Select pages to link with Wordpress',$this->ptd).'</a>';
+							$this->display_messages($message, 'success');
+						}else{
+							echo '<a href="#" data-scope="email,manage_pages" class="get_permissions btn btn-info"><i class="icon-ok-sign icon-white"></i> '.__('Authorize App to access your pages',$this->ptd).'</a>';
+						}
+						
+						if($this->current_facebook_user_can('manage_pages')){ ?>
+							<div class="toogle_fb_pages hidden well">
+								<h2><?php _e('Check the page you want to sync with your posts.',$this->ptd); ?></h2>
+								<?php
+								$fb_pages = $this->me['pages'];
+								if(is_array($fb_pages) AND count($fb_pages)){
+									echo '
+									<table class="table table-striped">
+										<thead>
+											<tr>
+												<th>'.__('Publish on ?', $this->ptd).'</th>
+												<th>'.__('Picture', $this->ptd).'</th>
+												<th>'.__('Name', $this->ptd).'</th>
+												<th>'.__('ID', $this->ptd).'</th>
+												<th>'.__('Category', $this->ptd).'</th>
+											</tr>
+										</thead>
+										<tbody>';
+										foreach($fb_pages as $fb_page){
+											$value = isset($this->options['fb_publish_to_pages'][$fb_page['id']]) ? $this->options['fb_publish_to_pages'][$fb_page['id']] : 0;
+											$select = $form->addSelect('', 'fb_publish_to_pages['.$fb_page['id'].']', array(
+												array('value'=>0, 'label'=>__('No',$this->ptd)),
+												array('value'=>1, 'label'=>__('Yes',$this->ptd))									
+											), $value, 'span2', array('class'=>'span2'));
+											echo '
+											<tr>
+												<td>'.$select.'</td>
+												<td><a href="#" class="thumbnail"><img class="fb_pages_picto" src="http://graph.facebook.com/'.$fb_page['id'].'/picture" width="30" height="30" /></a></td>
+												<td>'.$fb_page['name'].'</td>
+												<td>'.$fb_page['id'].'</td>
+												<td>'.$fb_page['category'].'</td>
+											</tr>';
+										}
+									echo '</tbody>
+									</table>';
+								}
+								?>
+							</div>
+						<?php } ?>
+						<?php if($this->current_facebook_user_can('publish_stream') && current_user_can('manage_facebook_awd_settings')){ ?>
+							<div class="row">
+								<?php 
+								if($this->current_facebook_user_can('manage_pages')){ 
+									echo $form->addSelect(__('Auto publish post on Facebook pages ?',$this->ptd).' '.$this->get_the_help('publish_to_pages'), 'publish_to_pages', array(
+										array('value'=>0, 'label'=>__('No',$this->ptd)),
+										array('value'=>1, 'label'=>__('Yes',$this->ptd))									
+									), $this->options['publish_to_pages'], 'span3', array('class'=>'span3'));
+								}
+								
+								echo $form->addSelect(__('Auto publish post on Facebook profile ?',$this->ptd).' '.$this->get_the_help('publish_to_profile'), 'publish_to_profile', array(
+									array('value'=>0, 'label'=>__('No',$this->ptd)),
+									array('value'=>1, 'label'=>__('Yes',$this->ptd))									
+								), $this->options['publish_to_profile'], 'span3', array('class'=>'span3'));
+								?>
+							</div>
+							<div class="row">
+								<?php
+								echo $form->addInputText(__('Default link action Text',$this->ptd).' '.$this->get_the_help('publish_read_more_text'), 'publish_read_more_text', $this->options['publish_read_more_text'], 'span3', array('class' => 'span3', 'maxlengh'=>'25')); 
+								?>
+							</div>
+						<?php } ?>
 					<?php } ?>
+					</div>
 				<?php } ?>
-				</div>
+				
+				
 			</div>
 		</div>
 		<?php wp_nonce_field($this->plugin_slug.'_update_options',$this->plugin_option_pref.'_nonce_options_update_field'); ?>
 		<div class="form-actions">
-			<a href="#" id="submit_settings" class="btn btn-primary" data-loading-text="<i class='icon-time icon-white'></i> <?php _e('Saving settings...',$this->plugin_text_domain); ?>"><i class="icon-cog icon-white"></i> <?php _e('Save all settings',$this->plugin_text_domain); ?></a>
-			<a href="#" id="reset_settings" class="btn btn-danger" data-loading-text="<i class='icon-time icon-white'></i> <?php _e('Waiting for your anwser',$this->plugin_text_domain); ?>"><i class="icon-trash icon-white"></i> <?php _e('Restore defaults settings',$this->plugin_text_domain); ?></a>
-			<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=ZQ2VL33YXHJLC" class="awd_tooltip_donate btn pull-right" id="help_donate" target="_blank" class="btn pull-right"><i class="icon-heart"></i> <?php _e('Donate!',$this->plugin_text_domain); ?></a>
+			<a href="#" id="submit_settings" class="btn btn-primary" data-loading-text="<i class='icon-time icon-white'></i> <?php _e('Saving settings...',$this->ptd); ?>"><i class="icon-cog icon-white"></i> <?php _e('Save all settings',$this->ptd); ?></a>
+			<?php if(current_user_can('manage_facebook_awd_settings')){ ?>
+				<a href="#" id="reset_settings" class="btn btn-danger" data-loading-text="<i class='icon-time icon-white'></i> <?php _e('Waiting for your anwser',$this->ptd); ?>"><i class="icon-trash icon-white"></i> <?php _e('Restore defaults settings',$this->ptd); ?></a>
+			<?php } ?>
+			<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=ZQ2VL33YXHJLC" class="awd_tooltip_donate btn pull-right" id="help_donate" target="_blank" class="btn pull-right"><i class="icon-heart"></i> <?php _e('Donate!',$this->ptd); ?></a>
 		</div>
 	<?php 
 	echo $form->end(); 
 	
 	//reset form
-	$form_reset = new AWD_facebook_form('reset_settings', 'POST', '', $this->plugin_option_pref);
-	echo $form_reset->start();
-	wp_nonce_field($this->plugin_slug.'_reset_options',$this->plugin_option_pref.'_nonce_reset_options');
-	echo $form_reset->end();
+	if(current_user_can('manage_facebook_awd_settings')){
+		$form_reset = new AWD_facebook_form('reset_settings', 'POST', '', $this->plugin_option_pref);
+		echo $form_reset->start();
+		wp_nonce_field($this->plugin_slug.'_reset_options',$this->plugin_option_pref.'_nonce_reset_options');
+		echo $form_reset->end();
+	}
 	?>
 </div>
-<div class="alert alert-error alert_reset_settings alert-block dn">
-	<a href="#" class="close reset_settings_dismiss">&times;</a>      
-	<?php _e("Do you really want to reset all settings (AWD plugins and openGraph settings will be reset) ?",$this->plugin_text_domain); ?>
-	<a href="#" class="btn btn-danger reset_settings_confirm"><?php _e("Restore", $this->plugin_text_domain); ?></a>  
-</div>
\ No newline at end of file
+<?php if(current_user_can('manage_facebook_awd_settings')){ ?>
+	<div class="alert alert-error alert_reset_settings alert-block dn">
+		<a href="#" class="close reset_settings_dismiss">&times;</a>      
+		<?php _e("Do you really want to reset all settings (AWD plugins and openGraph settings will be reset) ?",$this->ptd); ?>
+		<a href="#" class="btn btn-danger reset_settings_confirm"><?php _e("Restore", $this->ptd); ?></a>  
+	</div>
+<?php } ?>
\ No newline at end of file
diff --git a/inc/admin/views/help/plugins.php b/inc/admin/views/help/plugins.php
index c850374..e2d47d9 100755
--- a/inc/admin/views/help/plugins.php
+++ b/inc/admin/views/help/plugins.php
@@ -7,9 +7,9 @@
 *
 */
 ?>
-<div class="header_lightbox_help_title hidden"><img style="vertical-align:middle;" src="<?php echo $this->plugin_url_images; ?>facebook-mini.png" alt="facebook logo"/> <?php _e('Help',$this->plugin_text_domain); ?></div>
+<div class="header_lightbox_help_title hidden"><img style="vertical-align:middle;" src="<?php echo $this->plugin_url_images; ?>facebook-mini.png" alt="facebook logo"/> <?php _e('Help',$this->ptd); ?></div>
 <div id="lightbox_help_like_button_url" class="hidden">
 	<p><?php
-	_e("The url to like, in XFBML, defaults to the current page.",$this->plugin_text_domain); 
+	_e("The url to like, in XFBML, defaults to the current page.",$this->ptd); 
 	?></p>
 </div>
\ No newline at end of file
diff --git a/inc/admin/views/help/settings.php b/inc/admin/views/help/settings.php
index a3ea117..574f6df 100755
--- a/inc/admin/views/help/settings.php
+++ b/inc/admin/views/help/settings.php
@@ -10,103 +10,103 @@
 * Help app id
 */
 ?>
-<div class="header_lightbox_help_title hidden"><img style="vertical-align:middle;" src="<?php echo $this->plugin_url_images; ?>facebook-mini.png" alt="facebook logo"/> <?php _e('Help',$this->plugin_text_domain); ?></div>
+<div class="header_lightbox_help_title hidden"><img style="vertical-align:middle;" src="<?php echo $this->plugin_url_images; ?>facebook-mini.png" alt="facebook logo"/> <?php _e('Help',$this->ptd); ?></div>
 <div id="lightbox_help_debug_enable" class="hidden">
 	<p><?php
-	_e("Help you debugging Facebook AWD object.",$this->plugin_text_domain); 
+	_e("Help you debugging Facebook AWD object.",$this->ptd); 
 	?></p>
 </div>
 <div id="lightbox_help_app_id" class="hidden">
 	<p>
 	<?php
-	printf(__("This is the id of your application on Facebook. You can find this info on your application dashboard on Facebook developers platform. If you have not yet create an application, you can create one %shere%s.",$this->plugin_text_domain),'<a class="btn btn-mini" href="https://www.facebook.com/developers/createapp.php" target="_blank">','</a>'); 
+	printf(__("This is the id of your application on Facebook. You can find this info on your application dashboard on Facebook developers platform. If you have not yet create an application, you can create one %shere%s.",$this->ptd),'<a class="btn btn-mini" href="https://www.facebook.com/developers/createapp.php" target="_blank">','</a>'); 
 	?>
 	</p>
 </div>
 <div id="lightbox_help_app_secret_key" class="hidden">
 	<p>
 	<?php
-	printf(__("This is the secret key of your application on Facebook. You can find this info on your application dashboard on Facebook developers platform. If you have not yet create an application, you can create one %shere%s.",$this->plugin_text_domain),'<a class="btn btn-mini" href="https://www.facebook.com/developers/createapp.php" target="_blank">','</a>'); 
+	printf(__("This is the secret key of your application on Facebook. You can find this info on your application dashboard on Facebook developers platform. If you have not yet create an application, you can create one %shere%s.",$this->ptd),'<a class="btn btn-mini" href="https://www.facebook.com/developers/createapp.php" target="_blank">','</a>'); 
 	?>
 	</p>
 </div>
 <div id="lightbox_help_xfbml" class="hidden">
 	<p>
 	<?php
-	printf(__("Use xfbml parsing, Visit %sthis page%s",$this->plugin_text_domain),'<a class="btn btn-mini" href="https://developers.facebook.com/docs/reference/fbml/" target="_blank">','</a>');
+	printf(__("Use xfbml parsing, Visit %sthis page%s",$this->ptd),'<a class="btn btn-mini" href="https://developers.facebook.com/docs/reference/fbml/" target="_blank">','</a>');
 	
 	?>
-	<br /><i><?php _e('If you set this option to "No" you will never be able to use xfbml',$this->plugin_text_domain); ?></i>
+	<br /><i><?php _e('If you set this option to "No" you will never be able to use xfbml',$this->ptd); ?></i>
 	</p>
 </div>
 
 <div id="lightbox_help_open_graph" class="hidden">
 	<p>
 	<?php
-	printf(__("The Open Graph Protocol enables you to integrate your Web pages into the social graph. It is currently designed for Web pages representing profiles of real-world things — things like movies, sports teams, celebrities, and restaurants. Including Open Graph tags on your Web page, makes your page equivalent to a Facebook Page. This means when a user clicks a Like button on your page, a connection is made between your page and the user. Your page will appear in the ”Likes and Interests” section of the user’s profile, and you have the ability to publish updates to the user. Your page will show up in the same places that Facebook pages show up around the site (e.g. search), and you can target ads to people who like your content. The structured data you provide via the Open Graph Protocol defines how your page will be represented on Facebook. %sRead more%s",$this->plugin_text_domain),'<a class="btn btn-mini" href="https://developers.facebook.com/docs/opengraph/" target="_blank">','</a>'); 
+	printf(__("The Open Graph Protocol enables you to integrate your Web pages into the social graph. It is currently designed for Web pages representing profiles of real-world things — things like movies, sports teams, celebrities, and restaurants. Including Open Graph tags on your Web page, makes your page equivalent to a Facebook Page. This means when a user clicks a Like button on your page, a connection is made between your page and the user. Your page will appear in the ”Likes and Interests” section of the user’s profile, and you have the ability to publish updates to the user. Your page will show up in the same places that Facebook pages show up around the site (e.g. search), and you can target ads to people who like your content. The structured data you provide via the Open Graph Protocol defines how your page will be represented on Facebook. %sRead more%s",$this->ptd),'<a class="btn btn-mini" href="https://developers.facebook.com/docs/opengraph/" target="_blank">','</a>'); 
 	?>
 	</p>
 </div>
 <div id="lightbox_help_connect" class="hidden">
 	<p>
 	<?php
-	printf(__("Facebook helps you simplify and enhance user registration and sign-in by using Facebook as your login system. Users no longer need to fill in yet another registration form or remember another username and password to use your site. As long as the user is signed into Facebook, they are automatically signed into your site as well. Using Facebook for login provides you with all the information you need to create a social, personalized experience from the moment the user visits your site in their browser. %sRead more%s",$this->plugin_text_domain),'<a class="btn btn-mini" href="https://developers.facebook.com/docs/guides/web/#login" target="_blank">','</a>'); 
+	printf(__("Facebook helps you simplify and enhance user registration and sign-in by using Facebook as your login system. Users no longer need to fill in yet another registration form or remember another username and password to use your site. As long as the user is signed into Facebook, they are automatically signed into your site as well. Using Facebook for login provides you with all the information you need to create a social, personalized experience from the moment the user visits your site in their browser. %sRead more%s",$this->ptd),'<a class="btn btn-mini" href="https://developers.facebook.com/docs/guides/web/#login" target="_blank">','</a>'); 
 	?>
 	</p>
 </div>
 <div id="lightbox_help_locale" class="hidden">
 	<p>
 	<?php
-	_e("Lang to use with Facebook (default to en_US, or equal to WPLANG Constant if set in wp-config.php)",$this->plugin_text_domain);
+	_e("Lang to use with Facebook (default to en_US, or equal to WPLANG Constant if set in wp-config.php)",$this->ptd);
 	?>
 	</p>
 </div>
 <div id="lightbox_help_permissions" class="hidden">
 	<p>
 	<?php
-	printf(__('Facebook Connect permissions (example: publish_stream,user_photos,user_status) %sSee the list of permissions%s',$this->plugin_text_domain),'<a class="btn btn-mini" href="https://developers.facebook.com/docs/authentication/permissions/" target="_blank">',"</a>");
+	printf(__('Facebook Connect permissions (example: publish_stream,user_photos,user_status) %sSee the list of permissions%s',$this->ptd),'<a class="btn btn-mini" href="https://developers.facebook.com/docs/authentication/permissions/" target="_blank">',"</a>");
 	?>
 	</p>
 </div>
 <div id="lightbox_help_timeout" class="hidden">
 	<p>
-	<?php _e('This value represents the maximum time in seconds to connect to the Facebook API. If your server is slow, increase this value, then try again',$this->plugin_text_domain); ?>
+	<?php _e('This value represents the maximum time in seconds to connect to the Facebook API. If your server is slow, increase this value, then try again',$this->ptd); ?>
 	</p>
 </div>
 <div id="lightbox_help_page_sync" class="hidden">
 	<p>
-	<?php _e('The plugin can publish on your facebook pages and on your facebook profile when you edit a post, to allow the app to make call to the Facebook api, please ask for custom permissions by clicking on the related\'s button dialog (Stream publish and Manage pages). Then, you will be able to choose which pages you want to sync with your blog by selecting them. After you saved settings, a dedicated web form will appear in post editor to manage published\'s actions',$this->plugin_text_domain); ?>
-	<?php echo sprintf(__('Learn more on %sWiki%s',$this->plugin_text_domain),'<a class="btn btn-mini" href="http://facebook-awd.ahwebdev.fr/documentation/" target="_blank">','</a>'); ?>
+	<?php _e('The plugin can publish on your facebook pages and on your facebook profile when you edit a post, to allow the app to make call to the Facebook api, please ask for custom permissions by clicking on the related\'s button dialog (Stream publish and Manage pages). Then, you will be able to choose which pages you want to sync with your blog by selecting them. After you saved settings, a dedicated web form will appear in post editor to manage published\'s actions',$this->ptd); ?>
+	<?php echo sprintf(__('Learn more on %sWiki%s',$this->ptd),'<a class="btn btn-mini" href="http://facebook-awd.ahwebdev.fr/documentation/" target="_blank">','</a>'); ?>
 	</p>
 </div>
 <div id="lightbox_help_custom_actions" class="hidden">
 	<p>
-	<?php echo sprintf(__('Learn more on %sWiki%s',$this->plugin_text_domain),'<a class="btn btn-mini" href="http://facebook-awd.ahwebdev.fr/documentation/" target="_blank">','</a>'); ?>
+	<?php echo sprintf(__('Learn more on %sWiki%s',$this->ptd),'<a class="btn btn-mini" href="http://facebook-awd.ahwebdev.fr/documentation/" target="_blank">','</a>'); ?>
 	</p>
 </div>
 <div id="lightbox_help_admins" class="hidden">
 	<p><?php
-	_e("This is your Facebook User Id. It's a numeric number. You can find it in your application infos on the facebook developers platform.",$this->plugin_text_domain); 
+	_e("This is your Facebook User Id. It's a numeric number. You can find it in your application infos on the facebook developers platform.",$this->ptd); 
 	?></p>
 </div>
 <div id="lightbox_help_connect_fbavatar_on" class="hidden">
 	<p><?php
-	_e("This will add the Facebook Avatar to the avatar function of Wordpress, You will be able to activate it on the discussion settings.",$this->plugin_text_domain); 
+	_e("This will add the Facebook Avatar to the avatar function of Wordpress, You will be able to activate it on the discussion settings.",$this->ptd); 
 	?></p>
 </div>
 <div id="lightbox_help_publish_to_profile_pages" class="hidden">
 	<p><?php
-	_e("If YES the checkbox in post editor will be always checked.",$this->plugin_text_domain); 
+	_e("If YES the checkbox in post editor will be always checked.",$this->ptd); 
 	?></p>
 </div>      
 <div id="lightbox_help_publish_read_more_text" class="hidden">
 	<p><?php
-	_e("You can redefine the default text use for the action link. This setting can be redefined in the post editor.",$this->plugin_text_domain); 
+	_e("You can redefine the default text use for the action link. This setting can be redefined in the post editor.",$this->ptd); 
 	?></p>
 </div>
-<div class="header_lightbox_donate_title hidden"><img style="vertical-align:middle;" src="<?php echo $this->plugin_url_images; ?>facebook-mini.png" alt="facebook logo"/> <?php _e('I am sure you love it...',$this->plugin_text_domain); ?></div>
+<div class="header_lightbox_donate_title hidden"><img style="vertical-align:middle;" src="<?php echo $this->plugin_url_images; ?>facebook-mini.png" alt="facebook logo"/> <?php _e('I am sure you love it...',$this->ptd); ?></div>
 <div id="lightbox_donate" class="hidden">
 	<p><?php
-	_e("I am sure you love it, you can help me to continue support this plugin...Click!",$this->plugin_text_domain); 
+	_e("I am sure you love it, you can help me to continue support this plugin...Click!",$this->ptd); 
 	?></p>
 </div>
diff --git a/inc/classes/facebook/base_facebook.php b/inc/classes/facebook/base_facebook.php
index 6be1131..ac48a46 100755
--- a/inc/classes/facebook/base_facebook.php
+++ b/inc/classes/facebook/base_facebook.php
@@ -61,7 +61,7 @@ class FacebookApiException extends Exception
   }
 
   /**
-   * @return the associated result object returned by the API server.
+   * Return the associated result object returned by the API server.
    *
    * @return array The result from the API server
    */
@@ -70,7 +70,7 @@ class FacebookApiException extends Exception
   }
 
   /**
-   * @returns the associated type for the error. This will default to
+   * Returns the associated type for the error. This will default to
    * 'Exception' when a type is not available.
    *
    * @return string
@@ -120,17 +120,21 @@ abstract class BaseFacebook
   /**
    * Version.
    */
-  const VERSION = '3.1.1';
+  const VERSION = '3.2.0';
+
+  /**
+   * Signed Request Algorithm.
+   */
+  const SIGNED_REQUEST_ALGORITHM = 'HMAC-SHA256';
 
   /**
    * Default options for curl.
-   * Modified By AHWEBDEV for Facebook awd.
    */
-  public $CURL_OPTS = array(
+  public static $CURL_OPTS = array(
     CURLOPT_CONNECTTIMEOUT => 10,
     CURLOPT_RETURNTRANSFER => true,
     CURLOPT_TIMEOUT        => 60,
-    CURLOPT_USERAGENT      => 'facebook-php-3.1',
+    CURLOPT_USERAGENT      => 'facebook-php-3.2',
   );
 
   /**
@@ -147,12 +151,12 @@ abstract class BaseFacebook
    * Maps aliases to Facebook domains.
    */
   public static $DOMAIN_MAP = array(
-    'api'       => 'https://api.facebook.com/',
-    'api_video' => 'https://api-video.facebook.com/',
-    'api_read'  => 'https://api-read.facebook.com/',
-    'graph'     => 'https://graph.facebook.com/',
+    'api'         => 'https://api.facebook.com/',
+    'api_video'   => 'https://api-video.facebook.com/',
+    'api_read'    => 'https://api-read.facebook.com/',
+    'graph'       => 'https://graph.facebook.com/',
     'graph_video' => 'https://graph-video.facebook.com/',
-    'www'       => 'https://www.facebook.com/',
+    'www'         => 'https://www.facebook.com/',
   );
 
   /**
@@ -163,7 +167,7 @@ abstract class BaseFacebook
   protected $appId;
 
   /**
-   * The Application API Secret.
+   * The Application App Secret.
    *
    * @var string
    */
@@ -202,6 +206,13 @@ abstract class BaseFacebook
   protected $fileUploadSupport = false;
 
   /**
+   * Indicates if we trust HTTP_X_FORWARDED_* headers.
+   *
+   * @var boolean
+   */
+  protected $trustForwarded = false;
+
+  /**
    * Initialize a Facebook Application.
    *
    * The configuration:
@@ -217,13 +228,13 @@ abstract class BaseFacebook
     if (isset($config['fileUpload'])) {
       $this->setFileUploadSupport($config['fileUpload']);
     }
-
+    if (isset($config['trustForwarded']) && $config['trustForwarded']) {
+      $this->trustForwarded = true;
+    }
     $state = $this->getPersistentData('state');
     if (!empty($state)) {
-      $this->state = $this->getPersistentData('state');
+      $this->state = $state;
     }
-    if($config['timeOut_AWD'])
-    	$this->CURL_OPTS[CURLOPT_CONNECTTIMEOUT] = $config['timeOut_AWD'];
   }
 
   /**
@@ -333,6 +344,49 @@ abstract class BaseFacebook
   }
 
   /**
+   * Extend an access token, while removing the short-lived token that might
+   * have been generated via client-side flow. Thanks to http://bit.ly/b0Pt0H
+   * for the workaround.
+   */
+  public function setExtendedAccessToken() {
+    try {
+      // need to circumvent json_decode by calling _oauthRequest
+      // directly, since response isn't JSON format.
+      $access_token_response = $this->_oauthRequest(
+        $this->getUrl('graph', '/oauth/access_token'),
+        $params = array(
+          'client_id' => $this->getAppId(),
+          'client_secret' => $this->getAppSecret(),
+          'grant_type' => 'fb_exchange_token',
+          'fb_exchange_token' => $this->getAccessToken(),
+        )
+      );
+    }
+    catch (FacebookApiException $e) {
+      // most likely that user very recently revoked authorization.
+      // In any event, we don't have an access token, so say so.
+      return false;
+    }
+  
+    if (empty($access_token_response)) {
+      return false;
+    }
+      
+    $response_params = array();
+    parse_str($access_token_response, $response_params);
+    
+    if (!isset($response_params['access_token'])) {
+      return false;
+    }
+    
+    $this->destroySession();
+    
+    $this->setPersistentData(
+      'access_token', $response_params['access_token']
+    );
+  }
+
+  /**
    * Determines the access token that should be used for API calls.
    * The first time this is called, $this->accessToken is set equal
    * to either a valid user access token, or it's set to the application
@@ -363,7 +417,7 @@ abstract class BaseFacebook
    * Determines and returns the user access token, first using
    * the signed request if present, and then falling back on
    * the authorization code if present.  The intent is to
-   * @return a valid user access token, or false if one is determined
+   * return a valid user access token, or false if one is determined
    * to not be available.
    *
    * @return string A valid user access token, or false if one
@@ -391,15 +445,6 @@ abstract class BaseFacebook
           $this->setPersistentData('access_token', $access_token);
           return $access_token;
         }
-      //Update AHWEBDEV for autologin when user come from featured dialog.
-      }else if (isset($_GET['code'])) {
-        $code = $_GET['code'];
-        $access_token = $this->getAccessTokenFromCode($code, '');
-        if ($access_token) {
-          $this->setPersistentData('code', $code);
-          $this->setPersistentData('access_token', $access_token);
-          return $access_token;
-        }
       }
 
       // signed request states there's no access token, so anything
@@ -556,7 +601,7 @@ abstract class BaseFacebook
       'logout.php',
       array_merge(array(
         'next' => $this->getCurrentUrl(),
-        'access_token' => $this->getAccessToken(),
+        'access_token' => $this->getUserAccessToken(),
       ), $params)
     );
   }
@@ -671,7 +716,7 @@ abstract class BaseFacebook
   }
 
   /**
-   * @returns the access token that should be used for logged out
+   * Returns the access token that should be used for logged out
    * users when no authorization code is available.
    *
    * @return string The application access token, useful for gathering
@@ -764,10 +809,13 @@ abstract class BaseFacebook
     // results are returned, errors are thrown
     if (is_array($result) && isset($result['error_code'])) {
       $this->throwAPIException($result);
+      // @codeCoverageIgnoreStart
     }
+    // @codeCoverageIgnoreEnd
 
-    if ($params['method'] === 'auth.expireSession' ||
-        $params['method'] === 'auth.revokeAuthorization') {
+    $method = strtolower($params['method']);
+    if ($method === 'auth.expiresession' ||
+        $method === 'auth.revokeauthorization') {
       $this->destroySession();
     }
 
@@ -775,7 +823,7 @@ abstract class BaseFacebook
   }
 
   /**
-   * @return true if this is video post.
+   * Return true if this is video post.
    *
    * @param string $path The path
    * @param string $method The http method (default 'GET')
@@ -820,7 +868,9 @@ abstract class BaseFacebook
     // results are returned, errors are thrown
     if (is_array($result) && isset($result['error'])) {
       $this->throwAPIException($result);
+      // @codeCoverageIgnoreStart
     }
+    // @codeCoverageIgnoreEnd
 
     return $result;
   }
@@ -865,7 +915,7 @@ abstract class BaseFacebook
       $ch = curl_init();
     }
 
-    $opts = $this->CURL_OPTS;
+    $opts = self::$CURL_OPTS;
     if ($this->getFileUploadSupport()) {
       $opts[CURLOPT_POSTFIELDS] = $params;
     } else {
@@ -894,6 +944,25 @@ abstract class BaseFacebook
       $result = curl_exec($ch);
     }
 
+    // With dual stacked DNS responses, it's possible for a server to
+    // have IPv6 enabled but not have IPv6 connectivity.  If this is
+    // the case, curl will try IPv4 first and if that fails, then it will
+    // fall back to IPv6 and the error EHOSTUNREACH is returned by the
+    // operating system.
+    if ($result === false && empty($opts[CURLOPT_IPRESOLVE])) {
+        $matches = array();
+        $regex = '/Failed to connect to ([^:].*): Network is unreachable/';
+        if (preg_match($regex, curl_error($ch), $matches)) {
+          if (strlen(@inet_pton($matches[1])) === 16) {
+            self::errorLog('Invalid IPv6 configuration on server, '.
+                           'Please disable or get native IPv6 on your server.');
+            self::$CURL_OPTS[CURLOPT_IPRESOLVE] = CURL_IPRESOLVE_V4;
+            curl_setopt($ch, CURLOPT_IPRESOLVE, CURL_IPRESOLVE_V4);
+            $result = curl_exec($ch);
+          }
+        }
+    }
+
     if ($result === false) {
       $e = new FacebookApiException(array(
         'error_code' => curl_errno($ch),
@@ -922,8 +991,9 @@ abstract class BaseFacebook
     $sig = self::base64UrlDecode($encoded_sig);
     $data = json_decode(self::base64UrlDecode($payload), true);
 
-    if (strtoupper($data['algorithm']) !== 'HMAC-SHA256') {
-      self::errorLog('Unknown algorithm. Expected HMAC-SHA256');
+    if (strtoupper($data['algorithm']) !== self::SIGNED_REQUEST_ALGORITHM) {
+      self::errorLog(
+        'Unknown algorithm. Expected ' . self::SIGNED_REQUEST_ALGORITHM);
       return null;
     }
 
@@ -939,6 +1009,26 @@ abstract class BaseFacebook
   }
 
   /**
+   * Makes a signed_request blob using the given data.
+   *
+   * @param array The data array.
+   * @return string The signed request.
+   */
+  protected function makeSignedRequest($data) {
+    if (!is_array($data)) {
+      throw new InvalidArgumentException(
+        'makeSignedRequest expects an array. Got: ' . print_r($data, true));
+    }
+    $data['algorithm'] = self::SIGNED_REQUEST_ALGORITHM;
+    $data['issued_at'] = time();
+    $json = json_encode($data);
+    $b64 = self::base64UrlEncode($json);
+    $raw_sig = hash_hmac('sha256', $b64, $this->getAppSecret(), $raw = true);
+    $sig = self::base64UrlEncode($raw_sig);
+    return $sig.'.'.$b64;
+  }
+
+  /**
    * Build the URL for api given parameters.
    *
    * @param $method String the method name.
@@ -1039,23 +1129,53 @@ abstract class BaseFacebook
     return $url;
   }
 
+  protected function getHttpHost() {
+    if ($this->trustForwarded && isset($_SERVER['HTTP_X_FORWARDED_HOST'])) {
+      return $_SERVER['HTTP_X_FORWARDED_HOST'];
+    }
+    return $_SERVER['HTTP_HOST'];
+  }
+
+  protected function getHttpProtocol() {
+    if ($this->trustForwarded && isset($_SERVER['HTTP_X_FORWARDED_PROTO'])) {
+      if ($_SERVER['HTTP_X_FORWARDED_PROTO'] === 'https') {
+        return 'https';
+      }
+      return 'http';
+    }
+    if (isset($_SERVER['HTTPS']) &&
+        ($_SERVER['HTTPS'] === 'on' || $_SERVER['HTTPS'] == 1)) {
+      return 'https';
+    }
+    return 'http';
+  }
+
   /**
-   * @returns the Current URL, stripping it of known FB parameters that should
+   * Get the base domain used for the cookie.
+   */
+  protected function getBaseDomain() {
+    // The base domain is stored in the metadata cookie if not we fallback
+    // to the current hostname
+    $metadata = $this->getMetadataCookie();
+    if (array_key_exists('base_domain', $metadata) &&
+        !empty($metadata['base_domain'])) {
+      return trim($metadata['base_domain'], '.');
+    }
+    return $this->getHttpHost();
+  }
+
+  /**
+
+  /**
+   * Returns the Current URL, stripping it of known FB parameters that should
    * not persist.
    *
    * @return string The current URL
    */
   protected function getCurrentUrl() {
-    if (isset($_SERVER['HTTPS']) &&
-        ($_SERVER['HTTPS'] == 'on' || $_SERVER['HTTPS'] == 1) ||
-        isset($_SERVER['HTTP_X_FORWARDED_PROTO']) &&
-        $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https') {
-      $protocol = 'https://';
-    }
-    else {
-      $protocol = 'http://';
-    }
-    $currentUrl = $protocol . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];
+    $protocol = $this->getHttpProtocol() . '://';
+    $host = $this->getHttpHost();
+    $currentUrl = $protocol.$host.$_SERVER['REQUEST_URI'];
     $parts = parse_url($currentUrl);
 
     $query = '';
@@ -1086,10 +1206,10 @@ abstract class BaseFacebook
   }
 
   /**
-   * @returns true if and only if the key or key/value pair should
+   * Returns true if and only if the key or key/value pair should
    * be retained as part of the query string.  This amounts to
    * a brute-force search of the very small list of Facebook-specific
-   * @params that should be stripped out.
+   * params that should be stripped out.
    *
    * @param string $param A key or key/value pair within a URL's query (e.g.
    *                     'foo=a', 'foo=', or 'foo'.
@@ -1158,6 +1278,7 @@ abstract class BaseFacebook
    * Exactly the same as base64_encode except it uses
    *   - instead of +
    *   _ instead of /
+   *   No padded =
    *
    * @param string $input base64UrlEncoded string
    * @return string
@@ -1167,6 +1288,21 @@ abstract class BaseFacebook
   }
 
   /**
+   * Base64 encoding that doesn't need to be urlencode()ed.
+   * Exactly the same as base64_encode except it uses
+   *   - instead of +
+   *   _ instead of /
+   *
+   * @param string $input string
+   * @return string base64Url encoded string
+   */
+  protected static function base64UrlEncode($input) {
+    $str = strtr(base64_encode($input), '+/', '-_');
+    $str = str_replace('=', '', $str);
+    return $str;
+  }
+
+  /**
    * Destroy the current session
    */
   public function destroySession() {
@@ -1181,23 +1317,16 @@ abstract class BaseFacebook
     if (array_key_exists($cookie_name, $_COOKIE)) {
       unset($_COOKIE[$cookie_name]);
       if (!headers_sent()) {
-        // The base domain is stored in the metadata cookie if not we fallback
-        // to the current hostname
-        $base_domain = '.'. $_SERVER['HTTP_HOST'];
-
-        $metadata = $this->getMetadataCookie();
-        if (array_key_exists('base_domain', $metadata) &&
-            !empty($metadata['base_domain'])) {
-          $base_domain = $metadata['base_domain'];
-        }
-
-        setcookie($cookie_name, '', 0, '/', $base_domain);
+        $base_domain = $this->getBaseDomain();
+        setcookie($cookie_name, '', 1, '/', '.'.$base_domain);
       } else {
+        // @codeCoverageIgnoreStart
         self::errorLog(
           'There exists a cookie that we wanted to clear that we couldn\'t '.
           'clear because headers was already sent. Make sure to do the first '.
-          'API call before outputing anything'
+          'API call before outputing anything.'
         );
+        // @codeCoverageIgnoreEnd
       }
     }
   }
@@ -1233,6 +1362,21 @@ abstract class BaseFacebook
     return $metadata;
   }
 
+  protected static function isAllowedDomain($big, $small) {
+    if ($big === $small) {
+      return true;
+    }
+    return self::endsWith($big, '.'.$small);
+  }
+
+  protected static function endsWith($big, $small) {
+    $len = strlen($small);
+    if ($len === 0) {
+      return true;
+    }
+    return substr($big, -$len) === $small;
+  }
+
   /**
    * Each of the following four methods should be overridden in
    * a concrete subclass, as they are in the provided Facebook class.
diff --git a/inc/classes/facebook/class.AWD_facebook_api.php b/inc/classes/facebook/class.AWD_facebook_api.php
new file mode 100644
index 0000000..2407e60
--- /dev/null
+++ b/inc/classes/facebook/class.AWD_facebook_api.php
@@ -0,0 +1,33 @@
+<?php 
+/**
+ * 
+ *
+ * @author Alexandre Hermann
+ * @version 1.4
+ * @copyright AHWEBDEV, 6 June, 2012
+ * @package Facebook AWD
+ **/
+require_once(dirname(__FILE__).'/facebook.php');
+
+class AWD_facebook_api extends Facebook
+{
+	
+	public function __construct($options)
+	{
+		self::$CURL_OPTS = array(
+			CURLOPT_CONNECTTIMEOUT => 10,
+			CURLOPT_RETURNTRANSFER => true,
+			CURLOPT_TIMEOUT        => $options['timeout'],
+			CURLOPT_USERAGENT      => 'facebook-php-3.2',
+		);
+		
+		parent::__construct(array(
+			'appId'  => $options['app_id'],
+			'secret' => $options['app_secret_key'],
+			'timeOut' => $options['timeout'],
+		));	
+		
+		$this->setExtendedAccessToken();
+	}
+}
+?>
\ No newline at end of file
diff --git a/inc/classes/facebook/facebook.php b/inc/classes/facebook/facebook.php
index c577c2a..a2238ef 100755
--- a/inc/classes/facebook/facebook.php
+++ b/inc/classes/facebook/facebook.php
@@ -23,13 +23,25 @@ require_once "base_facebook.php";
  */
 class Facebook extends BaseFacebook
 {
+  const FBSS_COOKIE_NAME = 'fbss';
+
+  // We can set this to a high number because the main session
+  // expiration will trump this.
+  const FBSS_COOKIE_EXPIRE = 31556926; // 1 year
+
+  // Stores the shared session ID if one is set.
+  protected $sharedSessionID;
+
   /**
    * Identical to the parent constructor, except that
    * we start a PHP session to store the user ID and
    * access token if during the course of execution
    * we discover them.
    *
-   * @param Array $config the application configuration.
+   * @param Array $config the application configuration. Additionally
+   * accepts "sharedSession" as a boolean to turn on a secondary
+   * cookie for environments with a shared session (that is, your app
+   * shares the domain with other apps).
    * @see BaseFacebook::__construct in facebook.php
    */
   public function __construct($config) {
@@ -37,11 +49,50 @@ class Facebook extends BaseFacebook
       session_start();
     }
     parent::__construct($config);
+    if (!empty($config['sharedSession'])) {
+      $this->initSharedSession();
+    }
   }
 
   protected static $kSupportedKeys =
     array('state', 'code', 'access_token', 'user_id');
 
+  protected function initSharedSession() {
+    $cookie_name = $this->getSharedSessionCookieName();
+    if (isset($_COOKIE[$cookie_name])) {
+      $data = $this->parseSignedRequest($_COOKIE[$cookie_name]);
+      if ($data && !empty($data['domain']) &&
+          self::isAllowedDomain($this->getHttpHost(), $data['domain'])) {
+        // good case
+        $this->sharedSessionID = $data['id'];
+        return;
+      }
+      // ignoring potentially unreachable data
+    }
+    // evil/corrupt/missing case
+    $base_domain = $this->getBaseDomain();
+    $this->sharedSessionID = md5(uniqid(mt_rand(), true));
+    $cookie_value = $this->makeSignedRequest(
+      array(
+        'domain' => $base_domain,
+        'id' => $this->sharedSessionID,
+      )
+    );
+    $_COOKIE[$cookie_name] = $cookie_value;
+    if (!headers_sent()) {
+      $expire = time() + self::FBSS_COOKIE_EXPIRE;
+      setcookie($cookie_name, $cookie_value, $expire, '/', '.'.$base_domain);
+    } else {
+      // @codeCoverageIgnoreStart
+      self::errorLog(
+        'Shared session ID cookie could not be set! You must ensure you '.
+        'create the Facebook instance before headers have been sent. This '.
+        'will cause authentication issues after the first request.'
+      );
+      // @codeCoverageIgnoreEnd
+    }
+  }
+
   /**
    * Provides the implementations of the inherited abstract
    * methods.  The implementation uses PHP sessions to maintain
@@ -83,11 +134,27 @@ class Facebook extends BaseFacebook
     foreach (self::$kSupportedKeys as $key) {
       $this->clearPersistentData($key);
     }
+    if ($this->sharedSessionID) {
+      $this->deleteSharedSessionCookie();
+    }
+  }
+
+  protected function deleteSharedSessionCookie() {
+    $cookie_name = $this->getSharedSessionCookieName();
+    unset($_COOKIE[$cookie_name]);
+    $base_domain = $this->getBaseDomain();
+    setcookie($cookie_name, '', 1, '/', '.'.$base_domain);
+  }
+
+  protected function getSharedSessionCookieName() {
+    return self::FBSS_COOKIE_NAME . '_' . $this->getAppId();
   }
 
   protected function constructSessionVariableName($key) {
-    return implode('_', array('fb',
-                              $this->getAppId(),
-                              $key));
+    $parts = array('fb', $this->getAppId(), $key);
+    if ($this->sharedSessionID) {
+      array_unshift($parts, $this->sharedSessionID);
+    }
+    return implode('_', $parts);
   }
 }
diff --git a/inc/classes/plugins/class.AWD_facebook_plugin_abstract.php b/inc/classes/plugins/class.AWD_facebook_plugin_abstract.php
index 80233ed..4de1324 100755
--- a/inc/classes/plugins/class.AWD_facebook_plugin_abstract.php
+++ b/inc/classes/plugins/class.AWD_facebook_plugin_abstract.php
@@ -53,7 +53,7 @@ abstract class AWD_facebook_plugin_abstract implements AWD_facebook_plugin_inter
 	{	
 		$this->plugin_url = plugins_url(basename(dirname(dirname(dirname($this->file)))));
 		$this->plugin_url_images = $this->plugin_url."/assets/css/images/";
-		load_plugin_textdomain($this->plugin_text_domain,false,dirname(plugin_basename($this->file)).'/langs/');
+		load_plugin_textdomain($this->ptd,false,dirname(plugin_basename($this->file)).'/langs/');
 		
 		if($this->AWD_facebook->options['connect_enable'] != 1 && $this->deps['connect'] == 1){
 			add_action('AWD_facebook_admin_notices',array(&$this,'missing_facebook_connect'));
@@ -81,15 +81,15 @@ abstract class AWD_facebook_plugin_abstract implements AWD_facebook_plugin_inter
 
 	public function missing_facebook_connect()
 	{
-		echo '<div class="alert alert-error"><p>'.$this->plugin_name.' '.__("can not be activated: Facebook AWD All in One - Facebook Connect plugin must be activated",$this->plugin_text_domain).'</p></div>';
+		$AWD_facebook->display_messages($this->plugin_name.' '.__("can not be activated: Facebook AWD All in One - Facebook Connect plugin must be activated",$this->ptd), 'error');
 	}
 	public function old_parent()
 	{
-		echo '<div class="alert alert-error"><p>'.$this->plugin_name.' '.__("can not be activated: Facebook AWD All in One plugin is out to date... You can download the last version or update it from the Wordpress plugin directory",$this->plugin_text_domain).'</p></div>';
+		$AWD_facebook->display_messages($this->plugin_name.' '.__("can not be activated: Facebook AWD All in One plugin is out to date... You can download the last version or update it from the Wordpress plugin directory",$this->ptd), 'error');
 	}
 	public function missing_parent()
 	{
-		echo '<div class="alert alert-error"><p>'.$this->plugin_name.' '.__("can not be activated: Facebook AWD All in One plugin must be installed... you can download it from the Wordpress plugin directory",$this->plugin_text_domain).'</p></div>';
+		$AWD_facebook->display_messages($this->plugin_name.' '.__("can not be activated: Facebook AWD All in One plugin must be installed... you can download it from the Wordpress plugin directory",$this->ptd), 'error');
 	}
 	public function deactivation(){}
 	public function activation(){}
diff --git a/inc/classes/tools/class.AWD_facebook_form.php b/inc/classes/tools/class.AWD_facebook_form.php
index 0ec5e2d..05edd19 100644
--- a/inc/classes/tools/class.AWD_facebook_form.php
+++ b/inc/classes/tools/class.AWD_facebook_form.php
@@ -55,21 +55,40 @@ class AWD_facebook_form
 		return $html;
 	}
 	
+	public function addInputCheckBox($id, $value, $class='', $attrs = array())
+	{
+		$field_id = $this->getFieldId($id);
+		$html = '<input type="checkbox" id="'.$field_id.'" '.($value == 1 ? 'checked="checked"' : '').'name="'.$this->prefix.$id.'" value="1" '.$this->processAttr($attrs).' />';
+		return $html;
+	}
+
 	public function addInputHidden($id, $value, $class='', $attrs = array())
 	{
 		$field_id = $this->getFieldId($id);
 		$html = '<input type="hidden" id="'.$field_id.'" name="'.$this->prefix.$id.'" value="'.$value.'" '.$this->processAttr($attrs).' />';
 		return $html;
 	}
-
-
 	
-	public function addInputText($label, $id, $value, $class='', $attrs = array(), $prepend = '',$append ='')
+	public function addInputTextArea($label, $id, $value, $class='', $attrs = array())
 	{
 		$field_id = $this->getFieldId($id);
 		$html ='
 		<div class="'.$class.'">
-			<label for="'.$field_id.'">'.$label.'</label>';
+			<label for="'.$field_id.'">'.$label.'</label>
+			<textarea id="'.$field_id.'" name="'.$this->prefix.$id.'" '.$this->processAttr($attrs).'>'.$value.'</textarea>
+		</div>';
+		return $html;
+	}
+	
+	public function addInputText($label, $id, $value, $class='', $attrs = array(), $prepend = '',$append ='')
+	{
+		$field_id = $this->getFieldId($id);
+		$html ='
+		<div class="'.$class.'">';
+			if($label != ''){
+				$html .='
+				<label for="'.$field_id.'">'.$label.'</label>';
+			}
 			if($prepend != '' OR $append){
 				$html .= '
 				<div class="'.($append != '' ? 'input-append' : '').' '.($prepend != '' ? 'input-prepend' : '').' ">';
diff --git a/inc/classes/tools/class.AWD_facebook_options.php b/inc/classes/tools/class.AWD_facebook_options.php
index e100db6..44a3b7a 100755
--- a/inc/classes/tools/class.AWD_facebook_options.php
+++ b/inc/classes/tools/class.AWD_facebook_options.php
@@ -39,7 +39,7 @@ class AWD_facebook_options
 		$this->wpdb = $wpdb;
 		$this->prefix = $prefix;
 		//call filter for undefined vars
-		add_filter($this->filterName, array($this,'defaultOptions'), 10, 1);
+		add_filter($this->filterName, array($this,'checkConfig'), 10, 1);
 		//ban hosts
 		$this->ban_hosts = array('Y2l0eXZpbGxlY2hhdC5jb20=');
 	}
@@ -54,7 +54,20 @@ class AWD_facebook_options
 	 */
 	public function setDefaultValue($options_name, $default_value)
 	{
-		if(empty($this->options[$options_name])){
+		
+		if(isset($this->options[$options_name])){
+			if(is_array($default_value)){
+				if(count($this->options[$options_name]) == 0){
+					$this->options[$options_name] = $default_value;
+				}else{
+					$this->options[$options_name] = array_merge($default_value, $this->options[$options_name]);
+				}
+			}else{
+				if($this->options[$options_name] == ''){
+					$this->options[$options_name] = $default_value;
+				}
+			}
+		}else{
 			$this->options[$options_name] = $default_value;
 		}
 	}
@@ -65,13 +78,13 @@ class AWD_facebook_options
 	 * @param   object   wpdb instance
 	 * @return  void
 	 */
-    public function defaultOptions($options)
+    public function checkConfig($options)
     {
 		global $AWD_facebook;
 		$this->options = $options;
 		
 		//Languages
-		if($this->options['locale']==''){
+		if(!isset($this->options['locale'])){
 		    if(defined('WPLANG')){
 		        if(WPLANG==''){
 		            $this->setDefaultValue('locale', 'en_US');
@@ -82,22 +95,21 @@ class AWD_facebook_options
 		}
 		
 		//Permissions
-		$perms = '';
-		$perms_admin = '';
-		$array_perms = explode(",",$this->options['perms']);
+		$perms = $perms_admin = isset($this->options['perms']) ? $this->options['perms'] : '';
+		$array_perms = explode(",",$perms);
 		if(!in_array('email',$array_perms))
-			$perms = 'email,'.$this->options['perms'];  
+			$perms = rtrim('email,'.$perms,',');
+			
 		if(current_user_can('manage_options'))
 			if(!in_array('manage_pages',$array_perms))
-				$perms_admin = 'manage_pages,';
-		if($AWD_facebook->current_facebook_user_can('publish_stream'))
-        	if(!in_array('publish_stream',$array_perms))
-				$perms_admin .= 'publish_stream,';
-		$perms = str_replace(' ','',rtrim($this->options['perms'],','));
-		$perms_admin = str_replace(' ','',rtrim($this->options['perms_admin'],','));
+				$perms_admin = 'manage_pages,publish_stream';
+		$perms = str_replace(' ','',rtrim($perms,','));
 		$this->setDefaultValue('perms', $perms);
-		$this->setDefaultValue('perms_admin', $perms.' '.$perms_admin);
-		
+
+		//always reset perms admin as we can't manage them
+		$perms_admin = str_replace(' ','',rtrim($perms.','.$perms_admin,','));
+		$this->options['perms_admin'] =  $perms.' '.$perms_admin;
+				
 		//Plugin and options
 		$this->setDefaultValue('connect_enable', 0);
 		$this->setDefaultValue('open_graph_enable', 1);
@@ -105,8 +117,10 @@ class AWD_facebook_options
 		$this->setDefaultValue('debug_enable', 0);
 		$this->setDefaultValue('publish_to_profile', 0);
 		$this->setDefaultValue('publish_to_pages', 0);
-		$this->setDefaultValue('publish_message_text', '');
-		$this->setDefaultValue('publish_read_more_text', __('Read More',$AWD_facebook->plugin_text_domain));
+		$this->setDefaultValue('publish_message_text', null);
+		$this->setDefaultValue('publish_read_more_text', __('Read More',$AWD_facebook->ptd));
+		$this->setDefaultValue('fb_publish_to_pages', null);
+
 		
 		//API
 		$this->setDefaultValue('app_id', '');
@@ -118,7 +132,14 @@ class AWD_facebook_options
 		//OPENGRAPH
 		$this->setDefaultValue('opengraph_objects', array());
 		$this->setDefaultValue('opengraph_object_links', array());
-
+		$this->setDefaultValue('opengraph_contexts', array(
+			'frontpage' => __('Frontpage',$AWD_facebook->ptd),
+			'page' => __('Pages',$AWD_facebook->ptd),
+			'post' => __('Posts',$AWD_facebook->ptd),
+			'archive' => __('Archives',$AWD_facebook->ptd),
+			'author' => __('Authors',$AWD_facebook->ptd)		
+		));
+		
 		//Plugins options	
 		$like_button = array
 		(
@@ -185,7 +206,7 @@ class AWD_facebook_options
 			'display_on_login_page' 		=> 0,
 			'login_redirect_url' 			=> '',
 			'logout_redirect_url' 			=> '',
-			'logout_label' 					=> __('Logout', $AWD_facebook->plugin_text_domain),
+			'logout_label' 					=> __('Logout', $AWD_facebook->ptd),
 			'show_profile_picture'			=> 1,
 			'show_faces'					=> 0,
 			'maxrow'						=> 1,
@@ -204,10 +225,28 @@ class AWD_facebook_options
 			'mobile'						=> 0,
 			'on_pages'						=> 0,
 			'on_posts'						=> 0,
+			'on_custom_post_types'          => 0,
 			'exclude_post_id'				=> ''
 		);
 		$this->setDefaultValue('comments_box', $comments_box);
 		
+		$this->setDefaultValue('content_manager', array(
+			'like_button' 	=> array(
+				'redefine'	=>0,
+				'enabled'	=>1,
+				'place'		=>'top'
+			),
+			'fbpublish' => array(
+				'to_pages' 		=> $this->options['publish_to_pages'],
+				'to_profile'	=> $this->options['publish_to_profile'],
+				'message_text'	=> $this->options['publish_message_text'],
+				'read_more_text'=> $this->options['publish_read_more_text']
+			),
+			'opengraph' => array(
+				'object_link' => ''
+			),
+		));
+		
         return $this->options;
     }
 	
@@ -229,7 +268,9 @@ class AWD_facebook_options
 	 */
 	public function setOptions($options)
 	{
-		$this->options = $options;
+		//merge old options with new one
+		$old_options = get_option($this->filterName);
+		$this->options = array_replace_recursive($old_options, $options);
 	}
 	
 	/**
@@ -248,25 +289,20 @@ class AWD_facebook_options
 	 */
 	public function save()
 	{
-		$old_options = get_option($this->filterName);
-		//create new options
-		$this->options = is_array($old_options) ? array_merge($old_options, $this->options) : $this->options;
-		
-		//verify default value
-		$this->defaultOptions($this->options);
-		update_option($this->filterName, $this->options);
-		$this->load();
+		update_option($this->filterName, $this->checkConfig($this->options));
 	}
 	
 	/**
 	 * Add option
 	 * Save options in options table wp
 	 */
-	public function update_option($name,$value,$flush=false)
+	public function updateOption($name,$value,$flush=false)
 	{
 		$this->options[$name] = $value;
 		if($flush === true)
 			$this->save();
+			
+		return $this->options[$name];
 	}
 	
 	/**
diff --git a/inc/classes/tools/class.AWD_facebook_widget.php b/inc/classes/tools/class.AWD_facebook_widget.php
index 34b905d..46b62c0 100644
--- a/inc/classes/tools/class.AWD_facebook_widget.php
+++ b/inc/classes/tools/class.AWD_facebook_widget.php
@@ -56,11 +56,11 @@ class AWD_facebook_widget extends WP_Widget {
 		$this->id_base = $options['id_base'];
 		$this->model = $options['model'];
 		$this->self_callback = $options['self_callback'];
-		$this->plugin_text_domain = $options['text_domain'];
-		$this->plugin_text_domain = $options['text_domain'];
+		$this->ptd = $options['text_domain'];
+		$this->ptd = $options['text_domain'];
 		$this->preview = $options['preview'];
 		
-		//load_plugin_textdomain($this->plugin_text_domain, false, dirname(dirname( plugin_basename( __FILE__ ) ) ) . '/langs/');
+		//load_plugin_textdomain($this->ptd, false, dirname(dirname( plugin_basename( __FILE__ ) ) ) . '/langs/');
 		
         parent::WP_Widget($this->id_base, $this->name , $options);
     }
diff --git a/inc/init.php b/inc/init.php
index 4382d1b..fa193f9 100755
--- a/inc/init.php
+++ b/inc/init.php
@@ -14,7 +14,7 @@ $this->plugin_url = plugins_url($plugin_directory);
 $this->plugin_url_images = $this->plugin_url."/assets/img/";
 
 //TRANSLATION
-load_plugin_textdomain($this->plugin_text_domain,false,dirname( plugin_basename( __FILE__ ) ) . '/langs/');
+load_plugin_textdomain($this->ptd,false,dirname( plugin_basename( __FILE__ ) ) . '/langs/');
 
 //init
 add_action("init",array(&$this,'wp_init'));
@@ -22,8 +22,10 @@ add_action('admin_init', array(&$this,'admin_initialisation'));
 
 //DISPLAY ADMIN
 add_action('admin_bar_init', array(&$this,'admin_bar_init'));
+
 add_action('AWD_facebook_admin_notices',array(&$this,'missing_config'));
-add_action('AWD_facebook_admin_notices',array(&$this,'display_errors'));
+add_action('AWD_facebook_admin_notices',array(&$this,'display_all_errors'));
+add_action('AWD_facebook_admin_notices',array(&$this,'display_messages'));
 
 add_action('admin_menu', array(&$this,'admin_menu'));
 add_action('network_admin_menu', array(&$this,'add_js_options'));
@@ -40,8 +42,8 @@ add_action('admin_footer',array(&$this,'debug_content'));
 add_filter('language_attributes',  array($this,'ogp_language_attributes'),10,1);
 add_action('after_setup_theme',array(&$this,'add_theme_support'));
 add_action('wp_head',array(&$this,'define_ogp_objects'));
-add_action('wp_footer',array(&$this,'load_sdj_js'));
-add_action('admin_print_footer_scripts',array(&$this,'load_sdj_js'));
+add_action('wp_footer',array(&$this,'load_sdk_js'));
+add_action('admin_print_footer_scripts',array(&$this,'load_sdk_js'));
 add_filter('the_content', array(&$this,'the_content'));
 add_action('comment_form_after', array(&$this,'the_comments_form'));
 add_action('wp_enqueue_scripts',array(&$this,'front_enqueue_js'));
@@ -79,9 +81,9 @@ if(!empty($this->options['app_id'])  && !empty($this->options['app_secret_key'])
 	//add_action('wp_loaded', array(&$this,'php_sdk_init'));
 	$this->php_sdk_init();
 }
+
 //UPDATES OPTIONS
 do_action("AWD_facebook_save_settings");
-
 /****************************************************
 * load subplugins AWD
 * save settings
@@ -102,7 +104,7 @@ if($this->options['connect_enable'] == 1 && $this->options['app_id'] !='' && $th
 	add_action('admin_print_footer_scripts',array(&$this,'js_sdk_init'));
 	
 	//add action to add the login button on the wp-login.php page...
-	if($this->options['login_button_display_on_login_page'] == 1)
+	if($this->options['login_button']['display_on_login_page'] == 1)
 		add_action('login_form',array(&$this,'the_login_button_wp_login'));
 	//Add avatar functions
 	if($this->options['connect_fbavatar'] == 1){
diff --git a/readme.md b/readme.md
index ab73969..3ea72e0 100755
--- a/readme.md
+++ b/readme.md
@@ -1,4 +1,4 @@
-Facebook AWD All in one
+Facebook AWD All in one 1.4 Beta
 ==============
 
 ![Plugin logo][logo]
diff --git a/readme.txt b/readme.txt
index c686636..35b5f3c 100755
--- a/readme.txt
+++ b/readme.txt
@@ -3,8 +3,8 @@ Contributors: AHWEBDEV
 Donate link: https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=ZQ2VL33YXHJLC
 Tags: facebook, facebook tab, like button, open graph, comments, fbconnect, likebox, activity box, all in one, fb connect, fb comments, facebook comments, register
 Requires at least: 3.3
-Tested up to: 3.3.1
-Stable tag: 1.3.1
+Tested up to: 3.3.2
+Stable tag: 1.3.1.4
 
 Facebook AWD is an all in one Facebook capabilities for wordpress.
 Add like button, like box, activity box, FB Comments, Open Graph and FB connect
-- 
1.7.11.1

